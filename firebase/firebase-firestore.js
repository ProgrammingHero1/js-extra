!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function(Wd){"use strict";try{(function(){Wd=Wd&&Wd.hasOwnProperty("default")?Wd.default:Wd;var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function t(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o,e,f=function(){return(f=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function p(o,s,a,u){return new(a=a||Promise)(function(t,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function r(t){try{i(u.throw(t))}catch(t){e(t)}}function i(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(n,r)}i((u=u.apply(o,s||[])).next())})}function y(n,r){var i,o,s,t,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(n,a)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}function a(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}(e=o=o||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT";function n(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case o.DEBUG:case o.VERBOSE:console.log.apply(console,a(["["+i+"]  "+t.name+":"],n));break;case o.INFO:console.info.apply(console,a(["["+i+"]  "+t.name+":"],n));break;case o.WARN:console.warn.apply(console,a(["["+i+"]  "+t.name+":"],n));break;case o.ERROR:console.error.apply(console,a(["["+i+"]  "+t.name+":"],n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}}var i=o.INFO,u=(Object.defineProperty(h.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in o))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),h.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.DEBUG],t))},h.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.VERBOSE],t))},h.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.INFO],t))},h.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.WARN],t))},h.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.ERROR],t))},h);function h(t){this.name=t,this._logLevel=i,this._logHandler=n}function l(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var c,d=(t(v,c=Error),v);function v(t,e){var n=c.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,v.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,m.prototype.create),n}var m=(g.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],s=o?function(t,r){return t.replace(w,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})}(o,r):"Error",a=this.serviceName+": "+s+" ("+i+").",u=new d(i,a),h=0,c=Object.keys(r);h<c.length;h++){var f=c[h];"_"!==f.slice(-1)&&(f in u&&console.warn('Overwriting FirebaseError base field "'+f+'" can cause unexpected behavior.'),u[f]=r[f])}return u},g);function g(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var w=/\{\$([^}]+)}/g,b=(E.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},E.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},E.prototype.setServiceProps=function(t){return this.serviceProps=t,this},E);function E(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var I,N="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},T=T||{},A=N;function S(t){return"string"==typeof t}function k(t){return"number"==typeof t}function D(t,e){t=t.split("."),e=e||A;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function R(){}function _(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function x(t){return"array"==_(t)}function C(t){var e=_(t);return"array"==e||"object"==e&&"number"==typeof t.length}function O(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var P="closure_uid_"+(1e9*Math.random()>>>0),L=0;function M(t,e,n){return t.call.apply(t.bind,arguments)}function U(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function q(t,e,n){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?M:U).apply(null,arguments)}function V(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var G=Date.now||function(){return+new Date};function j(t,o){function e(){}e.prototype=o.prototype,t.N=o.prototype,t.prototype=new e,(t.prototype.constructor=t).yb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function F(){this.j=this.j,this.i=this.i}F.prototype.j=!1,F.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[P]||(this[P]=++L)},F.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var B=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(S(t))return S(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},H=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=S(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function z(t){return Array.prototype.concat.apply([],arguments)}function J(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function W(t){return/^[\s\xa0]*$/.test(t)}var Y,X=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Q(t,e){return-1!=t.indexOf(e)}function K(t,e){return t<e?-1:e<t?1:0}t:{var $=A.navigator;if($){var Z=$.userAgent;if(Z){Y=Z;break t}}Y=""}function tt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function et(t){var e,n={};for(e in t)n[e]=t[e];return n}var nt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function rt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<nt.length;o++)n=nt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function it(t){return it[" "](t),t}it[" "]=R;var ot,st,at=Q(Y,"Opera"),ut=Q(Y,"Trident")||Q(Y,"MSIE"),ht=Q(Y,"Edge"),ct=ht||ut,ft=Q(Y,"Gecko")&&!(Q(Y.toLowerCase(),"webkit")&&!Q(Y,"Edge"))&&!(Q(Y,"Trident")||Q(Y,"MSIE"))&&!Q(Y,"Edge"),lt=Q(Y.toLowerCase(),"webkit")&&!Q(Y,"Edge");function pt(){var t=A.document;return t?t.documentMode:void 0}t:{var dt="",yt=(st=Y,ft?/rv:([^\);]+)(\)|;)/.exec(st):ht?/Edge\/([\d\.]+)/.exec(st):ut?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(st):lt?/WebKit\/(\S+)/.exec(st):at?/(?:Version)[ \/]?(\S+)/.exec(st):void 0);if(yt&&(dt=yt?yt[1]:""),ut){var vt=pt();if(null!=vt&&vt>parseFloat(dt)){ot=String(vt);break t}}ot=dt}var mt,gt={};function wt(a){return function(t,e){var n=gt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(a,function(){for(var t=0,e=X(String(ot)).split("."),n=X(String(a)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=K(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||K(0==o[2].length,0==s[2].length)||K(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t})}var bt=A.document;mt=bt&&ut?pt()||("CSS1Compat"==bt.compatMode?parseInt(ot,10):5):void 0;var Et=!ut||9<=Number(mt),It=ut&&!wt("9"),Nt=function(){if(!A.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{A.addEventListener("test",R,e),A.removeEventListener("test",R,e)}catch(t){}return t}();function Tt(t,e){this.type=t,this.a=this.target=e,this.Ia=!0}function At(t,e){if(Tt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ft){t:{try{it(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=S(t.pointerType)?t.pointerType:St[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Tt.prototype.b=function(){this.Ia=!1},j(At,Tt);var St={2:"touch",3:"pen",4:"mouse"};At.prototype.b=function(){At.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,It)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var kt="closure_listenable_"+(1e6*Math.random()|0),Dt=0;function Rt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++Dt,this.X=this.Z=!1}function _t(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function xt(t){this.src=t,this.a={},this.b=0}function Ct(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=B(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(_t(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Ot(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}xt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Ot(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Rt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Pt="closure_lm_"+(1e6*Math.random()|0),Lt={};function Mt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(x(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=Ht(r);return e&&e[kt]?e.Aa(n,r,O(i)?!!i.capture:!!i,o):Ut(e,n,r,!0,i,o)}(t,e,n,r,i);if(x(e)){for(var o=0;o<e.length;o++)Mt(t,e[o],n,r,i);return null}return n=Ht(n),t&&t[kt]?t.za(e,n,O(r)?!!r.capture:!!r,i):Ut(t,e,n,!1,r,i)}function Ut(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=O(i)?!!i.capture:!!i;if(s&&!Et)return null;var a=Ft(t);if(a||(t[Pt]=a=new xt(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var e=jt,n=Et?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)Nt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Vt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function qt(t){if(!k(t)&&t&&!t.X){var e=t.src;if(e&&e[kt])Ct(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Vt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ft(e))?(Ct(n,t),0==n.b&&(n.src=null,e[Pt]=null)):_t(t)}}}function Vt(t){return t in Lt?Lt[t]:Lt[t]="on"+t}function Gt(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&qt(t),n.call(r,e)}function jt(t,e){return!!t.X||(Et?Gt(t,new At(e,this)):Gt(t,e=new At(e||D("window.event"),this)))}function Ft(t){return(t=t[Pt])instanceof xt?t:null}var Bt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ht(e){return"function"==_(e)?e:(e[Bt]||(e[Bt]=function(t){return e.handleEvent(t)}),e[Bt])}function zt(){F.call(this),this.c=new xt(this),(this.J=this).B=null}function Jt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.X&&s.capture==n){var a=s.listener,u=s.da||s.src;s.Z&&Ct(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&0!=r.Ia}j(zt,F),zt.prototype[kt]=!0,(I=zt.prototype).addEventListener=function(t,e,n,r){Mt(this,t,e,n,r)},I.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(x(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=O(i)?!!i.capture:!!i,r=Ht(r),e&&e[kt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Ot(s=e.a[n],r,i,o))&&(_t(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Ft(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Ot(n,r,i,o)),(r=-1<e?n[e]:null)&&qt(r))}(this,t,e,n,r)},I.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(S(t))t=new Tt(t,n);else if(t instanceof Tt)t.target=t.target||n;else{var i=t;rt(t=new Tt(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var s=t.a=e[o];i=Jt(s,r,!0,t)&&i}if(i=Jt(s=t.a=n,r,!0,t)&&i,i=Jt(s,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Jt(s=t.a=e[o],r,!1,t)&&i;return i},I.G=function(){if(zt.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)_t(n[r]);delete e.a[t],e.b--}}this.B=null},I.za=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},I.Aa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Wt=A.JSON.stringify;function Yt(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Xt(){this.b=this.a=null}Yt.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Qt,Kt=new Yt(function(){return new $t},function(t){t.reset()});function $t(){this.next=this.b=this.a=null}function Zt(t){A.setTimeout(function(){throw t},0)}function te(t,e){Qt||function(){var t=A.Promise.resolve(void 0);Qt=function(){t.then(re)}}(),ee||(Qt(),ee=!0),ne.add(t,e)}Xt.prototype.add=function(t,e){var n=Kt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},$t.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var ee=!($t.prototype.reset=function(){this.next=this.b=this.a=null}),ne=new Xt;function re(){for(var t;r=n=void 0,r=null,(n=ne).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){Zt(t)}var e=Kt;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;ee=!1}function ie(t,e){zt.call(this),this.b=t||1,this.a=e||A,this.f=q(this.gb,this),this.g=G()}function oe(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function se(t,e,n){if("function"==_(t))n&&(t=q(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=q(t.handleEvent,t)}return 2147483647<Number(e)?-1:A.setTimeout(t,e||0)}function ae(t,e,n){F.call(this),this.f=null!=n?q(t,n):t,this.c=e,this.b=q(this.$a,this),this.a=[]}function ue(t){t.U=se(t.b,t.c),t.f.apply(null,t.a)}function he(t){F.call(this),this.b=t,this.a={}}j(ie,zt),(I=ie.prototype).ba=!1,I.L=null,I.gb=function(){if(this.ba){var t=G()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(oe(this),this.start()))}},I.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=G())},I.G=function(){ie.N.G.call(this),oe(this),delete this.a},j(ae,F),(I=ae.prototype).ea=!1,I.U=null,I.Ta=function(t){this.a=arguments,this.U?this.ea=!0:ue(this)},I.G=function(){ae.N.G.call(this),this.U&&(A.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},I.$a=function(){this.U=null,this.ea&&(this.ea=!1,ue(this))},j(he,F);var ce=[];function fe(t,e,n,r){x(n)||(n&&(ce[0]=n.toString()),n=ce);for(var i=0;i<n.length;i++){var o=Mt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function le(t){tt(t.a,function(t,e){this.a.hasOwnProperty(e)&&qt(t)},t),t.a={}}function pe(){}he.prototype.G=function(){he.N.G.call(this),le(this)},he.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var de=new zt;function ye(t){Tt.call(this,"serverreachability",t)}function ve(t){de.dispatchEvent(new ye(de,t))}function me(t){Tt.call(this,"statevent",t)}function ge(t){de.dispatchEvent(new me(de,t))}function we(t){Tt.call(this,"timingevent",t)}function be(t,e){if("function"!=_(t))throw Error("Fn must not be null and must be a function");return A.setTimeout(function(){t()},e)}j(ye,Tt),j(me,Tt),j(we,Tt);var Ee={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,La:7,TIMEOUT:8,sb:9},Ie={jb:"complete",wb:"success",Ma:"error",La:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function Ne(){}function Te(t){var e;return(e=t.a)||(e=t.a={}),e}function Ae(){}Ne.prototype.a=null;var Se,ke={OPEN:"a",ib:"b",Ma:"c",rb:"d"};function De(){Tt.call(this,"d")}function Re(){Tt.call(this,"c")}function _e(){}function xe(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new he(this),this.O=Ce,t=ct?125:void 0,this.P=new ie(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}j(De,Tt),j(Re,Tt),j(_e,Ne),Se=new _e;var Ce=45e3,Oe={},Pe={};function Le(t,e,n){t.F=1,t.f=an(Ze(e)),t.l=n,t.H=!0,Ue(t,null)}function Me(t,e,n,r){t.F=1,t.f=an(Ze(e)),t.l=null,t.H=n,Ue(t,r)}function Ue(t,e){t.v=G(),Ge(t),t.D=Ze(t.f),sn(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new ae(q(t.Ja,t,t.a),t.J)),fe(t.I,t.a,"readystatechange",t.cb),e=t.h?et(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),ve(1)}function qe(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Ve(t,n);if(i==Pe){4==e&&(t.c=4,ge(14),r=!1);break}if(i==Oe){t.c=4,ge(15),r=!1;break}ze(t,i)}4==e&&0==n.length&&(t.c=1,ge(16),r=!1),t.b=t.b&&r,r||(He(t),Be(t))}function Ve(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?Pe:(n=Number(e.substring(n,r)),isNaN(n)?Oe:(r+=1)+n>e.length?Pe:(e=e.substr(r,n),t.A=r+n,e))}function Ge(t){t.R=G()+t.O,je(t,t.O)}function je(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=be(q(t.ab,t),e)}function Fe(t){t.i&&(A.clearTimeout(t.i),t.i=null)}function Be(t){t.g.Ca()||t.m||t.g.na(t)}function He(t){Fe(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,oe(t.P),le(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function ze(t,e){try{t.g.Fa(t,e),ve(4)}catch(t){}}function Je(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(C(t)||S(t))H(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(C(t)||S(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(S(t))return t.split("");if(C(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function We(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof We)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Ye(t,e){Qe(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Xe(t))}function Xe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Qe(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Qe(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Qe(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(I=xe.prototype).setTimeout=function(t){this.O=t},I.cb=function(t){t=t.target;var e=this.B;e&&3==Zn(t)?e.Ta():this.Ja(t)},I.Ja=function(t){try{if(t==this.a)t:{var e=Zn(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!ct&&!this.a.aa())){this.m||4!=e||7==n||ve(8==n||r<=0?3:2),Fe(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var s=tr(this.a,"X-HTTP-Initial-Response");if(s&&!W(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.c=3,ge(12),He(this),Be(this);break t}this.s=!0,ze(this,a)}this.H?(qe(this,e,o),ct&&this.b&&3==e&&(fe(this.I,this.P,"tick",this.bb),this.P.start())):ze(this,o),4==e&&He(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,Ge(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,ge(12)):(this.c=0,ge(13)),He(this),Be(this)}}}catch(t){}},I.bb=function(){if(this.a){var t=Zn(this.a),e=this.a.aa();this.A<e.length&&(Fe(this),qe(this,t,e),this.b&&4!=t&&Ge(this))}},I.cancel=function(){this.m=!0,He(this)},I.ab=function(){this.i=null;var t=G();0<=t-this.R?(2!=this.F&&(ve(3),ge(17)),He(this),this.c=2,Be(this)):je(this,this.R-t)},(I=We.prototype).C=function(){Xe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},I.K=function(){return Xe(this),this.a.concat()},I.get=function(t,e){return Qe(this.b,t)?this.b[t]:e},I.set=function(t,e){Qe(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},I.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Ke=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function $e(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof $e?(this.h=void 0!==e?e:t.h,tn(this,t.f),this.j=t.j,en(this,t.b),nn(this,t.i),this.a=t.a,rn(this,En(t.c)),this.g=t.g):t&&(n=String(t).match(Ke))?(this.h=!!e,tn(this,n[1]||"",!0),this.j=un(n[2]||""),en(this,n[3]||"",!0),nn(this,n[4]),this.a=un(n[5]||"",!0),rn(this,n[6]||"",!0),this.g=un(n[7]||"")):(this.h=!!e,this.c=new vn(null,this.h))}function Ze(t){return new $e(t)}function tn(t,e,n){t.f=n?un(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function en(t,e,n){t.b=n?un(e,!0):e}function nn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function rn(t,e,n){e instanceof vn?(t.c=e,function(t,e){e&&!t.f&&(mn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(gn(this,e),bn(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=hn(e,dn)),t.c=new vn(e,t.h))}function on(t,e,n){t.c.set(e,n)}function sn(t,e,n){x(n)||(n=[String(n)]),bn(t.c,e,n)}function an(t){return on(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^G()).toString(36)),t}function un(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function hn(t,e,n){return S(t)?(t=encodeURI(t).replace(e,cn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function cn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}$e.prototype.toString=function(){var t=[],e=this.f;e&&t.push(hn(e,fn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(hn(e,fn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(hn(n,"/"==n.charAt(0)?pn:ln,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",hn(n,yn)),t.join("")},$e.prototype.resolve=function(t){var e=Ze(this),n=!!t.f;n?tn(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?en(e,t.b):n=null!=t.i;var r=t.a;if(n)nn(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(Q(i,"./")||Q(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],s=0;s<i.length;){var a=i[s++];"."==a?r&&s==i.length&&o.push(""):".."==a?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&s==i.length&&o.push("")):(o.push(a),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?rn(e,En(t.c)):n=!!t.g,n&&(e.g=t.g),e};var fn=/[#\/\?@]/g,ln=/[#\?:]/g,pn=/[#\?]/g,dn=/[#\?@]/g,yn=/#/g;function vn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function mn(n){n.a||(n.a=new We,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function gn(t,e){mn(t),e=In(t,e),Qe(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ye(t.a,e))}function wn(t,e){return mn(t),e=In(t,e),Qe(t.a.b,e)}function bn(t,e,n){gn(t,e),0<n.length&&(t.c=null,t.a.set(In(t,e),J(n)),t.b+=n.length)}function En(t){var e=new vn;return e.c=t.c,t.a&&(e.a=new We(t.a),e.b=t.b),e}function In(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function Nn(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function Tn(t){var e=t.a.F.a;if(null!=e)ge(4),e?(ge(10),lr(t.a,t,!1)):(ge(11),lr(t.a,t,!0));else{t.b=new xe(t,void 0,void 0),t.b.h=t.h,e=mr(e=t.a,e.Y()?t.f:null,t.i),ge(4),sn(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&on(e,n,r),Me(t.b,e,!1,t.f)}}function An(){this.a=this.b=null}function Sn(){this.a=new We}function kn(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[P]||(t[P]=++L)):e.charAt(0)+t}function Dn(t,e){this.b=t,this.a=e}function Rn(t){this.g=t||_n,t=A.PerformanceNavigationTiming?0<(t=A.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(A.ka&&A.ka.Da&&A.ka.Da()&&A.ka.Da().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Sn),this.b=null,this.c=[]}(I=vn.prototype).add=function(t,e){mn(this),this.c=null,t=In(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},I.forEach=function(n,r){mn(this),this.a.forEach(function(t,e){H(t,function(t){n.call(r,t,e,this)},this)},this)},I.K=function(){mn(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},I.C=function(t){mn(this);var e=[];if(S(t))wn(this,t)&&(e=z(e,this.a.get(In(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=z(e,t[n])}return e},I.set=function(t,e){return mn(this),this.c=null,wn(this,t=In(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},I.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},I.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")},j(function(){},function(){}),(I=Nn.prototype).M=null,I.$=function(t){return this.a.$(t)},I.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},I.Ca=function(){return!1},I.Fa=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=tr(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=tr(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void yr(e,2)}this.f=r[0]}else(e=this.a).m=this.c,yr(e,2)}else 1==this.M&&(this.g?ge(6):"11111"==e?(ge(5),this.g=!0,(!ut||10<=Number(mt))&&(this.c=200,this.b.cancel(),ge(11),lr(this.a,this,!0))):(ge(7),this.g=!1))},I.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,Tn(this)):1==this.M&&(this.g?(ge(11),lr(this.a,this,!0)):(ge(10),lr(this.a,this,!1)));else{0==this.M?ge(8):1==this.M&&ge(9);var t=this.a;t.m=this.c,yr(t,2)}},I.Y=function(){return this.a.Y()},I.ma=function(){return this.a.ma()},Sn.prototype.add=function(t){this.a.set(kn(t),t)},Sn.prototype.C=function(){return this.a.C()};var _n=10;function xn(t,e){!t.a&&(Q(e,"spdy")||Q(e,"quic")||Q(e,"h2"))&&(t.f=t.g,t.a=new Sn,t.b&&(Ln(t,t.b),t.b=null))}function Cn(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function On(t){return t.b?1:t.a?t.a.a.c:0}function Pn(t,e){return t=t.b?t.b==e:!!t.a&&(e=kn(e),Qe(t.a.a.b,e))}function Ln(t,e){t.a?t.a.add(e):t.b=e}function Mn(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=kn(e),n=Qe(t.a.a.b,n)),n&&Ye(t.a.a,kn(e)))}function Un(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return J(t.c);var e=t.c;return H(t.a.C(),function(t){e=e.concat(t.j)}),e}function qn(){}function Vn(){this.a=new qn}function Gn(t,r,e){var i=e||"";try{Je(t,function(t,e){var n=t;O(t)&&(n=Wt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function jn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}Rn.prototype.cancel=function(){this.c=Un(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(H(this.a.C(),function(t){t.cancel()}),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},qn.prototype.stringify=function(t){return A.JSON.stringify(t,void 0)},qn.prototype.parse=function(t){return A.JSON.parse(t,void 0)};var Fn=A.JSON.parse;function Bn(t){zt.call(this),this.headers=new We,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=Hn,this.D=this.F=!1}j(Bn,zt);var Hn="",zn=/^https?$/i,Jn=["POST","PUT"];function Wn(t){return"content-type"==t.toLowerCase()}function Yn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Xn(t),Kn(t)}function Xn(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Qn(t){if(t.b&&void 0!==T&&(!t.s[1]||4!=Zn(t)||2!=t.T()))if(t.l&&4==Zn(t))se(t.Ea,0,t);else if(t.dispatchEvent("readystatechange"),4==Zn(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(Ke)[1]||null;if(!o&&A.self&&A.self.location){var s=A.self.location.protocol;o=s.substr(0,s.length-1)}i=!zn.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var a=2<Zn(t)?t.a.statusText:""}catch(t){a=""}t.f=a+" ["+t.T()+"]",Xn(t)}}finally{Kn(t)}}}function Kn(t,e){if(t.a){$n(t);var n=t.a,r=t.s[0]?R:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function $n(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(A.clearTimeout(t.m),t.m=null)}function Zn(t){return t.a?t.a.readyState:0}function tr(t,e){return t.a?t.a.getResponseHeader(e):null}function er(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var n="";return tt(t,function(t,e){n+=e,n+=":",n+=t,n+="\r\n"}),n}(n),S(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return on(t,e,n),t}function nr(t){this.f=[],this.F=new An,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Qa=this.P=0,this.Oa=!!D("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Na=D("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Ra=D("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Pa=D("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=D("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.Ka=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new Rn(t&&t.concurrentRequestLimit),this.ja=new Vn,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function rr(t){if(ir(t),3==t.u){var e=t.P++,n=Ze(t.B);on(n,"SID",t.H),on(n,"RID",e),on(n,"TYPE","terminate"),ur(t,n),(e=new xe(t,e,void 0)).F=2,e.f=an(Ze(n)),n=!1,A.navigator&&A.navigator.sendBeacon&&(n=A.navigator.sendBeacon(e.f.toString(),"")),!n&&A.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=G(),Ge(e)}vr(t)}function ir(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(A.clearTimeout(t.l),t.l=null),pr(t),t.b.cancel(),t.h&&(k(t.h)&&A.clearTimeout(t.h),t.h=null)}function or(t,e){t.f.push(new Dn(t.Qa++,e)),3==t.u&&sr(t)}function sr(t){Cn(t.b)||t.h||(t.h=!0,te(t.Ha,t),t.A=0)}function ar(t,e){var n;n=e?e.W:t.P++;var r=Ze(t.B);on(r,"SID",t.H),on(r,"RID",n),on(r,"AID",t.O),ur(t,r),t.g&&t.i&&er(r,t.g,t.i),n=new xe(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=hr(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),Ln(t.b,n),Le(n,r,e)}function ur(t,n){t.c&&Je({},function(t,e){on(n,e,t)})}function hr(t,e,n){n=Math.min(t.f.length,n);var r=t.c?q(t.c.Sa,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var h=i[u].b,c=i[u].a;if((h-=o)<0)o=Math.max(0,i[u].b-100),a=!1;else try{Gn(c,s,"req"+h+"_")}catch(t){r&&r(c)}}if(a){r=s.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function cr(t){t.a||t.l||(t.S=1,te(t.Ga,t),t.v=0)}function fr(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=be(q(t.Ga,t),dr(t,t.v)),t.v++,!0)}function lr(t,e,n){var r=e.l;r&&xn(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=mr(t,null,t.ha),sr(t)}function pr(t){null!=t.s&&(A.clearTimeout(t.s),t.s=null)}function dr(t,e){var n=t.Na+Math.floor(Math.random()*t.Ra);return t.ma()||(n*=2),n*e}function yr(t,e){if(2==e){var n=null;t.c&&(n=null);var r=q(t.eb,t);n||(n=new $e("//www.google.com/images/cleardot.gif"),A.location&&"http"==A.location.protocol||tn(n,"https"),an(n)),function(t,e){var n=new pe;if(A.Image){var r=new Image;r.onload=V(jn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=V(jn,n,r,"TestLoadImage: error",!1,e),r.onabort=V(jn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=V(jn,n,r,"TestLoadImage: timeout",!1,e),A.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else ge(2);t.u=0,t.c&&t.c.ta(e),vr(t),ir(t)}function vr(t){t.u=0,t.m=-1,t.c&&(0==Un(t.b).length&&0==t.f.length||(t.b.c.length=0,J(t.f),t.f.length=0),t.c.sa())}function mr(t,e,n){var r=function(t){return t instanceof $e?Ze(t):new $e(t,void 0)}(n);if(""!=r.b)e&&en(r,e+"."+r.b),nn(r,r.i);else{var i,o=A.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new $e(null,void 0);return t&&tn(i,t),e&&en(i,e),n&&nn(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&tt(t.V,function(t,e){on(r,e,t)}),e=t.j,n=t.I,e&&n&&on(r,e,n),on(r,"VER",t.wa),ur(t,r),r}function gr(){}function wr(){if(ut&&!(10<=Number(mt)))throw Error("Environmental error: no available transport.")}function br(t,e){zt.call(this),this.a=new nr(e),this.g=t,this.m=e&&e.fb?e.fb:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];if(0==i.lastIndexOf("/",0))e=i;else(r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!W(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!W(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new Nr(this)}function Er(t){De.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Ir(){Re.call(this),this.status=1}function Nr(t){this.a=t}(I=Bn.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Te(this.H):Te(Se),this.a.onreadystatechange=q(this.Ea,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Yn(this,t)}t=n||"";var i=new We(this.headers);r&&Je(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Wn,n=t.length,r=S(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:S(t)?t.charAt(e):t[e]}(i.K()),n=A.FormData&&t instanceof A.FormData,0<=B(Jn,e)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{$n(this),0<this.o&&((this.D=function(t){return ut&&wt(9)&&k(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=q(this.Ba,this)):this.m=se(this.Ba,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Yn(this,t)}},I.Ba=function(){void 0!==T&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},I.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Kn(this))},I.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Kn(this,!0)),Bn.N.G.call(this)},I.Ea=function(){this.j||(this.w||this.l||this.g?Qn(this):this.Za())},I.Za=function(){Qn(this)},I.T=function(){try{return 2<Zn(this)?this.a.status:-1}catch(t){return-1}},I.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},I.Ua=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Fn(e)}},I.ya=function(){return this.h},I.Xa=function(){return S(this.f)?this.f:String(this.f)},(I=nr.prototype).wa=8,I.u=1,I.Ca=function(){return 0==this.u},I.Ha=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random()),t=this.P++;var e,n=new xe(this,t,void 0),r=this.i;if(this.J&&(r?rt(r=et(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&S(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=hr(this,n,e),on(i=Ze(this.B),"RID",t),on(i,"CVER",22),this.o&&this.j&&on(i,"X-HTTP-Session-Id",this.j),ur(this,i),this.g&&r&&er(i,this.g,r),Ln(this.b,n),this.W?(on(i,"$req",e),on(i,"SID","null"),n.S=!0,Le(n,i,null)):Le(n,i,e),this.u=2}}else 3==this.u&&(t?ar(this,t):0==this.f.length||Cn(this.b)||ar(this))},I.Ga=function(){this.l=null,this.a=new xe(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=Ze(this.pa);on(t,"RID","rpc"),on(t,"SID",this.H),on(t,"CI",this.ia?"0":"1"),on(t,"AID",this.O),ur(this,t),on(t,"TYPE","xmlhttp"),this.g&&this.i&&er(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Me(this.a,t,!0,this.ga)},I.Fa=function(t,e){if(0!=this.u&&(this.a==t||Pn(this.b,t)))if(this.m=t.o,!t.s&&Pn(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(x(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;pr(this),this.a.cancel(),this.a=null}fr(this),ge(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=be(q(this.Ya,this),6e3));if(On(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else yr(this,11)}else if(!t.s&&this.a!=t||pr(this),!W(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&k(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=tr(r,"X-Client-Wire-Protocol"))&&xn(this.b,i),this.j&&(r=tr(r,"X-HTTP-Session-Id")))&&(this.I=r,on(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=mr(this,this.Y()?this.ga:null,this.ha),r.s?(Mn(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Fe(r),Ge(r)),this.a=r):cr(this),0<this.f.length&&sr(this)}else"stop"!=r[0]&&"close"!=r[0]||yr(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?yr(this,7):rr(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},I.Ya=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,fr(this),ge(19))},I.na=function(t){var e=null;if(this.a==t){pr(this),this.a=null;var n=2}else{if(!Pn(this.b,t))return;e=t.j,Mn(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=G()-t.v,de.dispatchEvent(new we(de,t.l?t.l.length:0,e,this.A)),sr(this)):cr(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(On(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.f=e.j.concat(t.f),!0):!(1==t.u||2==t.u||t.A>=(t.Oa?0:t.Pa))&&(t.h=be(q(t.Ha,t,e),dr(t,t.A)),t.A++,!0))}(this,t)||2==n&&fr(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:yr(this,5);break;case 4:yr(this,10);break;case 3:yr(this,6);break;default:yr(this,2)}}},I.eb=function(t){ge(t?2:1)},I.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Bn(this.Ka)).F=this.R,t},I.ma=function(){return!!this.c&&!0},I.Y=function(){return this.R},(I=gr.prototype).va=function(){},I.ua=function(){},I.ta=function(){},I.sa=function(){},I.Sa=function(){},wr.prototype.a=function(t,e){return new br(t,e)},j(br,zt),(I=br.prototype).addEventListener=function(t,e,n,r){br.N.addEventListener.call(this,t,e,n,r)},I.removeEventListener=function(t,e,n,r){br.N.removeEventListener.call(this,t,e,n,r)},I.Va=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;ge(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new Nn(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=er(e,t.g,t.i)),(t=t.w).i=n,e=mr(t.a,null,t.i),ge(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,Tn(t)):(sn(e,"MODE","init"),!t.a.o&&t.a.j&&sn(e,"X-HTTP-Session-Id",t.a.j),t.b=new xe(t,void 0,void 0),t.b.h=t.h,Me(t.b,e,!1,null),t.M=0)},I.close=function(){rr(this.a)},I.Wa=function(t){if(S(t)){var e={};e.__data__=t,or(this.a,e)}else this.h?((e={}).__data__=Wt(t),or(this.a,e)):or(this.a,t)},I.G=function(){this.a.c=null,delete this.f,rr(this.a),delete this.a,br.N.G.call(this)},j(Er,De),j(Ir,Re),j(Nr,gr),Nr.prototype.va=function(){this.a.dispatchEvent("a")},Nr.prototype.ua=function(t){this.a.dispatchEvent(new Er(t))},Nr.prototype.ta=function(t){this.a.dispatchEvent(new Ir(t))},Nr.prototype.sa=function(){this.a.dispatchEvent("b")};var Tr=V(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},wr);wr.prototype.createWebChannel=wr.prototype.a,br.prototype.send=br.prototype.Wa,br.prototype.open=br.prototype.Va,br.prototype.close=br.prototype.close,Ee.NO_ERROR=0,Ee.TIMEOUT=8,Ee.HTTP_ERROR=6,Ie.COMPLETE="complete",(Ae.EventType=ke).OPEN="a",ke.CLOSE="b",ke.ERROR="c",ke.MESSAGE="d",zt.prototype.listen=zt.prototype.za,Bn.prototype.listenOnce=Bn.prototype.Aa,Bn.prototype.getLastError=Bn.prototype.Xa,Bn.prototype.getLastErrorCode=Bn.prototype.ya,Bn.prototype.getStatus=Bn.prototype.T,Bn.prototype.getResponseJson=Bn.prototype.Ua,Bn.prototype.getResponseText=Bn.prototype.aa,Bn.prototype.send=Bn.prototype.ca;var Ar,Sr,kr={createWebChannelTransport:Tr,ErrorCode:Ee,EventType:Ie,WebChannel:Ae,XhrIo:Bn},Dr=kr.createWebChannelTransport,Rr=kr.ErrorCode,_r=kr.EventType,xr=kr.WebChannel,Cr=kr.XhrIo,Or=Wd.SDK_VERSION,Pr=new u("@firebase/firestore");function Lr(){return Pr.logLevel===o.DEBUG?Ar.DEBUG:Pr.logLevel===o.SILENT?Ar.SILENT:Ar.ERROR}function Mr(t){switch(t){case Ar.DEBUG:Pr.logLevel=o.DEBUG;break;case Ar.ERROR:Pr.logLevel=o.ERROR;break;case Ar.SILENT:Pr.logLevel=o.SILENT;break;default:Pr.error("Firestore ("+Or+"): Invalid value passed to `setLogLevel`")}}function Ur(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(Pr.logLevel<=o.DEBUG){var i=n.map(Vr);Pr.debug.apply(Pr,s(["Firestore ("+Or+") ["+t+"]: "+e],i))}}function qr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Pr.logLevel<=o.ERROR){var r=e.map(Vr);Pr.error.apply(Pr,s(["Firestore ("+Or+"): "+t],r))}}function Vr(t){if("string"==typeof t)return t;var e=Ju.t();try{return e.i(t)}catch(e){return t}}function Gr(t){var e="FIRESTORE ("+Or+") INTERNAL ASSERTION FAILED: "+t;throw qr(e),new Error(e)}function jr(t,e){t||Gr(e)}(Sr=Ar=Ar||{})[Sr.DEBUG=0]="DEBUG",Sr[Sr.ERROR=1]="ERROR",Sr[Sr.SILENT=2]="SILENT";var Fr=(Br.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return jr(20===e.length,"Invalid auto ID: "+e),e},Br);function Br(){}function Hr(t,e){return t<e?-1:e<t?1:0}function zr(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function Jr(t){return t+"\0"}function Wr(t,e,n,r,i){this.s=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}function Yr(t,e){this.user=e,this.type="OAuth",this.g={},this.g.Authorization="Bearer "+t}var Xr,Qr="(default)",Kr=(Object.defineProperty(fi.prototype,"o",{get:function(){return this.database===Qr},enumerable:!0,configurable:!0}),fi.prototype.isEqual=function(t){return t instanceof fi&&t.projectId===this.projectId&&t.database===this.database},fi.prototype.h=function(t){return Hr(this.projectId,t.projectId)||Hr(this.database,t.database)},fi),$r=(ci.prototype.l=function(){return null!=this.uid},ci.prototype.v=function(){return this.l()?"uid:"+this.uid:"anonymous-user"},ci.prototype.isEqual=function(t){return t.uid===this.uid},ci.UNAUTHENTICATED=new ci(null),ci.m=new ci("google-credentials-uid"),ci.p=new ci("first-party-uid"),ci),Zr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},ti=(t(hi,Xr=Error),hi),ei=(ui.prototype.getToken=function(){return Promise.resolve(null)},ui.prototype.I=function(){},ui.prototype.T=function(t){jr(!this._,"Can only call setChangeListener() once."),(this._=t)($r.UNAUTHENTICATED)},ui.prototype.R=function(){jr(null!==this._,"removeChangeListener() when no listener registered"),this._=null},ui),ni=(ai.prototype.getToken=function(){var e=this;jr(null!=this.A,"getToken cannot be called after listener removed.");var n=this.P,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){if(e.P!==n)throw new ti(Zr.ABORTED,"getToken aborted due to token change.");return t?(jr("string"==typeof t.accessToken,"Invalid tokenData returned from getToken():"+t),new Yr(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},ai.prototype.I=function(){this.forceRefresh=!0},ai.prototype.T=function(t){jr(!this._,"Can only call setChangeListener() once."),this._=t,this.D&&t(this.currentUser)},ai.prototype.R=function(){jr(null!=this.A,"removeChangeListener() called twice"),jr(null!==this._,"removeChangeListener() called when no listener registered"),this.auth&&this.auth.removeAuthTokenListener(this.A),this.A=null,this._=null},ai.prototype.S=function(){var t=this.auth&&this.auth.getUid();return jr(null===t||"string"==typeof t,"Received invalid UID: "+t),new $r(t)},ai),ri=(Object.defineProperty(si.prototype,"g",{get:function(){var t={"X-Goog-AuthUser":this.k},e=this.C.auth.V([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),si),ii=(oi.prototype.getToken=function(){return Promise.resolve(new ri(this.C,this.k))},oi.prototype.T=function(t){t($r.p)},oi.prototype.R=function(){},oi.prototype.I=function(){},oi);function oi(t,e){this.C=t,this.k=e}function si(t,e){this.C=t,this.k=e,this.type="FirstParty",this.user=$r.p}function ai(t){var e=this;this.A=null,this.currentUser=$r.UNAUTHENTICATED,this.D=!1,this.P=0,this._=null,this.forceRefresh=!1,this.A=function(){e.P++,e.currentUser=e.S(),e.D=!0,e._&&e._(e.currentUser)},this.P=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.A):(this.A(null),t.get().then(function(t){e.auth=t,e.A&&e.auth.addAuthTokenListener(e.A)},function(){}))}function ui(){this._=null}function hi(t,e){var n=Xr.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function ci(t){this.uid=t}function fi(t,e){this.projectId=t,this.database=e||Qr}function li(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function pi(t,e){return void 0!==t?t:e}function di(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function yi(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function vi(t){for(var e in jr(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function mi(t,e){if(0!==e.length)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Pi(e.length,"argument")+".")}function gi(t,e,n){if(e.length!==n)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires "+Pi(n,"argument")+", but was called with "+Pi(e.length,"argument")+".")}function wi(t,e,n){if(e.length<n)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Pi(n,"argument")+", but was called with "+Pi(e.length,"argument")+".")}function bi(t,e,n,r){if(e.length<n||e.length>r)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Pi(e.length,"argument")+".")}function Ei(t,e,n,r){Si(t,e,Oi(n)+" argument",r)}function Ii(t,e,n,r){void 0!==r&&Ei(t,e,n,r)}function Ni(t,e,n,r){Si(t,e,n+" option",r)}function Ti(t,e,n,r){void 0!==r&&Ni(t,e,n,r)}function Ai(t,e,n,r,h){void 0!==r&&function(t,e,n,r){for(var i=[],o=0,s=h;o<s.length;o++){var a=s[o];if(a===r)return;i.push(Di(a))}var u=Di(r);throw new ti(Zr.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+i.join(", "))}(t,0,n,r)}function Si(t,e,n,r){if(!("object"===e?ki(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Di(r);throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function ki(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Di(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Gr("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function Ri(t,e,n){if(void 0===n)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Oi(e)+" argument, but it was undefined.")}function _i(n,t,r){yi(t,function(t,e){if(r.indexOf(t)<0)throw new ti(Zr.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function xi(t,e,n,r){var i=Di(r);return new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires its "+Oi(n)+" argument to be a "+e+", but it was: "+i)}function Ci(t,e,n){if(n<=0)throw new ti(Zr.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+Oi(e)+" argument to be a positive number, but it was: "+n+".")}function Oi(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Pi(t,e){return t+" "+e+(1===t?"":"s")}var Li,Mi,Ui=(Object.defineProperty(so.prototype,"latitude",{get:function(){return this.O},enumerable:!0,configurable:!0}),Object.defineProperty(so.prototype,"longitude",{get:function(){return this.F},enumerable:!0,configurable:!0}),so.prototype.isEqual=function(t){return this.O===t.O&&this.F===t.F},so.prototype.U=function(t){return Hr(this.O,t.O)||Hr(this.F,t.F)},so),qi=-62135596800,Vi=(oo.now=function(){return oo.fromMillis(Date.now())},oo.fromDate=function(t){return oo.fromMillis(t.getTime())},oo.fromMillis=function(t){var e=Math.floor(t/1e3);return new oo(e,1e6*(t-1e3*e))},oo.prototype.toDate=function(){return new Date(this.toMillis())},oo.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},oo.prototype.U=function(t){return this.seconds===t.seconds?Hr(this.nanoseconds,t.nanoseconds):Hr(this.seconds,t.seconds)},oo.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},oo.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},oo.prototype.valueOf=function(){var t=this.seconds-qi;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},oo),Gi=(io.j=function(t){var e=Math.floor(t/1e6);return new io(new Vi(e,t%1e6*1e3))},io.L=function(t){return new io(t)},io.B=function(){return io.MIN},io.prototype.h=function(t){return this.timestamp.U(t.timestamp)},io.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},io.prototype.M=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},io.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},io.prototype.q=function(){return this.timestamp},io.MIN=new io(new Vi(0,0)),io),ji=(Object.defineProperty(ro.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),ro.prototype.isEqual=function(t){return 0===ro.G(this,t)},ro.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof ro?t.forEach(function(t){e.push(t)}):e.push(t),this.W(e)},ro.prototype.limit=function(){return this.offset+this.length},ro.prototype.K=function(t){return t=void 0===t?1:t,jr(this.length>=t,"Can't call popFirst() with less segments"),this.W(this.segments,this.offset+t,this.length-t)},ro.prototype.H=function(){return jr(!this.J(),"Can't call popLast() on empty path"),this.W(this.segments,this.offset,this.length-1)},ro.prototype.Y=function(){return jr(!this.J(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},ro.prototype.X=function(){return this.get(this.length-1)},ro.prototype.get=function(t){return jr(t<this.length,"Index out of range"),this.segments[this.offset+t]},ro.prototype.J=function(){return 0===this.length},ro.prototype.$=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ro.prototype.Z=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ro.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},ro.prototype.tt=function(){return this.segments.slice(this.offset,this.limit())},ro.G=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},ro),Fi=(t(no,Mi=ji),no.prototype.W=function(t,e,n){return new no(t,e,n)},no.prototype.nt=function(){return this.tt().join("/")},no.prototype.toString=function(){return this.nt()},no.it=function(t){if(0<=t.indexOf("//"))throw new ti(Zr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new no(t.split("/").filter(function(t){return 0<t.length}))},no.et=new no([]),no),Bi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Hi=(t(eo,Li=ji),eo.prototype.W=function(t,e,n){return new eo(t,e,n)},eo.rt=function(t){return Bi.test(t)},eo.prototype.nt=function(){return this.tt().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),eo.rt(t)||(t="`"+t+"`"),t}).join(".")},eo.prototype.toString=function(){return this.nt()},eo.prototype.ut=function(){return 1===this.length&&"__name__"===this.get(0)},eo.st=function(){return new eo(["__name__"])},eo.ot=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new ti(Zr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[r+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new ti(Zr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=a,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new ti(Zr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new eo(e)},eo.et=new eo([]),eo),zi=(to.prototype.ct=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},to.prototype.isEqual=function(t){return null!==t&&0===Fi.G(this.path,t.path)},to.prototype.toString=function(){return this.path.toString()},to.G=function(t,e){return Fi.G(t.path,e.path)},to.ht=function(t){return t.length%2==0},to.at=function(t){return new to(new Fi(t.slice()))},to.ft=function(t){return new to(Fi.it(t))},to.EMPTY=new to(new Fi([])),to),Ji=(Zi.prototype.lt=function(t,e){return new Zi(this.G,this.root.lt(t,e,this.G).copy(null,null,Yi.dt,null,null))},Zi.prototype.remove=function(t){return new Zi(this.G,this.root.remove(t,this.G).copy(null,null,Yi.dt,null,null))},Zi.prototype.get=function(t){for(var e=this.root;!e.J();){var n=this.G(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Zi.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.J();){var r=this.G(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Zi.prototype.J=function(){return this.root.J()},Object.defineProperty(Zi.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),Zi.prototype.vt=function(){return this.root.vt()},Zi.prototype.wt=function(){return this.root.wt()},Zi.prototype.pt=function(t){return this.root.pt(t)},Zi.prototype.forEach=function(n){this.pt(function(t,e){return n(t,e),!1})},Zi.prototype.toString=function(){var n=[];return this.pt(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},Zi.prototype.gt=function(t){return this.root.gt(t)},Zi.prototype.bt=function(){return new Wi(this.root,null,this.G,!1)},Zi.prototype.yt=function(t){return new Wi(this.root,t,this.G,!1)},Zi.prototype._t=function(){return new Wi(this.root,null,this.G,!0)},Zi.prototype.It=function(t){return new Wi(this.root,t,this.G,!0)},Zi),Wi=($i.prototype.Rt=function(){jr(0<this.Et.length,"getNext() called on iterator when hasNext() is false.");var t=this.Et.pop(),e={key:t.key,value:t.value};if(this.Tt)for(t=t.left;!t.J();)this.Et.push(t),t=t.right;else for(t=t.right;!t.J();)this.Et.push(t),t=t.left;return e},$i.prototype.At=function(){return 0<this.Et.length},$i.prototype.Dt=function(){if(0===this.Et.length)return null;var t=this.Et[this.Et.length-1];return{key:t.key,value:t.value}},$i),Yi=(Ki.prototype.copy=function(t,e,n,r,i){return new Ki(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Ki.prototype.J=function(){return!1},Ki.prototype.pt=function(t){return this.left.pt(t)||t(this.key,this.value)||this.right.pt(t)},Ki.prototype.gt=function(t){return this.right.gt(t)||t(this.key,this.value)||this.left.gt(t)},Ki.prototype.min=function(){return this.left.J()?this:this.left.min()},Ki.prototype.vt=function(){return this.min().key},Ki.prototype.wt=function(){return this.right.J()?this.key:this.right.wt()},Ki.prototype.lt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.lt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.lt(t,e,n))).Pt()},Ki.prototype.St=function(){if(this.left.J())return Ki.EMPTY;var t=this;return t.left.Ct()||t.left.left.Ct()||(t=t.kt()),(t=t.copy(null,null,null,t.left.St(),null)).Pt()},Ki.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.J()||r.left.Ct()||r.left.left.Ct()||(r=r.kt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.Ct()&&(r=r.Vt()),r.right.J()||r.right.Ct()||r.right.left.Ct()||(r=r.Nt()),0===e(t,r.key)){if(r.right.J())return Ki.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.St())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Pt()},Ki.prototype.Ct=function(){return this.color},Ki.prototype.Pt=function(){var t=this;return t.right.Ct()&&!t.left.Ct()&&(t=t.Ot()),t.left.Ct()&&t.left.left.Ct()&&(t=t.Vt()),t.left.Ct()&&t.right.Ct()&&(t=t.Ft()),t},Ki.prototype.kt=function(){var t=this.Ft();return t.right.left.Ct()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Vt())).Ot()).Ft()),t},Ki.prototype.Nt=function(){var t=this.Ft();return t.left.left.Ct()&&(t=(t=t.Vt()).Ft()),t},Ki.prototype.Ot=function(){var t=this.copy(null,null,Ki.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Ki.prototype.Vt=function(){var t=this.copy(null,null,Ki.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Ki.prototype.Ft=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Ki.prototype.Ut=function(){var t=this.xt();return Math.pow(2,t)<=this.size+1},Ki.prototype.xt=function(){if(this.Ct()&&this.left.Ct())throw Gr("Red node has red child("+this.key+","+this.value+")");if(this.right.Ct())throw Gr("Right child of ("+this.key+","+this.value+") is red");var t=this.left.xt();if(t!==this.right.xt())throw Gr("Black depths differ");return t+(this.Ct()?0:1)},Ki.EMPTY=null,Ki.RED=!0,Ki.dt=!1,Ki),Xi=(Object.defineProperty(Qi.prototype,"key",{get:function(){throw Gr("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"value",{get:function(){throw Gr("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"color",{get:function(){throw Gr("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"left",{get:function(){throw Gr("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"right",{get:function(){throw Gr("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),Qi.prototype.copy=function(t,e,n,r,i){return this},Qi.prototype.lt=function(t,e,n){return new Yi(t,e)},Qi.prototype.remove=function(t,e){return this},Qi.prototype.J=function(){return!0},Qi.prototype.pt=function(t){return!1},Qi.prototype.gt=function(t){return!1},Qi.prototype.vt=function(){return null},Qi.prototype.wt=function(){return null},Qi.prototype.Ct=function(){return!1},Qi.prototype.Ut=function(){return!0},Qi.prototype.xt=function(){return 0},Qi);function Qi(){this.size=0}function Ki(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Ki.RED,this.left=null!=r?r:Ki.EMPTY,this.right=null!=i?i:Ki.EMPTY,this.size=this.left.size+1+this.right.size}function $i(t,e,n,r){this.Tt=r,this.Et=[];for(var i=1;!t.J();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Tt?t.left:t.right;else{if(0===i){this.Et.push(t);break}this.Et.push(t),t=this.Tt?t.right:t.left}}function Zi(t,e){this.G=t,this.root=e||Yi.EMPTY}function to(t){this.path=t,jr(to.ht(t),"Invalid DocumentKey with an odd number of segments: "+t.tt().join("/"))}function eo(){return null!==Li&&Li.apply(this,arguments)||this}function no(){return null!==Mi&&Mi.apply(this,arguments)||this}function ro(t,e,n){void 0===e?e=0:e>t.length&&Gr("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Gr("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}function io(t){this.timestamp=t}function oo(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new ti(Zr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new ti(Zr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<qi)throw new ti(Zr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new ti(Zr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function so(t,e){if(gi("GeoPoint",arguments,2),Ei("GeoPoint","number",1,t),Ei("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new ti(Zr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new ti(Zr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.O=t,this.F=e}Yi.EMPTY=new Xi;var ao=(wo.jt=function(t){var e=new wo(t.G);return t.forEach(function(t){e=e.add(t)}),e},wo.prototype.has=function(t){return null!==this.data.get(t)},wo.prototype.first=function(){return this.data.vt()},wo.prototype.last=function(){return this.data.wt()},Object.defineProperty(wo.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),wo.prototype.indexOf=function(t){return this.data.indexOf(t)},wo.prototype.forEach=function(n){this.data.pt(function(t,e){return n(t),!1})},wo.prototype.Lt=function(t,e){for(var n=this.data.yt(t[0]);n.At();){var r=n.Rt();if(0<=this.G(r.key,t[1]))return;e(r.key)}},wo.prototype.Bt=function(t,e){var n;for(n=void 0!==e?this.data.yt(e):this.data.bt();n.At();)if(!t(n.Rt().key))return},wo.prototype.Mt=function(t){var e=this.data.yt(t);return e.At()?e.Rt().key:null},wo.prototype.bt=function(){return new uo(this.data.bt())},wo.prototype.yt=function(t){return new uo(this.data.yt(t))},wo.prototype.add=function(t){return this.copy(this.data.remove(t).lt(t,!0))},wo.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},wo.prototype.J=function(){return this.data.J()},wo.prototype.qt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},wo.prototype.isEqual=function(t){if(!(t instanceof wo))return!1;if(this.size!==t.size)return!1;for(var e=this.data.bt(),n=t.data.bt();e.At();){var r=e.Rt().key,i=n.Rt().key;if(0!==this.G(r,i))return!1}return!0},wo.prototype.tt=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},wo.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},wo.prototype.copy=function(t){var e=new wo(this.G);return e.data=t,e},wo),uo=(go.prototype.Rt=function(){return this.Qt.Rt().key},go.prototype.At=function(){return this.Qt.At()},go),ho=(mo.prototype.Gt=function(t,e){return new Ds(e,t)},mo.prototype.Wt=function(t,e){return e},mo.prototype.zt=function(t){return null},mo.prototype.isEqual=function(t){return t instanceof mo},mo.instance=new mo,mo),co=(vo.prototype.Gt=function(t,e){return this.apply(t)},vo.prototype.Wt=function(t,e){return this.apply(t)},vo.prototype.apply=function(t){for(var n=bo(t),e=function(e){n.find(function(t){return t.isEqual(e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Ps(n)},vo.prototype.zt=function(t){return null},vo.prototype.isEqual=function(t){return t instanceof vo&&zr(t.elements,this.elements)},vo),fo=(yo.prototype.Gt=function(t,e){return this.apply(t)},yo.prototype.Wt=function(t,e){return this.apply(t)},yo.prototype.apply=function(t){for(var n=bo(t),e=function(e){n=n.filter(function(t){return!t.isEqual(e)})},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Ps(n)},yo.prototype.zt=function(t){return null},yo.prototype.isEqual=function(t){return t instanceof yo&&zr(t.elements,this.elements)},yo),lo=(po.prototype.Gt=function(t,e){var n=this.zt(t);if(n instanceof Ts&&this.Kt instanceof Ts){var r=n.Ht+this.Kt.Ht;return new Ts(r)}return r=n.Ht+this.Kt.Ht,new As(r)},po.prototype.Wt=function(t,e){return jr(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},po.prototype.zt=function(t){return t instanceof is?t:new Ts(0)},po.prototype.isEqual=function(t){return t instanceof po&&this.Kt.isEqual(t.Kt)},po);function po(t){this.Kt=t}function yo(t){this.elements=t}function vo(t){this.elements=t}function mo(){}function go(t){this.Qt=t}function wo(t){this.G=t,this.data=new Ji(this.G)}function bo(t){return t instanceof Ps?t.Ht.slice():[]}function Eo(t,e){this.version=t,this.transformResults=e}var Io,No,To=(ko.Jt=function(t){return new ko(t)},ko.Yt=function(t){var e=new ao(Hi.G);return t.forEach(function(t){return e=e.add(t)}),new ko(e)},ko.prototype.Xt=function(e){var n=!1;return this.fields.forEach(function(t){t.$(e)&&(n=!0)}),n},ko.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},ko),Ao=(So.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},So);function So(t,e){this.field=t,this.transform=e}function ko(t){this.fields=t}(No=Io=Io||{})[No.Set=0]="Set",No[No.$t=1]="__PRIVATE_Patch",No[No.Transform=2]="Transform",No[No.Zt=3]="__PRIVATE_Delete",No[No.Verify=4]="Verify";var Do,Ro,_o,xo,Co,Oo,Po,Lo,Mo,Uo=(Qo.exists=function(t){return new Qo(void 0,t)},Qo.updateTime=function(t){return new Qo(t)},Object.defineProperty(Qo.prototype,"tn",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),Qo.prototype.nn=function(t){return void 0!==this.updateTime?t instanceof Ms&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Ms:(jr(this.tn,"Precondition should be empty"),!0)},Qo.prototype.isEqual=function(t){return e=this.updateTime,n=t.updateTime,(null!=e?!(!n||!e.isEqual(n)):e===n)&&this.exists===t.exists;var e,n},Qo.NONE=new Qo,Qo),qo=(Xo.prototype.in=function(t){null!=t&&jr(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},Xo.en=function(t){return t instanceof Ms?t.version:Gi.MIN},Xo),Vo=(t(Yo,Mo=qo),Yo.prototype.Wt=function(t,e){this.in(t),jr(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new Ms(this.key,n,{hasCommittedMutations:!0},this.value)},Yo.prototype.Gt=function(t,e,n){if(this.in(t),!this.rn.nn(t))return t;var r=qo.en(t);return new Ms(this.key,r,{un:!0},this.value)},Yo.prototype.sn=function(t){return null},Yo.prototype.isEqual=function(t){return t instanceof Yo&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.rn.isEqual(t.rn)},Yo),Go=(t(Wo,Lo=qo),Wo.prototype.Wt=function(t,e){if(this.in(t),jr(null==e.transformResults,"Transform results received by PatchMutation."),!this.rn.nn(t))return new qs(this.key,e.version);var n=this.hn(t);return new Ms(this.key,e.version,{hasCommittedMutations:!0},n)},Wo.prototype.Gt=function(t,e,n){if(this.in(t),!this.rn.nn(t))return t;var r=qo.en(t),i=this.hn(t);return new Ms(this.key,r,{un:!0},i)},Wo.prototype.sn=function(t){return null},Wo.prototype.isEqual=function(t){return t instanceof Wo&&this.key.isEqual(t.key)&&this.on.isEqual(t.on)&&this.rn.isEqual(t.rn)},Wo.prototype.hn=function(t){var e;return e=t instanceof Ms?t.data():Cs.EMPTY,this.cn(e)},Wo.prototype.cn=function(t){var n=this,r=t.an();return this.on.fields.forEach(function(t){if(!t.J()){var e=n.data.field(t);null!==e?r.set(t,e):r.delete(t)}}),r.fn()},Wo),jo=(t(Jo,Po=qo),Jo.prototype.Wt=function(t,e){if(this.in(t),jr(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.rn.nn(t))return new qs(this.key,e.version);var n=this.ln(t),r=this.dn(t,e.transformResults),i=e.version,o=this.vn(n.data(),r);return new Ms(this.key,i,{hasCommittedMutations:!0},o)},Jo.prototype.Gt=function(t,e,n){if(this.in(t),!this.rn.nn(t))return t;var r=this.ln(t),i=this.wn(n,t,e),o=this.vn(r.data(),i);return new Ms(this.key,r.version,{un:!0},o)},Jo.prototype.sn=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Ms?t.field(i.field):void 0,s=i.transform.zt(o||null);null!=s&&(e=null==e?Cs.mn().set(i.field,s):e.set(i.field,s))}return e?e.fn():null},Jo.prototype.isEqual=function(t){return t instanceof Jo&&this.key.isEqual(t.key)&&zr(this.fieldTransforms,t.fieldTransforms)&&this.rn.isEqual(t.rn)},Jo.prototype.ln=function(t){return jr(t instanceof Ms,"Unknown MaybeDocument type "+t),jr(t.key.isEqual(this.key),"Can only transform a document with the same key"),t},Jo.prototype.dn=function(t,e){var n=[];jr(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,s=null;t instanceof Ms&&(s=t.field(i.field)),n.push(o.Wt(s,e[r]))}return n},Jo.prototype.wn=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var s=o[i],a=s.transform,u=null;e instanceof Ms&&(u=e.field(s.field)),null===u&&n instanceof Ms&&(u=n.field(s.field)),r.push(a.Gt(u,t))}return r},Jo.prototype.vn=function(t,e){jr(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=t.an(),r=0;r<this.fieldTransforms.length;r++){var i=this.fieldTransforms[r].field;n.set(i,e[r])}return n.fn()},Jo),Fo=(t(zo,Oo=qo),zo.prototype.Wt=function(t,e){return this.in(t),jr(null==e.transformResults,"Transform results received by DeleteMutation."),new Us(this.key,e.version,{hasCommittedMutations:!0})},zo.prototype.Gt=function(t,e,n){return this.in(t),this.rn.nn(t)?(t&&jr(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new Us(this.key,Gi.B())):t},zo.prototype.sn=function(t){return null},zo.prototype.isEqual=function(t){return t instanceof zo&&this.key.isEqual(t.key)&&this.rn.isEqual(t.rn)},zo),Bo=(t(Ho,Co=qo),Ho.prototype.Wt=function(t,e){Gr("VerifyMutation should only be used in Transactions.")},Ho.prototype.Gt=function(t,e,n){Gr("VerifyMutation should only be used in Transactions.")},Ho.prototype.sn=function(t){Gr("VerifyMutation should only be used in Transactions.")},Ho.prototype.isEqual=function(t){return t instanceof Ho&&this.key.isEqual(t.key)&&this.rn.isEqual(t.rn)},Ho);function Ho(t,e){var n=Co.call(this)||this;return n.key=t,n.rn=e,n.type=Io.Verify,n}function zo(t,e){var n=Oo.call(this)||this;return n.key=t,n.rn=e,n.type=Io.Zt,n}function Jo(t,e){var n=Po.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=Io.Transform,n.rn=Uo.exists(!0),n}function Wo(t,e,n,r){var i=Lo.call(this)||this;return i.key=t,i.data=e,i.on=n,i.rn=r,i.type=Io.$t,i}function Yo(t,e,n){var r=Mo.call(this)||this;return r.key=t,r.value=e,r.rn=n,r.type=Io.Set,r}function Xo(){}function Qo(t,e){this.updateTime=t,this.exists=e,jr(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}(Ro=Do=Do||{})[Ro.pn=0]="__PRIVATE_NullValue",Ro[Ro.gn=1]="__PRIVATE_BooleanValue",Ro[Ro.bn=2]="__PRIVATE_NumberValue",Ro[Ro.yn=3]="__PRIVATE_TimestampValue",Ro[Ro._n=4]="__PRIVATE_StringValue",Ro[Ro.In=5]="__PRIVATE_BlobValue",Ro[Ro.Tn=6]="__PRIVATE_RefValue",Ro[Ro.En=7]="__PRIVATE_GeoPointValue",Ro[Ro.ArrayValue=8]="ArrayValue",Ro[Ro.Rn=9]="__PRIVATE_ObjectValue",(xo=_o=_o||{})[xo.An=0]="__PRIVATE_Default",xo[xo.Dn=1]="__PRIVATE_Estimate",xo[xo.Pn=2]="__PRIVATE_Previous";var Ko,$o,Zo,ts=(hs.Cn=function(t,e){switch(t.serverTimestamps){case"estimate":return new hs(_o.Dn,e);case"previous":return new hs(_o.Pn,e);case"none":case void 0:return new hs(_o.An,e);default:return Gr("fromSnapshotOptions() called with invalid options.")}},hs),es=(us.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},us.prototype.kn=function(t){return jr(this.Vn!==t.Vn,"Default compareTo should not be used for values of same type."),Hr(this.Vn,t.Vn)},us),ns=(t(as,Zo=es),as.prototype.value=function(t){return null},as.prototype.isEqual=function(t){return t instanceof as},as.prototype.h=function(t){return t instanceof as?0:this.kn(t)},as.prototype.Nn=function(){return 4},as.On=new as,as),rs=(t(ss,$o=es),ss.prototype.value=function(t){return this.Ht},ss.prototype.isEqual=function(t){return t instanceof ss&&this.Ht===t.Ht},ss.prototype.h=function(t){return t instanceof ss?Hr(this.Ht,t.Ht):this.kn(t)},ss.prototype.Nn=function(){return 4},ss.of=function(t){return t?ss.Fn:ss.Un},ss.Fn=new ss(!0),ss.Un=new ss(!1),ss),is=(t(os,Ko=es),os.prototype.value=function(t){return this.Ht},os.prototype.h=function(t){return t instanceof os?(e=this.Ht)<(n=t.Ht)?-1:n<e?1:e===n?0:isNaN(e)?isNaN(n)?0:-1:1:this.kn(t);var e,n},os.prototype.Nn=function(){return 8},os);function os(t){var e=Ko.call(this)||this;return e.Ht=t,e.Vn=Do.bn,e}function ss(t){var e=$o.call(this)||this;return e.Ht=t,e.Vn=Do.gn,e}function as(){var t=Zo.call(this)||this;return t.Vn=Do.pn,t.Ht=null,t}function us(){}function hs(t,e){this.Sn=t,this.timestampsInSnapshots=e}function cs(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var fs,ls,ps,ds,ys,vs,ms,gs,ws,bs,Es,Is,Ns,Ts=(t(ra,Ns=is),ra.prototype.isEqual=function(t){return t instanceof ra&&cs(this.Ht,t.Ht)},ra),As=(t(na,Is=is),na.prototype.isEqual=function(t){return t instanceof na&&cs(this.Ht,t.Ht)},na.xn=new na(NaN),na.POSITIVE_INFINITY=new na(1/0),na.NEGATIVE_INFINITY=new na(-1/0),na),Ss=(t(ea,Es=es),ea.prototype.value=function(t){return this.Ht},ea.prototype.isEqual=function(t){return t instanceof ea&&this.Ht===t.Ht},ea.prototype.h=function(t){return t instanceof ea?Hr(this.Ht,t.Ht):this.kn(t)},ea.prototype.Nn=function(){return 2*this.Ht.length},ea),ks=(t(ta,bs=es),ta.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.Ht:this.Ht.toDate()},ta.prototype.isEqual=function(t){return t instanceof ta&&this.Ht.isEqual(t.Ht)},ta.prototype.h=function(t){return t instanceof ta?this.Ht.U(t.Ht):t instanceof Ds?-1:this.kn(t)},ta.prototype.Nn=function(){return 16},ta),Ds=(t(Zs,ws=es),Zs.prototype.value=function(t){return t&&t.Sn===_o.Dn?new ks(this.jn).value(t):t&&t.Sn===_o.Pn&&this.previousValue?this.previousValue.value(t):null},Zs.prototype.isEqual=function(t){return t instanceof Zs&&this.jn.isEqual(t.jn)},Zs.prototype.h=function(t){return t instanceof Zs?this.jn.U(t.jn):t instanceof ks?1:this.kn(t)},Zs.prototype.toString=function(){return"<ServerTimestamp localTime="+this.jn.toString()+">"},Zs.prototype.Nn=function(){return 16+(this.previousValue?this.previousValue.Nn():0)},Zs),Rs=(t($s,gs=es),$s.prototype.value=function(t){return this.Ht},$s.prototype.isEqual=function(t){return t instanceof $s&&this.Ht.isEqual(t.Ht)},$s.prototype.h=function(t){return t instanceof $s?this.Ht.U(t.Ht):this.kn(t)},$s.prototype.Nn=function(){return this.Ht.Ln()},$s),_s=(t(Ks,ms=es),Ks.prototype.value=function(t){return this.key},Ks.prototype.isEqual=function(t){return t instanceof Ks&&this.key.isEqual(t.key)&&this.s.isEqual(t.s)},Ks.prototype.h=function(t){if(t instanceof Ks){var e=this.s.h(t.s);return 0!==e?e:zi.G(this.key,t.key)}return this.kn(t)},Ks.prototype.Nn=function(){return this.s.projectId.length+this.s.database.length+this.key.toString().length},Ks),xs=(t(Qs,vs=es),Qs.prototype.value=function(t){return this.Ht},Qs.prototype.isEqual=function(t){return t instanceof Qs&&this.Ht.isEqual(t.Ht)},Qs.prototype.h=function(t){return t instanceof Qs?this.Ht.U(t.Ht):this.kn(t)},Qs.prototype.Nn=function(){return 16},Qs),Cs=(t(Xs,ys=es),Xs.mn=function(){return new Os(Xs.EMPTY.Ht)},Xs.prototype.value=function(n){var r={};return this.Ht.pt(function(t,e){r[t]=e.value(n)}),r},Xs.prototype.forEach=function(t){this.Ht.pt(t)},Xs.prototype.isEqual=function(t){if(t instanceof Xs){for(var e=this.Ht.bt(),n=t.Ht.bt();e.At()&&n.At();){var r=e.Rt(),i=n.Rt();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.At()&&!n.At()}return!1},Xs.prototype.h=function(t){if(t instanceof Xs){for(var e=this.Ht.bt(),n=t.Ht.bt();e.At()&&n.At();){var r=e.Rt(),i=n.Rt(),o=Hr(r.key,i.key)||r.value.h(i.value);if(o)return o}return Hr(e.At(),n.At())}return this.kn(t)},Xs.prototype.contains=function(t){return null!==this.field(t)},Xs.prototype.field=function(t){jr(!t.J(),"Can't get field of empty path");var e=this;return t.forEach(function(t){e=e instanceof Xs?e.Ht.get(t):null}),e},Xs.prototype.on=function(){var i=new ao(Hi.G);return this.Ht.forEach(function(t,e){var n=new Hi([t]);if(e instanceof Xs){var r=e.on().fields;r.J()?i=i.add(n):r.forEach(function(t){i=i.add(n.child(t))})}else i=i.add(n)}),To.Jt(i)},Xs.prototype.Nn=function(){var n=0;return this.Ht.pt(function(t,e){n+=t.length+e.Nn()}),n},Xs.prototype.toString=function(){return this.Ht.toString()},Xs.prototype.an=function(){return new Os(this.Ht)},Xs.EMPTY=new Xs(new Ji(Hr)),Xs),Os=(Ys.prototype.set=function(t,e){jr(!t.J(),"Cannot set field for empty path on ObjectValue");var n=t.Y();if(1===t.length)this.Ht=this.Ht.lt(n,e);else{var r=this.Ht.get(n),i=(r instanceof Cs?r:Cs.EMPTY).an().set(t.K(),e).fn();this.Ht=this.Ht.lt(n,i)}return this},Ys.prototype.delete=function(t){jr(!t.J(),"Cannot delete field for empty path on ObjectValue");var e=t.Y();if(1===t.length)this.Ht=this.Ht.remove(e);else{var n=this.Ht.get(e);if(n instanceof Cs){var r=n.an().delete(t.K()).fn();this.Ht=this.Ht.lt(t.Y(),r)}}return this},Ys.prototype.fn=function(){return new Cs(this.Ht)},Ys),Ps=(t(Ws,ds=es),Ws.prototype.value=function(e){return this.Ht.map(function(t){return t.value(e)})},Ws.prototype.contains=function(t){for(var e=0,n=this.Ht;e<n.length;e++)if(n[e].isEqual(t))return!0;return!1},Ws.prototype.forEach=function(t){this.Ht.forEach(t)},Ws.prototype.isEqual=function(t){if(t instanceof Ws){if(this.Ht.length!==t.Ht.length)return!1;for(var e=0;e<this.Ht.length;e++)if(!this.Ht[e].isEqual(t.Ht[e]))return!1;return!0}return!1},Ws.prototype.h=function(t){if(t instanceof Ws){for(var e=Math.min(this.Ht.length,t.Ht.length),n=0;n<e;n++){var r=this.Ht[n].h(t.Ht[n]);if(r)return r}return Hr(this.Ht.length,t.Ht.length)}return this.kn(t)},Ws.prototype.Nn=function(){return this.Ht.reduce(function(t,e){return t+e.Nn()},0)},Ws.prototype.toString=function(){return"["+this.Ht.map(function(t){return t.toString()}).join(",")+"]"},Ws),Ls=(Js.Bn=function(t,e){return zi.G(t.key,e.key)},Js),Ms=(t(zs,ps=Ls),zs.prototype.field=function(t){if(this.Mn)return this.Mn.field(t);this.qn||(this.qn=new Map);var e=t.nt(),n=this.qn.get(e);if(void 0===n){var r=this.Qn(t);n=void 0===r?null:this.converter(r),this.qn.set(e,n)}return n},zs.prototype.data=function(){var n=this;if(!this.Mn){var r=Cs.mn();yi(this.proto.fields||{},function(t,e){r.set(new Hi([t]),n.converter(e))}),this.Mn=r.fn(),this.qn=void 0}return this.Mn},zs.prototype.value=function(){return this.data().value()},zs.prototype.isEqual=function(t){return t instanceof zs&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.un===t.un&&this.hasCommittedMutations===t.hasCommittedMutations&&this.data().isEqual(t.data())},zs.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", {hasLocalMutations: "+this.un+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(zs.prototype,"hasPendingWrites",{get:function(){return this.un||this.hasCommittedMutations},enumerable:!0,configurable:!0}),zs.prototype.Qn=function(t){jr(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var e=this.proto.fields?this.proto.fields[t.Y()]:void 0,n=1;n<t.length;++n){if(!e||!e.mapValue||!e.mapValue.fields)return;e=e.mapValue.fields[t.get(n)]}return e},zs.Gn=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.h(i):Gr("Trying to compare documents on fields that don't exist")},zs),Us=(t(Hs,ls=Ls),Hs.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Hs.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),Hs.prototype.isEqual=function(t){return t instanceof Hs&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Hs),qs=(t(Bs,fs=Ls),Bs.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Bs.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),Bs.prototype.isEqual=function(t){return t instanceof Bs&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Bs),Vs=Number,Gs=Vs.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),js=Vs.MAX_SAFE_INTEGER||Math.pow(2,53)-1,Fs=Vs.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function Bs(){return null!==fs&&fs.apply(this,arguments)||this}function Hs(t,e,n){var r=ls.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function zs(t,e,n,r,i,o){var s=ps.call(this,t,e)||this;return s.Mn=r,s.proto=i,s.converter=o,jr(void 0!==s.Mn||void 0!==s.proto&&void 0!==s.converter,"If objectValue is not defined, proto and converter need to be set."),s.un=!!n.un,s.hasCommittedMutations=!!n.hasCommittedMutations,s}function Js(t,e){this.key=t,this.version=e}function Ws(t){var e=ds.call(this)||this;return e.Ht=t,e.Vn=Do.ArrayValue,e}function Ys(t){this.Ht=t}function Xs(t){var e=ys.call(this)||this;return e.Ht=t,e.Vn=Do.Rn,e}function Qs(t){var e=vs.call(this)||this;return e.Ht=t,e.Vn=Do.En,e}function Ks(t,e){var n=ms.call(this)||this;return n.s=t,n.key=e,n.Vn=Do.Tn,n}function $s(t){var e=gs.call(this)||this;return e.Ht=t,e.Vn=Do.In,e}function Zs(t,e){var n=ws.call(this)||this;return n.jn=t,n.previousValue=e,n.Vn=Do.yn,n}function ta(t){var e=bs.call(this)||this;return e.Ht=t,e.Vn=Do.yn,e}function ea(t){var e=Es.call(this)||this;return e.Ht=t,e.Vn=Do._n,e}function na(){return null!==Is&&Is.apply(this,arguments)||this}function ra(){return null!==Ns&&Ns.apply(this,arguments)||this}function ia(t){return null==t}function oa(t){return Fs(t)&&t<=js&&Gs<=t}var sa,aa,ua=(ha.prototype.canonicalId=function(){if(null===this.Wn){var t=this.path.nt();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";ia(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.Wn=t}return this.Wn},ha.prototype.toString=function(){var t=this.path.nt();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),ia(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},ha.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},ha.prototype.zn=function(){return zi.ht(this.path)&&null===this.collectionGroup&&0===this.filters.length},ha);function ha(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Wn=null}(aa=sa=sa||{}).Kn="F",aa.Hn="L";var ca,fa,la,pa,da,ya,va,ma,ga=(ja.ti=function(t){return new ja(t)},Object.defineProperty(ja.prototype,"orderBy",{get:function(){if(null===this.Xn){var t=this.ni(),e=this.ii();if(null!==t&&null===e)t.ut()?this.Xn=[Ra]:this.Xn=[new Da(t),Ra];else{jr(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.Xn=[]),r=0,i=this.Jn;r<i.length;r++){var o=i[r];this.Xn.push(o),o.field.ut()&&(n=!0)}if(!n){var s=0<this.Jn.length?this.Jn[this.Jn.length-1].dir:Sa.ASCENDING;this.Xn.push(s===Sa.ASCENDING?Ra:_a)}}}return this.Xn},enumerable:!0,configurable:!0}),ja.prototype.ei=function(t){jr(null==this.ni()||!(t instanceof ba)||!t.ri()||t.field.isEqual(this.ni()),"Query must only have one inequality field."),jr(!this.zn(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new ja(this.path,this.collectionGroup,this.Jn.slice(),e,this.limit,this.Yn,this.startAt,this.endAt)},ja.prototype.ui=function(t){jr(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.Jn.concat([t]);return new ja(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.Yn,this.startAt,this.endAt)},ja.prototype.si=function(t){return new ja(this.path,this.collectionGroup,this.Jn.slice(),this.filters.slice(),t,sa.Kn,this.startAt,this.endAt)},ja.prototype.oi=function(t){return new ja(this.path,this.collectionGroup,this.Jn.slice(),this.filters.slice(),t,sa.Hn,this.startAt,this.endAt)},ja.prototype.hi=function(t){return new ja(this.path,this.collectionGroup,this.Jn.slice(),this.filters.slice(),this.limit,this.Yn,t,this.endAt)},ja.prototype.ci=function(t){return new ja(this.path,this.collectionGroup,this.Jn.slice(),this.filters.slice(),this.limit,this.Yn,this.startAt,t)},ja.prototype.ai=function(t){return new ja(t,null,this.Jn.slice(),this.filters.slice(),this.limit,this.Yn,this.startAt,this.endAt)},ja.prototype.fi=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.Jn.length||1===this.Jn.length&&this.Jn[0].field.ut())},ja.prototype.canonicalId=function(){return this.li().canonicalId()+"|lt:"+this.Yn},ja.prototype.toString=function(){return"Query(target="+this.li().toString()+"; limitType="+this.Yn+")"},ja.prototype.isEqual=function(t){return this.li().isEqual(t.li())&&this.Yn===t.Yn},ja.prototype.di=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],s=o.compare(t,e);if(0!==s)return s;n=n||o.field.ut()}return jr(n,"orderBy used that doesn't compare on key field"),0},ja.prototype.matches=function(t){return this.vi(t)&&this.wi(t)&&this.mi(t)&&this.pi(t)},ja.prototype.gi=function(){return!ia(this.limit)&&this.Yn===sa.Kn},ja.prototype.bi=function(){return!ia(this.limit)&&this.Yn===sa.Hn},ja.prototype.ii=function(){return 0<this.Jn.length?this.Jn[0].field:null},ja.prototype.ni=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof ba&&n.ri())return n.field}return null},ja.prototype.yi=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof ba&&0<=t.indexOf(r.op))return r.op}return null},ja.prototype.zn=function(){return this.li().zn()},ja.prototype._i=function(){return null!==this.collectionGroup},ja.prototype.li=function(){if(!this.$n)if(this.Yn===sa.Kn)this.$n=new ua(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i=r.dir===Sa.DESCENDING?Sa.ASCENDING:Sa.DESCENDING;t.push(new Da(r.field,i))}var o=this.endAt?new ka(this.endAt.position,!this.endAt.before):null,s=this.startAt?new ka(this.startAt.position,!this.startAt.before):null;this.$n=new ua(this.path,this.collectionGroup,t,this.filters,this.limit,o,s)}return this.$n},ja.prototype.vi=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.ct(this.collectionGroup)&&this.path.$(e):zi.ht(this.path)?this.path.isEqual(e):this.path.Z(e)},ja.prototype.wi=function(t){for(var e=0,n=this.Jn;e<n.length;e++){var r=n[e];if(!r.field.ut()&&null===t.field(r.field))return!1}return!0},ja.prototype.mi=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},ja.prototype.pi=function(t){return!(this.startAt&&!this.startAt.Ii(this.orderBy,t)||this.endAt&&this.endAt.Ii(this.orderBy,t))},ja.prototype.Zn=function(t){jr(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},ja),wa=(Ga.it=function(t){switch(t){case"<":return Ga.LESS_THAN;case"<=":return Ga.LESS_THAN_OR_EQUAL;case"==":return Ga.EQUAL;case">=":return Ga.GREATER_THAN_OR_EQUAL;case">":return Ga.GREATER_THAN;case"array-contains":return Ga.ARRAY_CONTAINS;case"in":return Ga.IN;case"array-contains-any":return Ga.ARRAY_CONTAINS_ANY;default:return Gr("Unknown FieldFilter operator: "+t)}},Ga.prototype.toString=function(){return this.name},Ga.prototype.isEqual=function(t){return this.name===t.name},Ga.LESS_THAN=new Ga("<"),Ga.LESS_THAN_OR_EQUAL=new Ga("<="),Ga.EQUAL=new Ga("=="),Ga.GREATER_THAN=new Ga(">"),Ga.GREATER_THAN_OR_EQUAL=new Ga(">="),Ga.ARRAY_CONTAINS=new Ga("array-contains"),Ga.IN=new Ga("in"),Ga.ARRAY_CONTAINS_ANY=new Ga("array-contains-any"),Ga),ba=(t(Va,ma=function(){}),Va.create=function(t,e,n){if(t.ut())return e===wa.IN?(jr(n instanceof Ps,"Comparing on key with IN, but filter value not an ArrayValue"),jr(n.Ht.every(function(t){return t instanceof _s}),"Comparing on key with IN, but an array value was not a RefValue"),new Ia(t,n)):(jr(n instanceof _s,"Comparing on key, but filter value not a RefValue"),jr(e!==wa.ARRAY_CONTAINS&&e!==wa.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new Ea(t,e,n));if(n.isEqual(ns.On)){if(e!==wa.EQUAL)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new Va(t,e,n)}if(n.isEqual(As.xn)){if(e!==wa.EQUAL)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new Va(t,e,n)}return e===wa.ARRAY_CONTAINS?new Na(t,n):e===wa.IN?(jr(n instanceof Ps,"IN filter has invalid value: "+n.toString()),new Ta(t,n)):e===wa.ARRAY_CONTAINS_ANY?(jr(n instanceof Ps,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new Aa(t,n)):new Va(t,e,n)},Va.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.Vn===e.Vn&&this.Ti(e.h(this.value))},Va.prototype.Ti=function(t){switch(this.op){case wa.LESS_THAN:return t<0;case wa.LESS_THAN_OR_EQUAL:return t<=0;case wa.EQUAL:return 0===t;case wa.GREATER_THAN:return 0<t;case wa.GREATER_THAN_OR_EQUAL:return 0<=t;default:return Gr("Unknown FieldFilter operator: "+this.op)}},Va.prototype.ri=function(){return 0<=[wa.LESS_THAN,wa.LESS_THAN_OR_EQUAL,wa.GREATER_THAN,wa.GREATER_THAN_OR_EQUAL].indexOf(this.op)},Va.prototype.canonicalId=function(){return this.field.nt()+this.op.toString()+this.value.toString()},Va.prototype.isEqual=function(t){return t instanceof Va&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},Va.prototype.toString=function(){return this.field.nt()+" "+this.op+" "+this.value.value()},Va),Ea=(t(qa,va=ba),qa.prototype.matches=function(t){var e=this.value,n=zi.G(t.key,e.key);return this.Ti(n)},qa),Ia=(t(Ua,ya=ba),Ua.prototype.matches=function(e){return this.value.Ht.some(function(t){return e.key.isEqual(t.key)})},Ua),Na=(t(Ma,da=ba),Ma.prototype.matches=function(t){var e=t.field(this.field);return e instanceof Ps&&e.contains(this.value)},Ma),Ta=(t(La,pa=ba),La.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},La),Aa=(t(Pa,la=ba),Pa.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof Ps&&n.Ht.some(function(t){return e.value.contains(t)})},Pa),Sa=(Oa.prototype.toString=function(){return this.name},Oa.ASCENDING=new Oa("asc"),Oa.DESCENDING=new Oa("desc"),Oa),ka=(Ca.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},Ca.prototype.Ii=function(t,e){jr(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.ut())jr(o instanceof _s,"Bound has a non-key value where the key path is being used."),n=zi.G(o.key,e.key);else{var s=e.field(i.field);jr(null!==s,"Field should exist since document matched the orderBy already."),n=o.h(s)}if(i.dir===Sa.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},Ca.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},Ca),Da=(xa.prototype.compare=function(t,e){var n=this.Ei?Ms.Bn(t,e):Ms.Gn(this.field,t,e);switch(this.dir){case Sa.ASCENDING:return n;case Sa.DESCENDING:return-1*n;default:return Gr("Unknown direction: "+this.dir)}},xa.prototype.canonicalId=function(){return this.field.nt()+this.dir.toString()},xa.prototype.toString=function(){return this.field.nt()+" ("+this.dir+")"},xa.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},xa),Ra=new Da(Hi.st(),Sa.ASCENDING),_a=new Da(Hi.st(),Sa.DESCENDING);function xa(t,e){this.field=t,void 0===e&&(e=Sa.ASCENDING),this.dir=e,this.Ei=t.ut()}function Ca(t,e){this.position=t,this.before=e}function Oa(t){this.name=t}function Pa(t,e){var n=la.call(this,t,wa.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}function La(t,e){var n=pa.call(this,t,wa.IN,e)||this;return n.value=e,n}function Ma(t,e){return da.call(this,t,wa.ARRAY_CONTAINS,e)||this}function Ua(t,e){var n=ya.call(this,t,wa.IN,e)||this;return n.value=e,n}function qa(){return null!==va&&va.apply(this,arguments)||this}function Va(t,e,n){var r=ma.call(this)||this;return r.field=t,r.op=e,r.value=n,r}function Ga(t){this.name=t}function ja(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=sa.Kn),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.Jn=n,this.filters=r,this.limit=i,this.Yn=o,this.startAt=s,this.endAt=a,this.Xn=null,this.$n=null,this.startAt&&this.Zn(this.startAt),this.endAt&&this.Zn(this.endAt)}(fa=ca=ca||{})[fa.Ri=0]="__PRIVATE_RemoteStore",fa[fa.Ai=1]="__PRIVATE_SharedClientState";var Fa,Ba,Ha=(za.fromBase64String=function(t){return new za(Ju.t().atob(t))},za.fromUint8Array=function(t){return new za(Ja(t))},za.prototype.toBase64=function(){return Ju.t().btoa(this.Di)},za.prototype.toUint8Array=function(){return Wa(this.Di)},za.prototype.Nn=function(){return 2*this.Di.length},za.prototype.isEqual=function(t){return this.Di===t.Di},za.Pi=new za(""),za);function za(t){this.Di=t}function Ja(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}function Wa(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(Ba=Fa=Fa||{})[Ba.Si=0]="__PRIVATE_Listen",Ba[Ba.Ci=1]="__PRIVATE_ExistenceFilterMismatch",Ba[Ba.ki=2]="__PRIVATE_LimboResolution";var Ya,Xa,Qa=(Za.prototype.Oi=function(t){return new Za(this.target,this.targetId,this.Vi,t,this.Ni,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Za.prototype.Fi=function(t,e){return new Za(this.target,this.targetId,this.Vi,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Za.prototype.Ui=function(t){return new Za(this.target,this.targetId,this.Vi,this.sequenceNumber,this.Ni,t,this.resumeToken)},Za.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.Vi===t.Vi&&this.sequenceNumber===t.sequenceNumber&&this.Ni.isEqual(t.Ni)&&this.lastLimboFreeSnapshotVersion.isEqual(t.lastLimboFreeSnapshotVersion)&&this.resumeToken.isEqual(t.resumeToken)&&this.target.isEqual(t.target)},Za),Ka=($a.prototype.isEqual=function(t){return t&&t.count===this.count},$a);function $a(t){this.count=t}function Za(t,e,n,r,i,o,s){void 0===i&&(i=Gi.MIN),void 0===o&&(o=Gi.MIN),void 0===s&&(s=Ha.Pi),this.target=t,this.targetId=e,this.Vi=n,this.sequenceNumber=r,this.Ni=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function tu(t){switch(t){case Zr.OK:return Gr("Treated status OK as error");case Zr.CANCELLED:case Zr.UNKNOWN:case Zr.DEADLINE_EXCEEDED:case Zr.RESOURCE_EXHAUSTED:case Zr.INTERNAL:case Zr.UNAVAILABLE:case Zr.UNAUTHENTICATED:return!1;case Zr.INVALID_ARGUMENT:case Zr.NOT_FOUND:case Zr.ALREADY_EXISTS:case Zr.PERMISSION_DENIED:case Zr.FAILED_PRECONDITION:case Zr.ABORTED:case Zr.OUT_OF_RANGE:case Zr.UNIMPLEMENTED:case Zr.DATA_LOSS:return!0;default:return Gr("Unknown status code: "+t)}}function eu(t){if(void 0===t)return qr("GRPC error has no .code"),Zr.UNKNOWN;switch(t){case Ya.OK:return Zr.OK;case Ya.CANCELLED:return Zr.CANCELLED;case Ya.UNKNOWN:return Zr.UNKNOWN;case Ya.DEADLINE_EXCEEDED:return Zr.DEADLINE_EXCEEDED;case Ya.RESOURCE_EXHAUSTED:return Zr.RESOURCE_EXHAUSTED;case Ya.INTERNAL:return Zr.INTERNAL;case Ya.UNAVAILABLE:return Zr.UNAVAILABLE;case Ya.UNAUTHENTICATED:return Zr.UNAUTHENTICATED;case Ya.INVALID_ARGUMENT:return Zr.INVALID_ARGUMENT;case Ya.NOT_FOUND:return Zr.NOT_FOUND;case Ya.ALREADY_EXISTS:return Zr.ALREADY_EXISTS;case Ya.PERMISSION_DENIED:return Zr.PERMISSION_DENIED;case Ya.FAILED_PRECONDITION:return Zr.FAILED_PRECONDITION;case Ya.ABORTED:return Zr.ABORTED;case Ya.OUT_OF_RANGE:return Zr.OUT_OF_RANGE;case Ya.UNIMPLEMENTED:return Zr.UNIMPLEMENTED;case Ya.DATA_LOSS:return Zr.DATA_LOSS;default:return Gr("Unknown status code: "+t)}}(Xa=Ya=Ya||{})[Xa.OK=0]="OK",Xa[Xa.CANCELLED=1]="CANCELLED",Xa[Xa.UNKNOWN=2]="UNKNOWN",Xa[Xa.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Xa[Xa.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Xa[Xa.NOT_FOUND=5]="NOT_FOUND",Xa[Xa.ALREADY_EXISTS=6]="ALREADY_EXISTS",Xa[Xa.PERMISSION_DENIED=7]="PERMISSION_DENIED",Xa[Xa.UNAUTHENTICATED=16]="UNAUTHENTICATED",Xa[Xa.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Xa[Xa.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Xa[Xa.ABORTED=10]="ABORTED",Xa[Xa.OUT_OF_RANGE=11]="OUT_OF_RANGE",Xa[Xa.UNIMPLEMENTED=12]="UNIMPLEMENTED",Xa[Xa.INTERNAL=13]="INTERNAL",Xa[Xa.UNAVAILABLE=14]="UNAVAILABLE",Xa[Xa.DATA_LOSS=15]="DATA_LOSS";var nu=new Ji(zi.G);function ru(){return nu}function iu(){return ru()}var ou=new Ji(zi.G);function su(){return ou}var au=new Ji(zi.G);function uu(){return au}var hu=new ao(zi.G);function cu(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=hu,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var fu=new ao(Hr);function lu(){return fu}var pu,du,yu,vu,mu=(gu.Li=function(t){return new gu(t.G)},gu.prototype.has=function(t){return null!=this.xi.get(t)},gu.prototype.get=function(t){return this.xi.get(t)},gu.prototype.first=function(){return this.ji.vt()},gu.prototype.last=function(){return this.ji.wt()},gu.prototype.J=function(){return this.ji.J()},gu.prototype.indexOf=function(t){var e=this.xi.get(t);return e?this.ji.indexOf(e):-1},Object.defineProperty(gu.prototype,"size",{get:function(){return this.ji.size},enumerable:!0,configurable:!0}),gu.prototype.forEach=function(n){this.ji.pt(function(t,e){return n(t),!1})},gu.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.xi.lt(t.key,t),e.ji.lt(t,null))},gu.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.xi.remove(t),this.ji.remove(e)):this},gu.prototype.isEqual=function(t){if(!(t instanceof gu))return!1;if(this.size!==t.size)return!1;for(var e=this.ji.bt(),n=t.ji.bt();e.At();){var r=e.Rt().key,i=n.Rt().key;if(!r.isEqual(i))return!1}return!0},gu.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},gu.prototype.copy=function(t,e){var n=new gu;return n.G=this.G,n.xi=t,n.ji=e,n},gu);function gu(n){this.G=n?function(t,e){return n(t,e)||zi.G(t.key,e.key)}:function(t,e){return zi.G(t.key,e.key)},this.xi=su(),this.ji=new Ji(this.G)}(du=pu=pu||{})[du.Bi=0]="__PRIVATE_Added",du[du.Mi=1]="__PRIVATE_Removed",du[du.qi=2]="__PRIVATE_Modified",du[du.Qi=3]="__PRIVATE_Metadata",(vu=yu=yu||{})[vu.Gi=0]="__PRIVATE_Local",vu[vu.Wi=1]="__PRIVATE_Synced";function wu(t,e,n,r){this.ce=t,this.removedTargetIds=e,this.key=n,this.ae=r}function bu(t,e){this.targetId=t,this.fe=e}var Eu,Iu,Nu=(_u.prototype.track=function(t){var e=t.doc.key,n=this.zi.get(e);n?t.type!==pu.Bi&&n.type===pu.Qi?this.zi=this.zi.lt(e,t):t.type===pu.Qi&&n.type!==pu.Mi?this.zi=this.zi.lt(e,{type:n.type,doc:t.doc}):t.type===pu.qi&&n.type===pu.qi?this.zi=this.zi.lt(e,{type:pu.qi,doc:t.doc}):t.type===pu.qi&&n.type===pu.Bi?this.zi=this.zi.lt(e,{type:pu.Bi,doc:t.doc}):t.type===pu.Mi&&n.type===pu.Bi?this.zi=this.zi.remove(e):t.type===pu.Mi&&n.type===pu.qi?this.zi=this.zi.lt(e,{type:pu.Mi,doc:n.doc}):t.type===pu.Bi&&n.type===pu.Mi?this.zi=this.zi.lt(e,{type:pu.qi,doc:t.doc}):Gr("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.zi=this.zi.lt(e,t)},_u.prototype.Ki=function(){var n=[];return this.zi.pt(function(t,e){n.push(e)}),n},_u),Tu=(Ru.$i=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:pu.Bi,doc:t})}),new Ru(t,e,mu.Li(e),i,n,r,!0,!1)},Object.defineProperty(Ru.prototype,"hasPendingWrites",{get:function(){return!this.Ji.J()},enumerable:!0,configurable:!0}),Ru.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Yi===t.Yi&&this.Ji.isEqual(t.Ji)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.Hi.isEqual(t.Hi)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},Ru),Au=(Du.ee=function(t,e){var n,r=((n={})[t]=Su.re(t,e),n);return new Du(Gi.MIN,r,lu(),ru(),cu())},Du),Su=(ku.re=function(t,e){return new ku(Ha.Pi,e,cu(),cu(),cu())},ku);function ku(t,e,n,r,i){this.resumeToken=t,this.ue=e,this.se=n,this.oe=r,this.he=i}function Du(t,e,n,r,i){this.Ni=t,this.Zi=e,this.te=n,this.ne=r,this.ie=i}function Ru(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.Hi=n,this.docChanges=r,this.Ji=i,this.fromCache=o,this.Yi=s,this.Xi=a}function _u(){this.zi=new Ji(zi.G)}(Iu=Eu=Eu||{})[Iu.le=0]="__PRIVATE_NoChange",Iu[Iu.Bi=1]="__PRIVATE_Added",Iu[Iu.Mi=2]="__PRIVATE_Removed",Iu[Iu.de=3]="__PRIVATE_Current",Iu[Iu.ve=4]="__PRIVATE_Reset";function xu(t,e,n,r){void 0===n&&(n=Ha.Pi),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var Cu=(Object.defineProperty(Lu.prototype,"ue",{get:function(){return this.ge},enumerable:!0,configurable:!0}),Object.defineProperty(Lu.prototype,"resumeToken",{get:function(){return this.pe},enumerable:!0,configurable:!0}),Object.defineProperty(Lu.prototype,"ye",{get:function(){return 0!==this.we},enumerable:!0,configurable:!0}),Object.defineProperty(Lu.prototype,"_e",{get:function(){return this.be},enumerable:!0,configurable:!0}),Lu.prototype.Ie=function(t){0<t.Nn()&&(this.be=!0,this.pe=t)},Lu.prototype.Te=function(){var n=cu(),r=cu(),i=cu();return this.me.forEach(function(t,e){switch(e){case pu.Bi:n=n.add(t);break;case pu.qi:r=r.add(t);break;case pu.Mi:i=i.add(t);break;default:Gr("Encountered invalid change type: "+e)}}),new Su(this.pe,this.ge,n,r,i)},Lu.prototype.Ee=function(){this.be=!1,this.me=Uu()},Lu.prototype.Re=function(t,e){this.be=!0,this.me=this.me.lt(t,e)},Lu.prototype.Ae=function(t){this.be=!0,this.me=this.me.remove(t)},Lu.prototype.De=function(){this.we+=1},Lu.prototype.Pe=function(){this.we-=1},Lu.prototype.Se=function(){this.be=!0,this.ge=!0},Lu),Ou=(Pu.prototype.Fe=function(t){for(var e=0,n=t.ce;e<n.length;e++){var r=n[e];t.ae instanceof Ms?this.Ue(r,t.ae):t.ae instanceof Us&&this.xe(r,t.key,t.ae)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.xe(r,t.key,t.ae)},Pu.prototype.je=function(n){var r=this;this.Le(n,function(t){var e=r.Be(t);switch(n.state){case Eu.le:r.Me(t)&&e.Ie(n.resumeToken);break;case Eu.Bi:e.Pe(),e.ye||e.Ee(),e.Ie(n.resumeToken);break;case Eu.Mi:e.Pe(),e.ye||r.removeTarget(t),jr(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case Eu.de:r.Me(t)&&(e.Se(),e.Ie(n.resumeToken));break;case Eu.ve:r.Me(t)&&(r.qe(t),e.Ie(n.resumeToken));break;default:Gr("Unknown target watch change state: "+n.state)}})},Pu.prototype.Le=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):di(this.ke,e)},Pu.prototype.Qe=function(t){var e=t.targetId,n=t.fe.count,r=this.Ge(e);if(r){var i=r.target;if(i.zn())if(0===n){var o=new zi(i.path);this.xe(e,o,new Us(o,Gi.B()))}else jr(1===n,"Single document existence filter with count: "+n);else this.We(e)!==n&&(this.qe(e),this.Oe=this.Oe.add(e))}},Pu.prototype.ze=function(i){var o=this,s={};di(this.ke,function(t,e){var n=o.Ge(t);if(n){if(e.ue&&n.target.zn()){var r=new zi(n.target.path);null!==o.Ve.get(r)||o.Ke(t,r)||o.xe(t,r,new Us(r,i))}e._e&&(s[t]=e.Te(),e.Ee())}});var r=cu();this.Ne.forEach(function(t,e){var n=!0;e.Bt(function(t){var e=o.Ge(t);return!e||e.Vi===Fa.ki||(n=!1)}),n&&(r=r.add(t))});var t=new Au(i,s,this.Oe,this.Ve,r);return this.Ve=ru(),this.Ne=Mu(),this.Oe=new ao(Hr),t},Pu.prototype.Ue=function(t,e){if(this.Me(t)){var n=this.Ke(t,e.key)?pu.qi:pu.Bi;this.Be(t).Re(e.key,n),this.Ve=this.Ve.lt(e.key,e),this.Ne=this.Ne.lt(e.key,this.He(e.key).add(t))}},Pu.prototype.xe=function(t,e,n){if(this.Me(t)){var r=this.Be(t);this.Ke(t,e)?r.Re(e,pu.Mi):r.Ae(e),this.Ne=this.Ne.lt(e,this.He(e).delete(t)),n&&(this.Ve=this.Ve.lt(e,n))}},Pu.prototype.removeTarget=function(t){delete this.ke[t]},Pu.prototype.We=function(t){var e=this.Be(t).Te();return this.Ce.Je(t).size+e.se.size-e.he.size},Pu.prototype.De=function(t){this.Be(t).De()},Pu.prototype.Be=function(t){return this.ke[t]||(this.ke[t]=new Cu),this.ke[t]},Pu.prototype.He=function(t){var e=this.Ne.get(t);return e||(e=new ao(Hr),this.Ne=this.Ne.lt(t,e)),e},Pu.prototype.Me=function(t){var e=null!==this.Ge(t);return e||Ur("WatchChangeAggregator","Detected inactive target",t),e},Pu.prototype.Ge=function(t){var e=this.ke[t];return e&&e.ye?null:this.Ce.Ye(t)},Pu.prototype.qe=function(e){var n=this;jr(!this.ke[e].ye,"Should only reset active targets"),this.ke[e]=new Cu,this.Ce.Je(e).forEach(function(t){n.xe(e,t,null)})},Pu.prototype.Ke=function(t,e){return this.Ce.Je(t).has(e)},Pu);function Pu(t){this.Ce=t,this.ke={},this.Ve=ru(),this.Ne=Mu(),this.Oe=new ao(Hr)}function Lu(){this.we=0,this.me=Uu(),this.pe=Ha.Pi,this.ge=!1,this.be=!0}function Mu(){return new Ji(zi.G)}function Uu(){return new Ji(zi.G)}var qu,Vu,Gu=((qu={})[Sa.ASCENDING.name]="ASCENDING",qu[Sa.DESCENDING.name]="DESCENDING",qu),ju=((Vu={})[wa.LESS_THAN.name]="LESS_THAN",Vu[wa.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",Vu[wa.GREATER_THAN.name]="GREATER_THAN",Vu[wa.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",Vu[wa.EQUAL.name]="EQUAL",Vu[wa.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",Vu[wa.IN.name]="IN",Vu[wa.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",Vu),Fu=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Bu(t,e){jr(!ia(t),e+" is missing")}function Hu(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Gr("can't parse "+t)}var zu=(Yu.prototype.Xe=function(t){var e=void 0===t.code?Zr.UNKNOWN:eu(t.code);return new ti(e,t.message||"")},Yu.prototype.$e=function(t){return this.options.Ze||ia(t)?t:{value:t}},Yu.prototype.tr=function(t){var e;return ia(e="object"==typeof t?t.value:t)?null:e},Yu.prototype.q=function(t){return this.options.Ze?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},Yu.prototype.L=function(t){if("string"==typeof t)return this.nr(t);jr(!!t,"Cannot deserialize null or undefined timestamp.");var e=Hu(t.seconds||"0"),n=t.nanos||0;return new Vi(e,n)},Yu.prototype.nr=function(t){var e=0,n=Fu.exec(t);if(jr(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new Vi(o,e)},Yu.prototype.ir=function(t){return this.options.Ze?t.toBase64():t.toUint8Array()},Yu.prototype.er=function(t){return this.options.Ze?(jr(void 0===t||"string"==typeof t,"value must be undefined or a string when using proto3 Json"),Ha.fromBase64String(t||"")):(jr(void 0===t||t instanceof Uint8Array,"value must be undefined or Uint8Array"),Ha.fromUint8Array(t||new Uint8Array))},Yu.prototype.rr=function(t){return"string"==typeof t?(jr(this.options.Ze,"Expected bytes to be passed in as Uint8Array, but got a string instead."),eh.fromBase64String(t)):(jr(!this.options.Ze,"Expected bytes to be passed in as Uint8Array, but got a string instead."),eh.fromUint8Array(t))},Yu.prototype.toVersion=function(t){return this.q(t.q())},Yu.prototype.fromVersion=function(t){return jr(!!t,"Trying to deserialize version that isn't set"),Gi.L(this.L(t))},Yu.prototype.ur=function(t,e){return this.sr(t).child("documents").child(e).nt()},Yu.prototype.or=function(t){var e=Fi.it(t);return jr(this.hr(e),"Tried to deserialize invalid key "+e.toString()),e},Yu.prototype.cr=function(t){return this.ur(this.s,t.path)},Yu.prototype.ar=function(t){var e=this.or(t);return jr(e.get(1)===this.s.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.s.projectId),jr(!e.get(3)&&!this.s.database||e.get(3)===this.s.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.s.database),new zi(this.lr(e))},Yu.prototype.dr=function(t){return this.ur(this.s,t)},Yu.prototype.vr=function(t){var e=this.or(t);return 4===e.length?Fi.et:this.lr(e)},Object.defineProperty(Yu.prototype,"wr",{get:function(){return new Fi(["projects",this.s.projectId,"databases",this.s.database]).nt()},enumerable:!0,configurable:!0}),Yu.prototype.sr=function(t){return new Fi(["projects",t.projectId,"databases",t.database])},Yu.prototype.lr=function(t){return jr(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.K(5)},Yu.prototype.hr=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},Yu.prototype.mr=function(t){if(t instanceof ns)return{nullValue:"NULL_VALUE"};if(t instanceof rs)return{booleanValue:t.value()};if(t instanceof Ts)return{integerValue:""+t.value()};if(t instanceof As){var e=t.value();if(this.options.Ze){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof Ss?{stringValue:t.value()}:t instanceof Cs?{mapValue:this.pr(t)}:t instanceof Ps?{arrayValue:this.gr(t)}:t instanceof ks?{timestampValue:this.q(t.Ht)}:t instanceof xs?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Rs?{bytesValue:this.ir(t.value())}:t instanceof _s?{referenceValue:this.ur(t.s,t.key.path)}:Gr("Unknown FieldValue "+JSON.stringify(t))},Yu.prototype.br=function(t){var e=this;if("nullValue"in t)return ns.On;if("booleanValue"in t)return rs.of(t.booleanValue);if("integerValue"in t)return new Ts(Hu(t.integerValue));if("doubleValue"in t){if(this.options.Ze){if("NaN"===t.doubleValue)return As.xn;if("Infinity"===t.doubleValue)return As.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return As.NEGATIVE_INFINITY}return new As(t.doubleValue)}if("stringValue"in t)return new Ss(t.stringValue);if("mapValue"in t)return this.yr(t.mapValue.fields||{});if("arrayValue"in t){Bu(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new Ps(n.map(function(t){return e.br(t)}))}if("timestampValue"in t)return Bu(t.timestampValue,"timestampValue"),new ks(this.L(t.timestampValue));if("geoPointValue"in t){Bu(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new xs(new Ui(r,i))}if("bytesValue"in t){Bu(t.bytesValue,"bytesValue");var o=this.rr(t.bytesValue);return new Rs(o)}if("referenceValue"in t){Bu(t.referenceValue,"referenceValue");var s=this.or(t.referenceValue),a=new Kr(s.get(1),s.get(3)),u=new zi(this.lr(s));return new _s(a,u)}return Gr("Unknown Value proto "+JSON.stringify(t))},Yu.prototype._r=function(t,e){return{name:this.cr(t),fields:this.Ir(e)}},Yu.prototype.Tr=function(t){return jr(!t.un,"Can't serialize documents with mutations."),{name:this.cr(t.key),fields:this.Ir(t.data()),updateTime:this.q(t.version.q())}},Yu.prototype.Er=function(t,e){var n=this,r=this.ar(t.name),i=this.fromVersion(t.updateTime);return new Ms(r,i,{hasCommittedMutations:!!e},void 0,t,function(t){return n.br(t)})},Yu.prototype.Ir=function(t){var n=this,r={};return t.forEach(function(t,e){r[t]=n.mr(e)}),r},Yu.prototype.yr=function(t){var n=this,e=t,r=Cs.mn();return yi(e,function(t,e){r.set(new Hi([t]),n.br(e))}),r.fn()},Yu.prototype.pr=function(t){return{fields:this.Ir(t)}},Yu.prototype.gr=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.mr(t))}),{values:n}},Yu.prototype.Rr=function(t){var e=this;jr(!!t.found,"Tried to deserialize a found document from a missing document."),Bu(t.found.name,"doc.found.name"),Bu(t.found.updateTime,"doc.found.updateTime");var n=this.ar(t.found.name),r=this.fromVersion(t.found.updateTime);return new Ms(n,r,{},void 0,t.found,function(t){return e.br(t)})},Yu.prototype.Ar=function(t){jr(!!t.missing,"Tried to deserialize a missing document from a found document."),jr(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.ar(t.missing),n=this.fromVersion(t.readTime);return new Us(e,n)},Yu.prototype.Dr=function(t){return"found"in t?this.Rr(t):"missing"in t?this.Ar(t):Gr("invalid batch get response: "+JSON.stringify(t))},Yu.prototype.Pr=function(t){switch(t){case Eu.Bi:return"ADD";case Eu.de:return"CURRENT";case Eu.le:return"NO_CHANGE";case Eu.Mi:return"REMOVE";case Eu.ve:return"RESET";default:return Gr("Unknown WatchTargetChangeState: "+t)}},Yu.prototype.Sr=function(t){if(t instanceof bu)return{filter:{count:t.fe.count,targetId:t.targetId}};if(t instanceof wu){if(t.ae instanceof Ms){var e=t.ae;return{documentChange:{document:{name:this.cr(e.key),fields:this.Ir(e.data()),updateTime:this.toVersion(e.version)},targetIds:t.ce,removedTargetIds:t.removedTargetIds}}}if(t.ae instanceof Us)return e=t.ae,{documentDelete:{document:this.cr(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.ae)return{documentRemove:{document:this.cr(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof xu){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return Ya.OK;switch(t){case Zr.OK:return Ya.OK;case Zr.CANCELLED:return Ya.CANCELLED;case Zr.UNKNOWN:return Ya.UNKNOWN;case Zr.DEADLINE_EXCEEDED:return Ya.DEADLINE_EXCEEDED;case Zr.RESOURCE_EXHAUSTED:return Ya.RESOURCE_EXHAUSTED;case Zr.INTERNAL:return Ya.INTERNAL;case Zr.UNAVAILABLE:return Ya.UNAVAILABLE;case Zr.UNAUTHENTICATED:return Ya.UNAUTHENTICATED;case Zr.INVALID_ARGUMENT:return Ya.INVALID_ARGUMENT;case Zr.NOT_FOUND:return Ya.NOT_FOUND;case Zr.ALREADY_EXISTS:return Ya.ALREADY_EXISTS;case Zr.PERMISSION_DENIED:return Ya.PERMISSION_DENIED;case Zr.FAILED_PRECONDITION:return Ya.FAILED_PRECONDITION;case Zr.ABORTED:return Ya.ABORTED;case Zr.OUT_OF_RANGE:return Ya.OUT_OF_RANGE;case Zr.UNIMPLEMENTED:return Ya.UNIMPLEMENTED;case Zr.DATA_LOSS:return Ya.DATA_LOSS;default:return Gr("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.Pr(t.state),targetIds:t.targetIds,resumeToken:this.ir(t.resumeToken),cause:n}}}return Gr("Unrecognized watch change: "+JSON.stringify(t))},Yu.prototype.Cr=function(t){var e,n=this;if("targetChange"in t){Bu(t.targetChange,"targetChange");var r=this.kr(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=this.er(t.targetChange.resumeToken),s=t.targetChange.cause,a=s&&this.Xe(s);e=new xu(r,i,o,a||null)}else if("documentChange"in t){Bu(t.documentChange,"documentChange");var u=t.documentChange;Bu(u.document,"documentChange.name"),Bu(u.document.name,"documentChange.document.name"),Bu(u.document.updateTime,"documentChange.document.updateTime");var h=this.ar(u.document.name),c=this.fromVersion(u.document.updateTime),f=new Ms(h,c,{},void 0,u.document,function(t){return n.br(t)}),l=u.targetIds||[],p=u.removedTargetIds||[];e=new wu(l,p,f.key,f)}else if("documentDelete"in t){Bu(t.documentDelete,"documentDelete");var d=t.documentDelete;Bu(d.document,"documentDelete.document"),h=this.ar(d.document),c=d.readTime?this.fromVersion(d.readTime):Gi.B(),f=new Us(h,c),p=d.removedTargetIds||[],e=new wu([],p,f.key,f)}else if("documentRemove"in t){Bu(t.documentRemove,"documentRemove");var y=t.documentRemove;Bu(y.document,"documentRemove"),h=this.ar(y.document),p=y.removedTargetIds||[],e=new wu([],p,h,null)}else{if(!("filter"in t))return Gr("Unknown change type "+JSON.stringify(t));Bu(t.filter,"filter");var v=t.filter;Bu(v.targetId,"filter.targetId");var m=v.count||0,g=new Ka(m),w=v.targetId;e=new bu(w,g)}return e},Yu.prototype.kr=function(t){return"NO_CHANGE"===t?Eu.le:"ADD"===t?Eu.Bi:"REMOVE"===t?Eu.Mi:"CURRENT"===t?Eu.de:"RESET"===t?Eu.ve:Gr("Got unexpected TargetChange.state: "+t)},Yu.prototype.Vr=function(t){if(!("targetChange"in t))return Gi.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?Gi.MIN:e.readTime?this.fromVersion(e.readTime):Gi.MIN},Yu.prototype.Nr=function(t){var e,n=this;if(t instanceof Vo)e={update:this._r(t.key,t.value)};else if(t instanceof Fo)e={delete:this.cr(t.key)};else if(t instanceof Go)e={update:this._r(t.key,t.data),updateMask:this.Or(t.on)};else if(t instanceof jo)e={transform:{document:this.cr(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.Fr(t)})}};else{if(!(t instanceof Bo))return Gr("Unknown mutation type "+t.type);e={verify:this.cr(t.key)}}return t.rn.tn||(e.currentDocument=this.Ur(t.rn)),e},Yu.prototype.xr=function(t){var e=this,n=t.currentDocument?this.jr(t.currentDocument):Uo.NONE;if(t.update){Bu(t.update.name,"name");var r=this.ar(t.update.name),i=this.yr(t.update.fields||{});if(t.updateMask){var o=this.Lr(t.updateMask);return new Go(r,i,o,n)}return new Vo(r,i,n)}if(t.delete)return r=this.ar(t.delete),new Fo(r,n);if(t.transform){r=this.ar(t.transform.document);var s=t.transform.fieldTransforms.map(function(t){return e.Br(t)});return jr(!0===n.exists,'Transforms only support precondition "exists == true"'),new jo(r,s)}return t.verify?(r=this.ar(t.verify),new Bo(r,n)):Gr("unknown mutation proto: "+JSON.stringify(t))},Yu.prototype.Ur=function(t){return jr(!t.tn,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Gr("Unknown precondition")},Yu.prototype.jr=function(t){return void 0!==t.updateTime?Uo.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Uo.exists(t.exists):Uo.NONE},Yu.prototype.Mr=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);r.isEqual(Gi.MIN)&&(r=this.fromVersion(e));var i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map(function(t){return n.br(t)})),new Eo(r,i)},Yu.prototype.qr=function(t,e){var n=this;return t&&0<t.length?(jr(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.Mr(t,e)})):[]},Yu.prototype.Fr=function(t){var e=this,n=t.transform;if(n instanceof ho)return{fieldPath:t.field.nt(),setToServerValue:"REQUEST_TIME"};if(n instanceof co)return{fieldPath:t.field.nt(),appendMissingElements:{values:n.elements.map(function(t){return e.mr(t)})}};if(n instanceof fo)return{fieldPath:t.field.nt(),removeAllFromArray:{values:n.elements.map(function(t){return e.mr(t)})}};if(n instanceof lo)return{fieldPath:t.field.nt(),increment:this.mr(n.Kt)};throw Gr("Unknown transform: "+t.transform)},Yu.prototype.Br=function(t){var e=this,n=null;if("setToServerValue"in t)jr("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=ho.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new co(r.map(function(t){return e.br(t)}))}else if("removeAllFromArray"in t)r=t.removeAllFromArray.values||[],n=new fo(r.map(function(t){return e.br(t)}));else if("increment"in t){var i=this.br(t.increment);jr(i instanceof is,"NUMERIC_ADD transform requires a NumberValue"),n=new lo(i)}else Gr("Unknown transform proto: "+JSON.stringify(t));var o=Hi.ot(t.fieldPath);return new Ao(o,n)},Yu.prototype.Qr=function(t){return{documents:[this.dr(t.path)]}},Yu.prototype.Gr=function(t){var e=t.documents.length;jr(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return ga.ti(this.vr(n)).li()},Yu.prototype.Wr=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(jr(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.dr(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(jr(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.dr(n.H()),e.structuredQuery.from=[{collectionId:n.X()}]);var r=this.zr(t.filters);r&&(e.structuredQuery.where=r);var i=this.Kr(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.$e(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.Hr(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.Hr(t.endAt)),e},Yu.prototype.Jr=function(t){var e=this.vr(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){jr(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=this.Yr(n.where));var a=[];n.orderBy&&(a=this.Xr(n.orderBy));var u=null;n.limit&&(u=this.tr(n.limit));var h=null;n.startAt&&(h=this.$r(n.startAt));var c=null;return n.endAt&&(c=this.$r(n.endAt)),new ga(e,i,a,s,u,sa.Kn,h,c).li()},Yu.prototype.Zr=function(t){var e=this.tu(t.Vi);return null==e?null:{"goog-listen-tags":e}},Yu.prototype.tu=function(t){switch(t){case Fa.Si:return null;case Fa.Ci:return"existence-filter-mismatch";case Fa.ki:return"limbo-document";default:return Gr("Unrecognized query purpose: "+t)}},Yu.prototype.li=function(t){var e,n=t.target;return(e=n.zn()?{documents:this.Qr(n)}:{query:this.Wr(n)}).targetId=t.targetId,0<t.resumeToken.Nn()&&(e.resumeToken=this.ir(t.resumeToken)),e},Yu.prototype.zr=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof ba?e.nu(t):Gr("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},Yu.prototype.Yr=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.iu(t)]:void 0!==t.fieldFilter?[this.eu(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.Yr(t)}).reduce(function(t,e){return t.concat(e)}):Gr("Unknown filter: "+JSON.stringify(t)):[]},Yu.prototype.Kr=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.ru(t)})},Yu.prototype.Xr=function(t){var e=this;return t.map(function(t){return e.uu(t)})},Yu.prototype.Hr=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.mr(t)})}},Yu.prototype.$r=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.br(t)});return new ka(r,n)},Yu.prototype.su=function(t){return Gu[t.name]},Yu.prototype.ou=function(t){switch(t){case"ASCENDING":return Sa.ASCENDING;case"DESCENDING":return Sa.DESCENDING;default:return}},Yu.prototype.hu=function(t){return ju[t.name]},Yu.prototype.cu=function(t){switch(t){case"EQUAL":return wa.EQUAL;case"GREATER_THAN":return wa.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return wa.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return wa.LESS_THAN;case"LESS_THAN_OR_EQUAL":return wa.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return wa.ARRAY_CONTAINS;case"IN":return wa.IN;case"ARRAY_CONTAINS_ANY":return wa.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Gr("Unspecified operator");default:return Gr("Unknown operator")}},Yu.prototype.au=function(t){return{fieldPath:t.nt()}},Yu.prototype.fu=function(t){return Hi.ot(t.fieldPath)},Yu.prototype.ru=function(t){return{field:this.au(t.field),direction:this.su(t.dir)}},Yu.prototype.uu=function(t){return new Da(this.fu(t.field),this.ou(t.direction))},Yu.prototype.eu=function(t){return ba.create(this.fu(t.fieldFilter.field),this.cu(t.fieldFilter.op),this.br(t.fieldFilter.value))},Yu.prototype.nu=function(t){if(t.op===wa.EQUAL){if(t.value.isEqual(As.xn))return{unaryFilter:{field:this.au(t.field),op:"IS_NAN"}};if(t.value.isEqual(ns.On))return{unaryFilter:{field:this.au(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.au(t.field),op:this.hu(t.op),value:this.mr(t.value)}}},Yu.prototype.iu=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fu(t.unaryFilter.field);return ba.create(e,wa.EQUAL,As.xn);case"IS_NULL":var n=this.fu(t.unaryFilter.field);return ba.create(n,wa.EQUAL,ns.On);case"OPERATOR_UNSPECIFIED":return Gr("Unspecified filter");default:return Gr("Unknown filter")}},Yu.prototype.Or=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.nt())}),{fieldPaths:e}},Yu.prototype.Lr=function(t){var e=(t.fieldPaths||[]).map(function(t){return Hi.ot(t)});return To.Yt(e)},Yu),Ju=(Wu.lu=function(t){Wu.platform&&Gr("Platform already defined"),Wu.platform=t},Wu.t=function(){return Wu.platform||Gr("Platform not set"),Wu.platform},Wu);function Wu(){}function Yu(t,e){this.s=t,this.options=e}function Xu(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new ti(Zr.INVALID_ARGUMENT,t)}return n.prototype=t.prototype,Object.assign(n,t),n}function Qu(){if("undefined"==typeof Uint8Array)throw new ti(Zr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Ku(){if(!Ju.t().du)throw new ti(Zr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}function $u(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}var Zu,th,eh=(oh.fromBase64String=function(t){gi("Blob.fromBase64String",arguments,1),Ei("Blob.fromBase64String","string",1,t),Ku();try{return new oh(Ju.t().atob(t))}catch(t){throw new ti(Zr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},oh.fromUint8Array=function(t){if(gi("Blob.fromUint8Array",arguments,1),Qu(),!(t instanceof Uint8Array))throw xi("Blob.fromUint8Array","Uint8Array",1,t);return new oh(Ja(t))},oh.prototype.toBase64=function(){return gi("Blob.toBase64",arguments,0),Ku(),Ju.t().btoa(this.Di)},oh.prototype.toUint8Array=function(){return gi("Blob.toUint8Array",arguments,0),Qu(),Wa(this.Di)},oh.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},oh.prototype.isEqual=function(t){return this.Di===t.Di},oh.prototype.Ln=function(){return 2*this.Di.length},oh.prototype.U=function(t){return Hr(this.Di,t.Di)},oh),nh=Xu(eh,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),rh=(ih.prototype.wu=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},ih.prototype.next=function(){var t=++this.previousValue;return this.mu&&this.mu(t),t},ih.gu=-1,ih);function ih(t,e){var n=this;this.previousValue=t,e&&(e.vu=function(t){return n.wu(t)},this.mu=function(t){return e.pu(t)})}function oh(t){Ku(),this.Di=t}(th=Zu=Zu||{}).bu="all",th.yu="listen_stream_idle",th._u="listen_stream_connection_backoff",th.Iu="write_stream_idle",th.Tu="write_stream_connection_backoff",th.Eu="online_state_timeout",th.Ru="client_metadata_refresh",th.Au="lru_garbage_collection",th.Du="retry_transaction";var sh=(ph.Nu=function(t,e,n,r,i){var o=new ph(t,e,Date.now()+n,r,i);return o.start(n),o},ph.prototype.start=function(t){var e=this;this.Ou=setTimeout(function(){return e.Fu()},t)},ph.prototype.Uu=function(){return this.Fu()},ph.prototype.cancel=function(t){null!==this.Ou&&(this.clearTimeout(),this.Vu.reject(new ti(Zr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},ph.prototype.Fu=function(){var e=this;this.Pu.xu(function(){return null!==e.Ou?(e.clearTimeout(),e.op().then(function(t){return e.Vu.resolve(t)})):Promise.resolve()})},ph.prototype.clearTimeout=function(){null!==this.Ou&&(this.ku(this),clearTimeout(this.Ou),this.Ou=null)},ph),ah=(Object.defineProperty(lh.prototype,"Gu",{get:function(){return this.Lu},enumerable:!0,configurable:!0}),lh.prototype.xu=function(t){this.enqueue(t)},lh.prototype.Wu=function(t){this.zu(),this.Ku(t)},lh.prototype.Hu=function(t){return this.zu(),this.Ku(t)},lh.prototype.Ju=function(e){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.zu(),this.Lu?[3,2]:(this.Lu=!0,[4,this.Hu(e)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},lh.prototype.enqueue=function(t){return this.zu(),this.Lu?new Promise(function(t){}):this.Ku(t)},lh.prototype.Ku=function(t){var n=this,e=this.ju.then(function(){return n.qu=!0,t().catch(function(t){n.Mu=t,n.qu=!1;var e=t.stack||t.message||"";throw qr("INTERNAL UNHANDLED ERROR: ",e),e.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return n.qu=!1,t})});return this.ju=e},lh.prototype.Yu=function(t,e,n){var r=this;this.zu(),jr(0<=e,"Attempted to schedule an operation with a negative delay of "+e),-1<this.Qu.indexOf(t)&&(e=0);var i=sh.Nu(this,t,e,n,function(t){return r.Xu(t)});return this.Bu.push(i),i},lh.prototype.zu=function(){this.Mu&&Gr("AsyncQueue is already failed: "+(this.Mu.stack||this.Mu.message))},lh.prototype.$u=function(){jr(this.qu,"verifyOpInProgress() called when no op in progress on this queue.")},lh.prototype.Zu=function(){return this.Hu(function(){return Promise.resolve()})},lh.prototype.ts=function(t){for(var e=0,n=this.Bu;e<n.length;e++)if(n[e].Su===t)return!0;return!1},lh.prototype.ns=function(r){var i=this;return this.Zu().then(function(){jr(r===Zu.bu||i.ts(r),"Attempted to drain to missing operation "+r),i.Bu.sort(function(t,e){return t.Cu-e.Cu});for(var t=0,e=i.Bu;t<e.length;t++){var n=e[t];if(n.Uu(),r!==Zu.bu&&n.Su===r)break}return i.Zu()})},lh.prototype.es=function(t){this.Qu.push(t)},lh.prototype.Xu=function(t){var e=this.Bu.indexOf(t);jr(0<=e,"Delayed operation not found."),this.Bu.splice(e,1)},lh),uh="",hh="",ch="",fh="";function lh(){this.ju=Promise.resolve(),this.Lu=!1,this.Bu=[],this.Mu=null,this.qu=!1,this.Qu=[]}function ph(t,e,n,r,i){this.Pu=t,this.Su=e,this.Cu=n,this.op=r,this.ku=i,this.Vu=new $u,this.then=this.Vu.promise.then.bind(this.Vu.promise),this.catch=this.Vu.promise.catch.bind(this.Vu.promise),this.Vu.promise.catch(function(t){})}function dh(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=vh(e)),e=yh(t.get(n),e);return vh(e)}function yh(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=uh+ch;break;case uh:n+=uh+fh;break;default:n+=o}}return n}function vh(t){return t+uh+hh}function mh(t){var e=t.length;if(jr(2<=e,"Invalid path "+t),2===e)return jr(t.charAt(0)===uh&&t.charAt(1)===hh,"Non-empty path "+t+" had length 2"),Fi.et;for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf(uh,o);switch((s<0||n<s)&&Gr('Invalid encoded resource path: "'+t+'"'),t.charAt(s+1)){case hh:var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case ch:i+=t.substring(o,s),i+="\0";break;case fh:i+=t.substring(o,s+1);break;default:Gr('Invalid encoded resource path: "'+t+'"')}o=s+2}return new Fi(r)}var gh=(Fh.prototype.Wt=function(t,e,n){e&&jr(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.rs;jr(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var s=r[i];e=o.Wt(e,s)}}return e},Fh.prototype.Gt=function(t,e){e&&jr(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(a=r[n]).key.isEqual(t)&&(e=a.Gt(e,e,this.jn));for(var i=e,o=0,s=this.mutations;o<s.length;o++){var a;(a=s[o]).key.isEqual(t)&&(e=a.Gt(e,i,this.jn))}return e},Fh.prototype.us=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.Gt(t.key,n.get(t.key));e&&(i=i.lt(t.key,e))}),i},Fh.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},cu())},Fh.prototype.isEqual=function(t){return this.batchId===t.batchId&&zr(this.mutations,t.mutations)&&zr(this.baseMutations,t.baseMutations)},Fh),wh=(jh.from=function(t,e,n,r){jr(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=uu(),o=t.mutations,s=0;s<o.length;s++)i=i.lt(o[s].key,n[s].version);return new jh(t,e,n,r,i)},jh),bh=(Gh.prototype.J=function(){return this.hs.J()},Gh.prototype.fs=function(t,e){var n=new Eh(t,e);this.hs=this.hs.add(n),this.cs=this.cs.add(n)},Gh.prototype.ls=function(t,e){var n=this;t.forEach(function(t){return n.fs(t,e)})},Gh.prototype.ds=function(t,e){this.vs(new Eh(t,e))},Gh.prototype.ws=function(t,e){var n=this;t.forEach(function(t){return n.ds(t,e)})},Gh.prototype.ms=function(t){var e=this,n=zi.EMPTY,r=new Eh(n,t),i=new Eh(n,t+1),o=[];return this.cs.Lt([r,i],function(t){e.vs(t),o.push(t.key)}),o},Gh.prototype.ps=function(){var e=this;this.hs.forEach(function(t){return e.vs(t)})},Gh.prototype.vs=function(t){this.hs=this.hs.delete(t),this.cs=this.cs.delete(t)},Gh.prototype.gs=function(t){var e=zi.EMPTY,n=new Eh(e,t),r=new Eh(e,t+1),i=cu();return this.cs.Lt([n,r],function(t){i=i.add(t.key)}),i},Gh.prototype.bs=function(t){var e=new Eh(t,0),n=this.hs.Mt(e);return null!==n&&t.isEqual(n.key)},Gh),Eh=(Vh.Bn=function(t,e){return zi.G(t.key,e.key)||Hr(t.ys,e.ys)},Vh.as=function(t,e){return Hr(t.ys,e.ys)||zi.G(t.key,e.key)},Vh),Ih=(qh.prototype.get=function(t){var e=this._s(t),n=this.Is[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(s.isEqual(t))return a}},qh.prototype.has=function(t){return void 0!==this.get(t)},qh.prototype.set=function(t,e){var n=this._s(t),r=this.Is[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.Is[n]=[[t,e]]},qh.prototype.delete=function(t){var e=this._s(t),n=this.Is[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.Is[e]:n.splice(r,1),!0;return!1},qh.prototype.forEach=function(a){yi(this.Is,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];a(o,s)}})},qh.prototype.J=function(){return vi(this.Is)},qh),Nh=(Uh.prototype.catch=function(t){return this.next(void 0,t)},Uh.prototype.next=function(r,i){var o=this;return this.As&&Gr("Called next() or catch() twice for PersistencePromise"),this.As=!0,this.Rs?this.error?this.Ds(i,this.error):this.Ps(r,this.result):new Uh(function(e,n){o.Ts=function(t){o.Ps(r,t).next(e,n)},o.Es=function(t){o.Ds(i,t).next(e,n)}})},Uh.prototype.Ss=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Uh.prototype.Cs=function(t){try{var e=t();return e instanceof Uh?e:Uh.resolve(e)}catch(t){return Uh.reject(t)}},Uh.prototype.Ps=function(t,e){return t?this.Cs(function(){return t(e)}):Uh.resolve(e)},Uh.prototype.Ds=function(t,e){return t?this.Cs(function(){return t(e)}):Uh.reject(e)},Uh.resolve=function(n){return new Uh(function(t,e){t(n)})},Uh.reject=function(n){return new Uh(function(t,e){e(n)})},Uh.ks=function(t){return new Uh(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Uh.Vs=function(t){for(var n=Uh.resolve(!1),e=function(e){n=n.next(function(t){return t?Uh.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},Uh.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.ks(i)},Uh),Th=(Object.defineProperty(Mh.prototype,"readTime",{get:function(){return jr(void 0!==this.Fs,"Read time is not set. All removeEntry() calls must include a readTime if `trackRemovals` is used."),this.Fs},set:function(t){jr(void 0===this.Fs||this.Fs.isEqual(t),"All changes in a RemoteDocumentChangeBuffer must have the same read time"),this.Fs=t},enumerable:!0,configurable:!0}),Mh.prototype.Us=function(t,e){this.xs(),this.readTime=e,this.Ns.set(t.key,t)},Mh.prototype.js=function(t,e){this.xs(),e&&(this.readTime=e),this.Ns.set(t,null)},Mh.prototype.Ls=function(t,e){this.xs();var n=this.Ns.get(e);return void 0!==n?Nh.resolve(n):this.Bs(t,e)},Mh.prototype.getEntries=function(t,e){return this.Ms(t,e)},Mh.prototype.apply=function(t){return this.xs(),this.Os=!0,this.qs(t)},Mh.prototype.xs=function(){jr(!this.Os,"Changes have already been applied.")},Mh),Ah="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Sh=(Lh.prototype.Gs=function(t){this.Qs.push(t)},Lh.prototype.Ws=function(){this.Qs.forEach(function(t){return t()})},Lh),kh=(Ph.Ks=function(o,t,s){return jr(Ph.Hs(),"IndexedDB not supported in current environment."),Ur("SimpleDb","Opening database:",o),new Nh(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new Ph(e))},i.onblocked=function(){r(new ti(Zr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new ti(Zr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Ur("SimpleDb",'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;s.createOrUpgrade(e,i.transaction,t.oldVersion,Uc).next(function(){Ur("SimpleDb","Database upgrade to version "+Uc+" complete")})}}).Ss()},Ph.delete=function(t){return Ur("SimpleDb","Removing database:",t),Bh(window.indexedDB.deleteDatabase(t)).Ss()},Ph.Hs=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(Ph.Js())return!0;if(void 0===window.navigator)return!1;var t=l(),e=Ph.zs(t),n=0<e&&e<10,r=Ph.Ys(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Ph.Js=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Xs)},Ph.$s=function(t,e){return t.store(e)},Ph.zs=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Ph.Ys=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Ph.prototype.Zs=function(e){this.db.onversionchange=function(t){return e(t)}},Ph.prototype.runTransaction=function(r,h,c){return p(this,void 0,void 0,function(){var o,s,a,e,u,n;return y(this,function(t){switch(t.label){case 0:o=r.startsWith("readonly"),s=r.endsWith("idempotent"),a=0,e=function(){var e,n,r,i;return y(this,function(t){switch(t.label){case 0:++a,e=Rh.open(u.db,o?"readonly":"readwrite",h),t.label=1;case 1:return t.trys.push([1,3,,4]),(n=c(e).catch(function(t){return e.abort(t),Nh.reject(t)}).Ss()).catch(function(){}),[4,e.to];case 2:return t.sent(),[2,{value:n}];case 3:return r=t.sent(),i=s&&"FirebaseError"!==r.name&&a<3,Ur("SimpleDb","Transaction failed with error: %s. Retrying: %s.",r.message,i),i?[3,4]:[2,{value:Promise.reject(r)}];case 4:return[2]}})},u=this,t.label=1;case 1:return[5,e()];case 2:return"object"==typeof(n=t.sent())?[2,n.value]:[3,1];case 3:return[2]}})})},Ph.prototype.close=function(){this.db.close()},Ph),Dh=(Object.defineProperty(Oh.prototype,"Rs",{get:function(){return this.io},enumerable:!0,configurable:!0}),Object.defineProperty(Oh.prototype,"ro",{get:function(){return this.eo},enumerable:!0,configurable:!0}),Object.defineProperty(Oh.prototype,"cursor",{set:function(t){this.no=t},enumerable:!0,configurable:!0}),Oh.prototype.done=function(){this.io=!0},Oh.prototype.uo=function(t){this.eo=t},Oh.prototype.delete=function(){return Bh(this.no.delete())},Oh),Rh=(Ch.open=function(t,e,n){return new Ch(t.transaction(n,e))},Object.defineProperty(Ch.prototype,"to",{get:function(){return this.so.promise},enumerable:!0,configurable:!0}),Ch.prototype.abort=function(t){t&&this.so.reject(t),this.aborted||(Ur("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Ch.prototype.store=function(t){var e=this.transaction.objectStore(t);return jr(!!e,"Object store not part of transaction: "+t),new _h(e)},Ch),_h=(xh.prototype.put=function(t,e){return Bh(void 0!==e?(Ur("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Ur("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},xh.prototype.add=function(t){return Ur("SimpleDb","ADD",this.store.name,t,t),Bh(this.store.add(t))},xh.prototype.get=function(e){var n=this;return Bh(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Ur("SimpleDb","GET",n.store.name,e,t),t})},xh.prototype.delete=function(t){return Ur("SimpleDb","DELETE",this.store.name,t),Bh(this.store.delete(t))},xh.prototype.count=function(){return Ur("SimpleDb","COUNT",this.store.name),Bh(this.store.count())},xh.prototype.oo=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.ho(n,function(t,e){r.push(e)}).next(function(){return r})},xh.prototype.co=function(t,e){Ur("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.ao=!1;var r=this.cursor(n);return this.ho(r,function(t,e,n){return n.delete()})},xh.prototype.fo=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.ho(r,e)},xh.prototype.lo=function(i){var t=this.cursor({});return new Nh(function(n,r){t.onerror=function(t){var e=zh(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},xh.prototype.ho=function(t,s){var a=[];return new Nh(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new Dh(e),r=s(e.primaryKey,e.value,n);if(r instanceof Nh){var i=r.catch(function(t){return n.done(),Nh.reject(t)});a.push(i)}n.Rs?o():null===n.ro?e.continue():e.continue(n.ro)}else o()}}).next(function(){return Nh.ks(a)})},xh.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(jr(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},xh.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.ao?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},xh);function xh(t){this.store=t}function Ch(t){var n=this;this.transaction=t,this.aborted=!1,this.so=new $u,this.transaction.oncomplete=function(){n.so.resolve()},this.transaction.onabort=function(){t.error?n.so.reject(t.error):n.so.resolve()},this.transaction.onerror=function(t){var e=zh(t.target.error);n.so.reject(e)}}function Oh(t){this.no=t,this.io=!1,this.eo=null}function Ph(t){this.db=t,12.2===Ph.zs(l())&&qr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Lh(){this.Qs=[]}function Mh(){this.Ns=new Ih(function(t){return t.toString()}),this.Os=!1}function Uh(t){var e=this;this.Ts=null,this.Es=null,this.result=void 0,this.error=void 0,this.Rs=!1,this.As=!1,t(function(t){e.Rs=!0,e.result=t,e.Ts&&e.Ts(t)},function(t){e.Rs=!0,e.error=t,e.Es&&e.Es(t)})}function qh(t){this._s=t,this.Is={}}function Vh(t,e){this.key=t,this.ys=e}function Gh(){this.hs=new ao(Eh.Bn),this.cs=new ao(Eh.as)}function jh(t,e,n,r,i){this.batch=t,this.ss=e,this.rs=n,this.streamToken=r,this.os=i}function Fh(t,e,n,r){this.batchId=t,this.jn=e,this.baseMutations=n,jr(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}function Bh(t){return new Nh(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=zh(t.target.error);r(e)}})}var Hh=!1;function zh(t){var e=kh.zs(l());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new ti("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Hh||(Hh=!0,setTimeout(function(){throw r},0)),r}}return t}var Jh=(Wh.mo=function(t,e,n,r){return jr(""!==t.uid,"UserID must not be an empty string."),new Wh(t.l()?t.uid:"",e,n,r)},Wh.prototype.po=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Qh(t).fo({index:Jc.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},Wh.prototype.bo=function(e,t,n){return this.yo(e).next(function(t){return t.lastStreamToken=n.toBase64(),$h(e).put(t)})},Wh.prototype._o=function(t){return this.yo(t).next(function(t){return Ha.fromBase64String(t.lastStreamToken)})},Wh.prototype.Io=function(e,n){return this.yo(e).next(function(t){return t.lastStreamToken=n.toBase64(),$h(e).put(t)})},Wh.prototype.To=function(h,c,f,l){var p=this,d=Kh(h),y=Qh(h);return y.add({}).next(function(t){jr("number"==typeof t,"Auto-generated key is not a number");for(var e=new gh(t,c,f,l),n=p.serializer.Eo(p.userId,e),r=[],i=new ao(function(t,e){return Hr(t.nt(),e.nt())}),o=0,s=l;o<s.length;o++){var a=s[o],u=Xc.key(p.userId,a.key.path,t);i=i.add(a.key.path.H()),r.push(y.put(n)),r.push(d.put(u,Xc.PLACEHOLDER))}return i.forEach(function(t){r.push(p.do.Ro(h,t))}),h.Gs(function(){p.wo[t]=e.keys()}),Nh.ks(r).next(function(){return e})})},Wh.prototype.Ao=function(t,e){var n=this;return Qh(t).get(e).next(function(t){return t?(jr(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.Do(t)):null})},Wh.prototype.Po=function(t,n){var r=this;return this.wo[n]?Nh.resolve(this.wo[n]):this.Ao(t,n).next(function(t){if(t){var e=t.keys();return r.wo[n]=e}return null})},Wh.prototype.So=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return Qh(t).fo({index:Jc.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(jr(e.batchId>=i,"Should have found mutation after "+i),o=r.serializer.Do(e)),n.done()}).next(function(){return o})},Wh.prototype.Co=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Qh(t).fo({index:Jc.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},Wh.prototype.ko=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Qh(t).oo(Jc.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.Do(t)})})},Wh.prototype.Vo=function(a,u){var h=this,t=Xc.prefixForPath(this.userId,u.path),e=IDBKeyRange.lowerBound(t),c=[];return Kh(a).fo({range:e},function(e,t,n){var r=e[0],i=e[1],o=e[2],s=mh(i);if(r===h.userId&&u.path.isEqual(s))return Qh(a).get(o).next(function(t){if(!t)throw Gr("Dangling document-mutation reference found: "+e+" which points to "+o);jr(t.userId===h.userId,"Unexpected user '"+t.userId+"' for mutation batch "+o),c.push(h.serializer.Do(t))});n.done()}).next(function(){return c})},Wh.prototype.No=function(r,t){var u=this,h=new ao(Hr),i=[];return t.forEach(function(a){var t=Xc.prefixForPath(u.userId,a.path),e=IDBKeyRange.lowerBound(t),n=Kh(r).fo({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=mh(i);r===u.userId&&a.path.isEqual(s)?h=h.add(o):n.done()});i.push(n)}),Nh.ks(i).next(function(){return u.Oo(r,h)})},Wh.prototype.Fo=function(t,e){var a=this;jr(!e.zn(),"Document queries shouldn't go down this path"),jr(!e._i(),"CollectionGroup queries should be handled in LocalDocumentsView");var u=e.path,h=u.length+1,n=Xc.prefixForPath(this.userId,u),r=IDBKeyRange.lowerBound(n),c=new ao(Hr);return Kh(t).fo({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=mh(i);r===a.userId&&u.$(s)?s.length===h&&(c=c.add(o)):n.done()}).next(function(){return a.Oo(t,c)})},Wh.prototype.Oo=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Qh(t).get(e).next(function(t){if(null===t)throw Gr("Dangling document-mutation reference found, which points to "+e);jr(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.Do(t))}))}),Nh.ks(i).next(function(){return r})},Wh.prototype.Uo=function(e,n){var r=this;return Xh(e.xo,this.userId,n).next(function(t){return e.Gs(function(){r.jo(n.batchId)}),Nh.forEach(t,function(t){return r.vo.Lo(e,t)})})},Wh.prototype.jo=function(t){delete this.wo[t]},Wh.prototype.Bo=function(n){var o=this;return this.po(n).next(function(t){if(!t)return Nh.resolve();var e=IDBKeyRange.lowerBound(Xc.prefixForUser(o.userId)),i=[];return Kh(n).fo({range:e},function(t,e,n){if(t[0]===o.userId){var r=mh(t[1]);i.push(r)}else n.done()}).next(function(){jr(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.nt()}))})})},Wh.prototype.bs=function(t,e){return Yh(t,this.userId,e)},Wh.prototype.yo=function(t){var e=this;return $h(t).get(this.userId).next(function(t){return t||new zc(e.userId,-1,"")})},Wh);function Wh(t,e,n,r){this.userId=t,this.serializer=e,this.do=n,this.vo=r,this.wo={}}function Yh(t,o,e){var n=Xc.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),a=!1;return Kh(t).fo({range:r,ao:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(a=!0),n.done()}).next(function(){return a})}function Xh(t,e,n){var r=t.store(Jc.store),i=t.store(Xc.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.fo({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){jr(1===a,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var h=[],c=0,f=n.mutations;c<f.length;c++){var l=f[c],p=Xc.key(e,l.key.path,n.batchId);o.push(i.delete(p)),h.push(l.key)}return Nh.ks(o).next(function(){return h})}function Qh(t){return Tf.$s(t,Jc.store)}function Kh(t){return Tf.$s(t,Xc.store)}function $h(t){return Tf.$s(t,zc.store)}var Zh,tc;(tc=Zh=Zh||{})[tc.Mo=0]="__PRIVATE_QueryCache",tc[tc.qo=1]="__PRIVATE_SyncEngine";var ec=(hc.prototype.next=function(){var t=this.Wo;return this.Wo+=2,t},hc.prototype.after=function(t){return this.Go(t+2),this.next()},hc.prototype.Go=function(t){jr((1&t)===this.Qo,"Cannot supply target ID from different generator ID"),this.Wo=t},hc.zo=function(){return new hc(Zh.Mo,2)},hc.Ko=function(){return new hc(Zh.qo)},hc),nc=(uc.prototype.Yo=function(e,n){var r=this;return this.Jo.Vo(e,n).next(function(t){return r.Xo(e,n,t)})},uc.prototype.Xo=function(t,r,i){return this.Ho.Ls(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].Gt(r,t);return t})},uc.prototype.$o=function(t,e,i){var o=iu();return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].Gt(t,e);o=o.lt(t,e)}),o},uc.prototype.Zo=function(e,t){var n=this;return this.Ho.getEntries(e,t).next(function(t){return n.th(e,t)})},uc.prototype.th=function(r,i){var o=this;return this.Jo.No(r,i).next(function(t){var e=o.$o(r,i,t),n=ru();return e.forEach(function(t,e){e=e||new Us(t,Gi.B()),n=n.lt(t,e)}),n})},uc.prototype.nh=function(t,e,n){return e.zn()?this.ih(t,e.path):e._i()?this.eh(t,e,n):this.rh(t,e,n)},uc.prototype.ih=function(t,e){return this.Yo(t,new zi(e)).next(function(t){var e=su();return t instanceof Ms&&(e=e.lt(t.key,t)),e})},uc.prototype.eh=function(n,r,i){var o=this;jr(r.path.J(),"Currently we only support collection group queries at the root.");var s=r.collectionGroup,a=su();return this.do.uh(n,s).next(function(t){return Nh.forEach(t,function(t){var e=r.ai(t.child(s));return o.rh(n,e,i).next(function(t){t.forEach(function(t,e){a=a.lt(t,e)})})}).next(function(){return a})})},uc.prototype.rh=function(e,n,t){var c,f,r=this;return this.Ho.nh(e,n,t).next(function(t){return c=t,r.Jo.Fo(e,n)}).next(function(t){return f=t,r.sh(e,f,c).next(function(t){c=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],a=s.key,u=c.get(a),h=s.Gt(u,u,r.jn);c=h instanceof Ms?c.lt(a,h):c.remove(a)}})}).next(function(){return c.forEach(function(t,e){n.matches(e)||(c=c.remove(t))}),c})},uc.prototype.sh=function(t,e,n){for(var r=cu(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Go&&null===n.get(u.key)&&(r=r.add(u.key))}var h=n;return this.Ho.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Ms&&(h=h.lt(t,e))}),h})},uc),rc=(ac.ah=function(t,e){for(var n=cu(),r=cu(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case pu.Bi:n=n.add(s.doc.key);break;case pu.Mi:r=r.add(s.doc.key)}}return new ac(t,e.fromCache,n,r)},ac),ic="LocalStore",oc=(sc.prototype.start=function(){return this.Ah()},sc.prototype.Dh=function(i){return p(this,void 0,void 0,function(){var e,v,n,r=this;return y(this,function(t){switch(t.label){case 0:return e=this.Jo,v=this.Th,[4,this.persistence.runTransaction("Handle user change","readonly-idempotent",function(d){var y;return r.Jo.ko(d).next(function(t){return y=t,e=r.persistence.gh(i),v=new nc(r.bh,e,r.persistence.Eh()),e.ko(d)}).next(function(t){for(var e=[],n=[],r=cu(),i=0,o=y;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var a=0,u=s.mutations;a<u.length;a++){var h=u[a];r=r.add(h.key)}}for(var c=0,f=t;c<f.length;c++){s=f[c],n.push(s.batchId);for(var l=0,p=s.mutations;l<p.length;l++)h=p[l],r=r.add(h.key)}return v.Zo(d,r).next(function(t){return{Ph:t,Sh:e,Ch:n}})})})];case 1:return n=t.sent(),this.Jo=e,this.Th=v,this.fh.Rh(this.Th),[2,n]}})})},sc.prototype.kh=function(a){var u,h=this,c=Vi.now(),t=a.reduce(function(t,e){return t.add(e.key)},cu());return this.persistence.runTransaction("Locally write mutations","readwrite-idempotent",function(s){return h.Th.Zo(s,t).next(function(t){u=t;for(var e=[],n=0,r=a;n<r.length;n++){var i=r[n],o=i.sn(u.get(i.key));null!=o&&e.push(new Go(i.key,o,o.on(),Uo.exists(!0)))}return h.Jo.To(s,c,e,a)})}).then(function(t){var e=t.us(u);return{batchId:t.batchId,Ns:e}})},sc.prototype.Vh=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly-idempotent",function(e){return n.Jo.Po(e,t).next(function(t){return t?n.Th.Zo(e,t):Nh.resolve(null)})})},sc.prototype.bo=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary-idempotent",function(t){var e=r.batch.keys(),n=i.bh.Nh({Oh:!0});return i.Jo.bo(t,r.batch,r.streamToken).next(function(){return i.Fh(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.Jo.Bo(t)}).next(function(){return i.Th.Zo(t,e)})})},sc.prototype.Uh=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary-idempotent",function(e){var n;return r.Jo.Ao(e,t).next(function(t){return jr(null!==t,"Attempt to reject nonexistent batch!"),n=t.keys(),r.Jo.Uo(e,t)}).next(function(){return r.Jo.Bo(e)}).next(function(){return r.Th.Zo(e,n)})})},sc.prototype.Co=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly-idempotent",function(t){return e.Jo.Co(t)})},sc.prototype._o=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly-idempotent",function(t){return e.Jo._o(t)})},sc.prototype.Io=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary-idempotent",function(t){return n.Jo.Io(t,e)})},sc.prototype.xh=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly-idempotent",function(t){return e._h.xh(t)})},sc.prototype.jh=function(u){var h=this,c=u.Ni,f=this.dh;return this.persistence.runTransaction("Apply remote event","readwrite-primary-idempotent",function(o){var i=h.bh.Nh({Oh:!0});f=h.dh;var s=[];di(u.Zi,function(t,e){var n=f.get(t);if(n){s.push(h._h.Lh(o,e.he,t).next(function(){return h._h.Bh(o,e.se,t)}));var r=e.resumeToken;if(0<r.Nn()){var i=n.Fi(r,c).Oi(o.Mh);f=f.lt(t,i),sc.qh(n,i,e)&&s.push(h._h.Qh(o,i))}}});var a=ru(),n=cu();if(u.ne.forEach(function(t,e){n=n.add(t)}),s.push(i.getEntries(o,n).next(function(r){u.ne.forEach(function(t,e){var n=r.get(t);e instanceof Us&&e.version.isEqual(Gi.MIN)?(i.js(t,c),a=a.lt(t,e)):null==n||0<e.version.h(n.version)||0===e.version.h(n.version)&&n.hasPendingWrites?(jr(!Gi.MIN.isEqual(c),"Cannot add a document when the remote version is zero"),i.Us(e,c),a=a.lt(t,e)):Ur(ic,"Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),u.ie.has(t)&&s.push(h.persistence.vo.Gh(o,t))})})),!c.isEqual(Gi.MIN)){var t=h._h.xh(o).next(function(t){return jr(0<=c.h(t),"Watch stream reverted to previous snapshot?? "+c+" < "+t),h._h.Wh(o,o.Mh,c)});s.push(t)}return Nh.ks(s).next(function(){return i.apply(o)}).next(function(){return h.Th.th(o,a)})}).then(function(t){return h.dh=f,t})},sc.qh=function(t,e,n){return jr(0<e.resumeToken.Nn(),"Attempted to persist target data with no resume token"),0===t.resumeToken.Nn()||e.Ni.M()-t.Ni.M()>=this.zh||0<n.se.size+n.oe.size+n.he.size},sc.prototype.Kh=function(t){for(var n=this,e=0,r=t;e<r.length;e++){var i=r[e],o=i.targetId;if(this.lh.ls(i.oh,o),this.lh.ws(i.hh,o),!i.fromCache){var s=this.dh.get(o);jr(null!==s,"Can't set limbo-free snapshot version for unknown target: "+o);var a=s.Ni,u=s.Ui(a);this.dh=this.dh.lt(o,u)}}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite-idempotent",function(e){return Nh.forEach(t,function(t){return Nh.forEach(t.hh,function(t){return n.persistence.vo.ds(e,t)})})})},sc.prototype.Hh=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly-idempotent",function(t){return void 0===e&&(e=-1),n.Jo.So(t,e)})},sc.prototype.Jh=function(e){var n=this;return this.persistence.runTransaction("read document","readonly-idempotent",function(t){return n.Th.Yo(t,e)})},sc.prototype.Yh=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite-idempotent",function(e){var n;return i._h.Xh(e,r).next(function(t){return t?(n=t,Nh.resolve(n)):i._h.$h(e).next(function(t){return n=new Qa(r,t,Fa.Si,e.Mh),i._h.Zh(e,n).next(function(){return n})})})}).then(function(t){return null===i.dh.get(t.targetId)&&(i.dh=i.dh.lt(t.targetId,t),i.vh.set(r,t.targetId)),t})},sc.prototype.Xh=function(t,e){var n=this.vh.get(e);return void 0!==n?Nh.resolve(this.dh.get(n)):this._h.Xh(t,e)},sc.prototype.tc=function(n,r){var i=this,o=this.dh.get(n);jr(null!==o,"Tried to release nonexistent target: "+n);var t=r?"readwrite-idempotent":"readwrite-primary-idempotent";return this.persistence.runTransaction("Release target",t,function(e){var t=i.lh.ms(n);return r?Nh.resolve():Nh.forEach(t,function(t){return i.persistence.vo.ds(e,t)}).next(function(){i.persistence.vo.removeTarget(e,o)})}).then(function(){i.dh=i.dh.remove(n),i.vh.delete(o.target)})},sc.prototype.nc=function(t,n){var r=this,i=Gi.MIN,o=cu();return this.persistence.runTransaction("Execute query","readonly-idempotent",function(e){return r.Xh(e,t.li()).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r._h.ic(e,t.targetId).next(function(t){o=t})}).next(function(){return r.fh.nh(e,t,n?i:Gi.MIN,n?o:cu())}).next(function(t){return{documents:t,ec:o}})})},sc.prototype.rc=function(e){var n=this;return this.persistence.runTransaction("Remote document keys","readonly-idempotent",function(t){return n._h.ic(t,e)})},sc.prototype.uc=function(){return this.persistence.uc()},sc.prototype.sc=function(t){this.Jo.jo(t)},sc.prototype.oc=function(t){this.persistence.oc(t)},sc.prototype.Fh=function(t,i,o){var e=this,s=i.batch,n=s.keys(),a=Nh.resolve();return n.forEach(function(r){a=a.next(function(){return o.Ls(t,r)}).next(function(t){var e=t,n=i.os.get(r);jr(null!==n,"ackVersions should contain every doc in the write."),(!e||e.version.h(n)<0)&&((e=s.Wt(r,e,i))?o.Us(e,i.ss):jr(!t,"Mutation batch "+s+" applied to document "+t+" resulted in null"))})}),a.next(function(){return e.Jo.Uo(t,s)})},sc.prototype.hc=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary-idempotent",function(t){return e.cc(t,n.dh)})},sc.prototype.ac=function(e){var n=this,t=this.dh.get(e);return t?Promise.resolve(t.target):this.persistence.runTransaction("Get target data","readonly-idempotent",function(t){return n._h.Ye(t,e).next(function(t){return t?t.target:null})})},sc.prototype.fc=function(){var r=this;return this.persistence.runTransaction("Get new document changes","readonly-idempotent",function(t){return r.bh.fc(t,r.wh)}).then(function(t){var e=t.lc,n=t.readTime;return r.wh=n,e})},sc.prototype.Ah=function(){return p(this,void 0,void 0,function(){var e,n=this;return y(this,function(t){switch(t.label){case 0:return[4,(e=this).persistence.runTransaction("Synchronize last document change read time","readonly-idempotent",function(t){return n.bh.dc(t)})];case 1:return e.wh=t.sent(),[2]}})})},sc.zh=3e8,sc);function sc(t,e,n){this.persistence=t,this.fh=e,this.lh=new bh,this.dh=new Ji(Hr),this.vh=new Ih(function(t){return t.canonicalId()}),this.wh=Gi.MIN,jr(t.mh,"LocalStore was passed an unstarted persistence implementation"),this.persistence.vo.ph(this.lh),this.Jo=t.gh(n),this.bh=t.yh(),this._h=t.Ih(),this.Th=new nc(this.bh,this.Jo,this.persistence.Eh()),this.fh.Rh(this.Th)}function ac(t,e,n,r){this.targetId=t,this.fromCache=e,this.oh=n,this.hh=r}function uc(t,e,n){this.Ho=t,this.Jo=e,this.do=n}function hc(t,e){jr((1&(this.Qo=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.Go(void 0!==e?e:this.Qo)}function cc(e){return p(this,void 0,void 0,function(){return y(this,function(t){if(e.code!==Zr.FAILED_PRECONDITION||e.message!==Ah)throw e;return Ur(ic,"Unexpectedly lost primary lease"),[2]})})}function fc(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Hr(n,i);return 0===s?Hr(r,o):s}var lc=(Ic.prototype.mc=function(){return++this.wc},Ic.prototype.pc=function(t){var e=[t,this.mc()];if(this.buffer.size<this.vc)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();fc(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(Ic.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),Ic),pc={gc:!1,bc:0,yc:0,_c:0},dc=(Ec.Rc=function(t){return new Ec(t,Ec.Ac,Ec.Dc)},Ec.Pc=-1,Ec.Sc=1048576,Ec.kc=new Ec(Ec.Cc=41943040,Ec.Ac=10,Ec.Dc=1e3),Ec.DISABLED=new Ec(Ec.Pc,0,0),Ec),yc=(bc.prototype.start=function(){jr(null===this.Fc,"Cannot start an already started LruScheduler"),this.Vc.params.Ic!==dc.Pc&&this.Uc()},bc.prototype.stop=function(){this.Fc&&(this.Fc.cancel(),this.Fc=null)},Object.defineProperty(bc.prototype,"mh",{get:function(){return null!==this.Fc},enumerable:!0,configurable:!0}),bc.prototype.Uc=function(){var t=this;jr(null===this.Fc,"Cannot schedule GC while a task is pending");var e=this.Oc?3e5:6e4;Ur("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.Fc=this.Pu.Yu(Zu.Au,e,function(){return t.Fc=null,t.Oc=!0,t.Nc.hc(t.Vc).then(function(){return t.Uc()}).catch(cc)})},bc),vc=(wc.prototype.jc=function(t,e){return this.xc.Lc(t).next(function(t){return Math.floor(e/100*t)})},wc.prototype.Bc=function(t,e){var n=this;if(0===e)return Nh.resolve(rh.gu);var r=new lc(e);return this.xc.Le(t,function(t){return r.pc(t.sequenceNumber)}).next(function(){return n.xc.Mc(t,function(t){return r.pc(t)})}).next(function(){return r.maxValue})},wc.prototype.qc=function(t,e,n){return this.xc.qc(t,e,n)},wc.prototype.Qc=function(t,e){return this.xc.Qc(t,e)},wc.prototype.cc=function(e,n){var r=this;return this.params.Ic===dc.Pc?(Ur("LruGarbageCollector","Garbage collection skipped; disabled"),Nh.resolve(pc)):this.Gc(e).next(function(t){return t<r.params.Ic?(Ur("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.Ic),pc):r.Wc(e,n)})},wc.prototype.Gc=function(t){return this.xc.Gc(t)},wc.prototype.Wc=function(e,n){var r,i,o,s,a,u,h,c=this,f=Date.now();return this.jc(e,this.params.Tc).next(function(t){return i=t>c.params.Ec?(Ur("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.Ec+" from "+t),c.params.Ec):t,s=Date.now(),c.Bc(e,i)}).next(function(t){return r=t,a=Date.now(),c.qc(e,r,n)}).next(function(t){return o=t,u=Date.now(),c.Qc(e,r)}).next(function(t){return h=Date.now(),Lr()<=Ar.DEBUG&&Ur("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(a-s)+"ms\n\tRemoved "+o+" targets in "+(u-a)+"ms\n\tRemoved "+t+" documents in "+(h-u)+"ms\nTotal Duration: "+(h-f)+"ms"),Nh.resolve({gc:!0,bc:i,yc:o,_c:t})})},wc),mc=(gc.prototype.$h=function(e){var n=this;return this.Kc(e).next(function(t){return t.highestTargetId=n.zc.after(t.highestTargetId),n.Hc(e,t).next(function(){return t.highestTargetId})})},gc.prototype.xh=function(t){return this.Kc(t).next(function(t){return Gi.L(new Vi(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},gc.prototype.Jc=function(t){return Ac(t.xo)},gc.prototype.Wh=function(e,n,r){var i=this;return this.Kc(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.q()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.Hc(e,t)})},gc.prototype.Zh=function(e,n){var r=this;return this.Yc(e,n).next(function(){return r.Kc(e).next(function(t){return t.targetCount+=1,r.Xc(n,t),r.Hc(e,t)})})},gc.prototype.Qh=function(t,e){return this.Yc(t,e)},gc.prototype.$c=function(e,t){var n=this;return this.Zc(e,t.targetId).next(function(){return Nc(e).delete(t.targetId)}).next(function(){return n.Kc(e)}).next(function(t){return jr(0<t.targetCount,"Removing from an empty target cache"),t.targetCount-=1,n.Hc(e,t)})},gc.prototype.qc=function(r,i,o){var s=this,a=0,u=[];return Nc(r).fo(function(t,e){var n=s.serializer.ta(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(a++,u.push(s.$c(r,n)))}).next(function(){return Nh.ks(u)}).next(function(){return a})},gc.prototype.Le=function(t,r){var i=this;return Nc(t).fo(function(t,e){var n=i.serializer.ta(e);r(n)})},gc.prototype.Kc=function(t){return Tc(t.xo)},gc.prototype.Hc=function(t,e){return(n=t,Tf.$s(n,sf.store)).put(sf.key,e);var n},gc.prototype.Yc=function(t,e){return Nc(t).put(this.serializer.na(e))},gc.prototype.Xc=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},gc.prototype.ia=function(t){return this.Kc(t).next(function(t){return t.targetCount})},gc.prototype.Xh=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),s=null;return Nc(t).fo({range:n,index:rf.queryTargetsIndexName},function(t,e,n){var r=o.serializer.ta(e);i.isEqual(r.target)&&(s=r,n.done())}).next(function(){return s})},gc.prototype.Bh=function(n,t,r){var i=this,o=[],s=Sc(n);return t.forEach(function(t){var e=dh(t.path);o.push(s.put(new of(r,e))),o.push(i.vo.fs(n,t))}),Nh.ks(o)},gc.prototype.Lh=function(n,t,r){var i=this,o=Sc(n);return Nh.forEach(t,function(t){var e=dh(t.path);return Nh.ks([o.delete([r,e]),i.vo.ds(n,t)])})},gc.prototype.Zc=function(t,e){var n=Sc(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},gc.prototype.ic=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Sc(t),o=cu();return r.fo({range:n,ao:!0},function(t,e,n){var r=mh(t[1]),i=new zi(r);o=o.add(i)}).next(function(){return o})},gc.prototype.bs=function(t,e){var n=dh(e.path),r=IDBKeyRange.bound([n],[Jr(n)],!1,!0),i=0;return Sc(t).fo({index:of.documentTargetsIndex,ao:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},gc.prototype.Ye=function(t,e){var n=this;return Nc(t).get(e).next(function(t){return t?n.serializer.ta(t):null})},gc);function gc(t,e){this.vo=t,this.serializer=e,this.zc=ec.zo()}function wc(t,e){this.xc=t,this.params=e}function bc(t,e,n){this.Vc=t,this.Pu=e,this.Nc=n,this.Oc=!1,this.Fc=null}function Ec(t,e,n){this.Ic=t,this.Tc=e,this.Ec=n}function Ic(t){this.vc=t,this.buffer=new ao(fc),this.wc=0}function Nc(t){return Tf.$s(t,rf.store)}function Tc(t){return kh.$s(t,sf.store).get(sf.key).next(function(t){return jr(null!==t,"Missing metadata row."),t})}function Ac(t){return Tc(t).next(function(t){return t.highestListenSequenceNumber})}function Sc(t){return Tf.$s(t,of.store)}var kc,Dc=(Rc.prototype.Us=function(t,e,n){return Cc(t).put(Oc(e),n)},Rc.prototype.js=function(t,e){var n=Cc(t),r=Oc(e);return n.delete(r)},Rc.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.ea(e,t)})},Rc.prototype.Ls=function(t,e){var n=this;return Cc(t).get(Oc(e)).next(function(t){return n.ra(t)})},Rc.prototype.ua=function(t,e){var n=this;return Cc(t).get(Oc(e)).next(function(t){var e=n.ra(t);return e?{sa:e,size:Pc(t)}:null})},Rc.prototype.getEntries=function(t,e){var r=this,i=iu();return this.oa(t,e,function(t,e){var n=r.ra(e);i=i.lt(t,n)}).next(function(){return i})},Rc.prototype.ha=function(t,e){var r=this,i=iu(),o=new Ji(zi.G);return this.oa(t,e,function(t,e){var n=r.ra(e);o=n?(i=i.lt(t,n),o.lt(t,Pc(e))):(i=i.lt(t,null),o.lt(t,0))}).next(function(){return{ca:i,aa:o}})},Rc.prototype.oa=function(t,e,i){if(e.J())return Nh.resolve();var n=IDBKeyRange.bound(e.first().path.tt(),e.last().path.tt()),o=e.bt(),s=o.Rt();return Cc(t).fo({range:n},function(t,e,n){for(var r=zi.at(t);s&&zi.G(s,r)<0;)i(s,null),s=o.Rt();s&&s.isEqual(r)&&(i(s,e),s=o.At()?o.Rt():null),s?n.uo(s.path.tt()):n.done()}).next(function(){for(;s;)i(s,null),s=o.At()?o.Rt():null})},Rc.prototype.nh=function(t,i,e){var o=this;jr(!i._i(),"CollectionGroup queries should be handled in LocalDocumentsView");var s=su(),a=i.path.length+1,n={};if(e.isEqual(Gi.MIN)){var r=i.path.tt();n.range=IDBKeyRange.lowerBound(r)}else{var u=i.path.tt(),h=this.serializer.fa(e);n.range=IDBKeyRange.lowerBound([u,h],!0),n.index=Zc.collectionReadTimeIndex}return Cc(t).fo(n,function(t,e,n){if(t.length===a){var r=o.serializer.la(e);i.path.$(r.key.path)?r instanceof Ms&&i.matches(r)&&(s=s.lt(r.key,r)):n.done()}}).next(function(){return s})},Rc.prototype.fc=function(t,e){var r=this,i=ru(),o=this.serializer.fa(e),n=Cc(t),s=IDBKeyRange.lowerBound(o,!0);return n.fo({index:Zc.readTimeIndex,range:s},function(t,e){var n=r.serializer.la(e);i=i.lt(n.key,n),o=e.readTime}).next(function(){return{lc:i,readTime:r.serializer.da(o)}})},Rc.prototype.dc=function(t){var r=this,e=Cc(t),i=Gi.MIN;return e.fo({index:Zc.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(i=r.serializer.da(e.readTime)),n.done()}).next(function(){return i})},Rc.prototype.Nh=function(t){return new Rc.va(this,!!t&&t.Oh)},Rc.prototype.wa=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Rc.prototype.getMetadata=function(t){return xc(t).get(tf.key).next(function(t){return jr(!!t,"Missing document cache metadata"),t})},Rc.prototype.ea=function(t,e){return xc(t).put(tf.key,e)},Rc.prototype.ra=function(t){if(t){var e=this.serializer.la(t);return e instanceof Us&&e.version.isEqual(Gi.B())?null:e}return null},Rc.va=(t(_c,kc=Th),_c.prototype.qs=function(s){var a=this,u=[],h=0,c=new ao(function(t,e){return Hr(t.nt(),e.nt())});return this.Ns.forEach(function(t,e){var n=a.pa.get(t);if(jr(void 0!==n,"Cannot modify a document that wasn't read (for "+t+")"),e){jr(!a.readTime.isEqual(Gi.MIN),"Cannot add a document with a read time of zero");var r=a.ma.serializer.ga(e,a.readTime);c=c.add(t.path.H());var i=Pc(r);h+=i-n,u.push(a.ma.Us(s,t,r))}else if(h-=n,a.Oh){var o=a.ma.serializer.ga(new Us(t,Gi.B()),a.readTime);u.push(a.ma.Us(s,t,o))}else u.push(a.ma.js(s,t))}),c.forEach(function(t){u.push(a.ma.do.Ro(s,t))}),u.push(this.ma.updateMetadata(s,h)),Nh.ks(u)},_c.prototype.Bs=function(t,e){var n=this;return this.ma.ua(t,e).next(function(t){return null===t?(n.pa.set(e,0),null):(n.pa.set(e,t.size),t.sa)})},_c.prototype.Ms=function(t,e){var n=this;return this.ma.ha(t,e).next(function(t){var e=t.ca;return t.aa.forEach(function(t,e){n.pa.set(t,e)}),e})},_c),Rc);function Rc(t,e){this.serializer=t,this.do=e}function _c(t,e){var n=kc.call(this)||this;return n.ma=t,n.Oh=e,n.pa=new Ih(function(t){return t.toString()}),n}function xc(t){return Tf.$s(t,tf.store)}function Cc(t){return Tf.$s(t,Zc.store)}function Oc(t){return t.path.tt()}function Pc(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Gr("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var Lc=(jc.prototype.Ro=function(t,e){return this.ba.add(e),Nh.resolve()},jc.prototype.uh=function(t,e){return Nh.resolve(this.ba.getEntries(e))},jc),Mc=(Gc.prototype.add=function(t){jr(t.length%2==1,"Expected a collection path.");var e=t.X(),n=t.H(),r=this.index[e]||new ao(Fi.G),i=!r.has(n);return this.index[e]=r.add(n),i},Gc.prototype.has=function(t){var e=t.X(),n=t.H(),r=this.index[e];return r&&r.has(n)},Gc.prototype.getEntries=function(t){return(this.index[t]||new ao(Fi.G)).tt()},Gc),Uc=9,qc=(Vc.prototype.createOrUpgrade=function(n,r,t,e){var i=this;jr(t<e&&0<=t&&e<=Uc,"Unexpected schema upgrade from v"+t+" to v{toVersion}.");var o,s=new Rh(r);t<1&&1<=e&&(n.createObjectStore(Bc.store),(o=n).createObjectStore(zc.store,{keyPath:zc.keyPath}),o.createObjectStore(Jc.store,{keyPath:Jc.keyPath,autoIncrement:!0}).createIndex(Jc.userMutationsIndex,Jc.userMutationsKeyPath,{unique:!0}),o.createObjectStore(Xc.store),lf(n),n.createObjectStore(Zc.store));var a,u=Nh.resolve();return t<3&&3<=e&&(0!==t&&((a=n).deleteObjectStore(of.store),a.deleteObjectStore(rf.store),a.deleteObjectStore(sf.store),lf(n)),u=u.next(function(){return t=s.store(sf.store),e=new sf(0,0,Gi.MIN.q(),0),t.put(sf.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(u=u.next(function(){return r=n,(i=s).store(Jc.store).oo().next(function(t){r.deleteObjectStore(Jc.store),r.createObjectStore(Jc.store,{keyPath:Jc.keyPath,autoIncrement:!0}).createIndex(Jc.userMutationsIndex,Jc.userMutationsKeyPath,{unique:!0});var e=i.store(Jc.store),n=t.map(function(t){return e.put(t)});return Nh.ks(n)});var r,i})),u=u.next(function(){n.createObjectStore(pf.store,{keyPath:pf.keyPath})})),t<5&&5<=e&&(u=u.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(u=u.next(function(){return n.createObjectStore(tf.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(u=u.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(u=u.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(u=u.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore(Zc.store)).createIndex(Zc.readTimeIndex,Zc.readTimeIndexPath,{unique:!1}),t.createIndex(Zc.collectionReadTimeIndex,Zc.collectionReadTimeIndexPath,{unique:!1})})),u},Vc.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Zc.store).fo(function(t,e){n+=Pc(e)}).next(function(){var t=new tf(n);return e.store(tf.store).put(tf.key,t)})},Vc.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(zc.store),e=r.store(Jc.store);return t.oo().next(function(t){return Nh.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.oo(Jc.userMutationsIndex,t).next(function(t){return Nh.forEach(t,function(t){jr(t.userId===n.userId,"Cannot process batch "+t.batchId+" from unexpected user");var e=i.serializer.Do(t);return Xh(r,n.userId,e).next(function(){})})})})})},Vc.prototype.ensureSequenceNumbers=function(t){var s=t.store(of.store),e=t.store(Zc.store);return Ac(t).next(function(i){var o=[];return e.fo(function(t,e){var n=new Fi(t),r=[0,dh(n)];o.push(s.get(r).next(function(t){return t?Nh.resolve():(e=n,s.put(new of(0,dh(e),i)));var e}))}).next(function(){return Nh.ks(o)})})},Vc.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t.X(),n=t.H();return r.put({collectionId:e,parent:dh(n)})}}t.createObjectStore(af.store,{keyPath:af.keyPath});var r=e.store(af.store),o=new Mc;return e.store(Zc.store).fo({ao:!0},function(t,e){var n=new Fi(t);return i(n.H())}).next(function(){return e.store(Xc.store).fo({ao:!0},function(t,e){t[0];var n=t[1],r=(t[2],mh(n));return i(r.H())})})},Vc);function Vc(t){this.serializer=t}function Gc(){this.index={}}function jc(){this.ba=new Mc}function Fc(t,e){this.seconds=t,this.nanoseconds=e}var Bc=(Hc.store="owner",Hc.key="owner",Hc);function Hc(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var zc=(Yc.store="mutationQueues",Yc.keyPath="userId",Yc),Jc=(Wc.store="mutations",Wc.keyPath="batchId",Wc.userMutationsIndex="userMutationsIndex",Wc.userMutationsKeyPath=["userId","batchId"],Wc);function Wc(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}function Yc(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}var Xc=(Qc.prefixForUser=function(t){return[t]},Qc.prefixForPath=function(t,e){return[t,dh(e)]},Qc.key=function(t,e,n){return[t,dh(e),n]},Qc.store="documentMutations",Qc.PLACEHOLDER=new Qc,Qc);function Qc(){}function Kc(t,e){this.path=t,this.readTime=e}function $c(t,e){this.path=t,this.version=e}var Zc=(nf.store="remoteDocuments",nf.readTimeIndex="readTimeIndex",nf.readTimeIndexPath="readTime",nf.collectionReadTimeIndex="collectionReadTimeIndex",nf.collectionReadTimeIndexPath=["parentPath","readTime"],nf),tf=(ef.store="remoteDocumentGlobal",ef.key="remoteDocumentGlobalKey",ef);function ef(t){this.byteSize=t}function nf(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o}var rf=(ff.store="targets",ff.keyPath="targetId",ff.queryTargetsIndexName="queryTargetsIndex",ff.queryTargetsKeyPath=["canonicalId","targetId"],ff),of=(cf.store="targetDocuments",cf.keyPath=["targetId","path"],cf.documentTargetsIndex="documentTargetsIndex",cf.documentTargetsKeyPath=["path","targetId"],cf),sf=(hf.key="targetGlobalKey",hf.store="targetGlobal",hf),af=(uf.store="collectionParents",uf.keyPath=["collectionId","parent"],uf);function uf(t,e){this.collectionId=t,this.parent=e}function hf(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}function cf(t,e,n){this.targetId=t,this.path=e,jr(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}function ff(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s}function lf(t){t.createObjectStore(of.store,{keyPath:of.keyPath}).createIndex(of.documentTargetsIndex,of.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(rf.store,{keyPath:rf.keyPath}).createIndex(rf.queryTargetsIndexName,rf.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(sf.store)}var pf=(df.store="clientMetadata",df.keyPath="clientId",df);function df(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}var yf=s(s(s([zc.store,Jc.store,Xc.store,Zc.store,rf.store,Bc.store,sf.store,of.store],[pf.store]),[tf.store]),[af.store]),vf=(mf.prototype.Ro=function(t,e){var n=this;if(jr(e.length%2==1,"Expected a collection path."),this.ya.has(e))return Nh.resolve();var r=e.X(),i=e.H();t.Gs(function(){n.ya.add(e)});var o={collectionId:r,parent:dh(i)};return gf(t).put(o)},mf.prototype.uh=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Jr(i),""],!1,!0);return gf(t).oo(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(mh(r.parent))}return o})},mf);function mf(){this.ya=new Mc}function gf(t){return Tf.$s(t,af.store)}var wf=(bf.prototype.la=function(t){if(t.document)return this._a.Er(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=zi.at(t.noDocument.path),n=this.Ia(t.noDocument.readTime);return new Us(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=zi.at(t.unknownDocument.path),n=this.Ia(t.unknownDocument.version),new qs(e,n)):Gr("Unexpected DbRemoteDocument")},bf.prototype.ga=function(t,e){var n=this.fa(e),r=t.key.path.H().tt();if(t instanceof Ms){var i=t.proto?t.proto:this._a.Tr(t),o=t.hasCommittedMutations;return new Zc(null,null,i,o,n,r)}if(t instanceof Us){var s=t.key.path.tt(),a=this.Ta(t.version);return o=t.hasCommittedMutations,new Zc(null,new Kc(s,a),null,o,n,r)}if(t instanceof qs){s=t.key.path.tt();var u=this.Ta(t.version);return new Zc(new $c(s,u),null,null,!0,n,r)}return Gr("Unexpected MaybeDocument")},bf.prototype.fa=function(t){var e=t.q();return[e.seconds,e.nanoseconds]},bf.prototype.da=function(t){var e=new Vi(t[0],t[1]);return Gi.L(e)},bf.prototype.Ta=function(t){var e=t.q();return new Fc(e.seconds,e.nanoseconds)},bf.prototype.Ia=function(t){var e=new Vi(t.seconds,t.nanoseconds);return Gi.L(e)},bf.prototype.Eo=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n._a.Nr(t)}),i=e.mutations.map(function(t){return n._a.Nr(t)});return new Jc(t,e.batchId,e.jn.toMillis(),r,i)},bf.prototype.Do=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e._a.xr(t)}),r=t.mutations.map(function(t){return e._a.xr(t)}),i=Vi.fromMillis(t.localWriteTimeMs);return new gh(t.batchId,i,n,r)},bf.prototype.Ea=function(t){var e=[];return t.forEach(function(t){e.push(dh(t.path))}),e},bf.prototype.Ra=function(t){for(var e=cu(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new zi(mh(i)))}return e},bf.prototype.ta=function(t){var e,n=this.Ia(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.Ia(t.lastLimboFreeSnapshotVersion):Gi.MIN;return e=void 0!==t.query.documents?this._a.Gr(t.query):this._a.Jr(t.query),new Qa(e,t.targetId,Fa.Si,t.lastListenSequenceNumber,n,r,Ha.fromBase64String(t.resumeToken))},bf.prototype.na=function(t){jr(Fa.Si===t.Vi,"Only queries with purpose "+Fa.Si+" may be stored, got "+t.Vi);var e,n=this.Ta(t.Ni),r=this.Ta(t.lastLimboFreeSnapshotVersion);e=t.target.zn()?this._a.Qr(t.target):this._a.Wr(t.target);var i=t.resumeToken.toBase64();return new rf(t.targetId,t.target.canonicalId(),n,i,t.sequenceNumber,r,e)},bf);function bf(t){this._a=t}var Ef,If="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",Nf=(t(Sf,Ef=Sh),Sf),Tf=(Af.$s=function(t,e){if(t instanceof Nf)return kh.$s(t.xo,e);throw Gr("IndexedDbPersistence must use instances of IndexedDbTransaction")},Af.xa=function(n){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:if(!Af.Hs())throw new ti(Zr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(e=new Af(n.allowTabSynchronization,n.persistenceKey,n.clientId,n.platform,n.ja,n.Aa,n.serializer,n.Da)).start()];case 1:return t.sent(),[2,e]}})})},Af.prototype.start=function(){var e=this;return jr(!this.mh,"IndexedDbPersistence double-started!"),jr(null!==this.window,"Expected 'window' to be defined"),kh.Ks(this.Oa,Uc,new qc(this.serializer)).then(function(t){return e.La=t,e.Ba()}).then(function(){return e.Ma(),e.qa(),e.Qa(),e.La.runTransaction("readonly-idempotent",[sf.store],function(t){return Ac(t)})}).then(function(t){e.Ga=new rh(t,e.Da)}).then(function(){e.Pa=!0}).catch(function(t){return e.La&&e.La.close(),Promise.reject(t)})},Af.prototype.Wa=function(n){var t=this;return this.Na=function(e){return p(t,void 0,void 0,function(){return y(this,function(t){return this.mh?[2,n(e)]:[2]})})},n(this.isPrimary)},Af.prototype.za=function(n){var t=this;this.La.Zs(function(e){return p(t,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return null!==e.newVersion?[3,2]:[4,n()];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},Af.prototype.oc=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Aa.xu(function(){return p(e,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.mh?[4,this.Ba()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},Af.prototype.Ba=function(){var n=this;return this.La.runTransaction("readwrite-idempotent",yf,function(e){return Df(e).put(new pf(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.Ka(e).next(function(t){t||(n.isPrimary=!1,n.Aa.xu(function(){return n.Na(!1)}))})}).next(function(){return n.Ha(e)}).next(function(t){return n.isPrimary&&!t?n.Ja(e).next(function(){return!1}):!!t&&n.Ya(e).next(function(){return!0})})}).catch(function(t){if(!n.allowTabSynchronization)throw t;return Ur("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.Aa.xu(function(){return n.Na(t)}),n.isPrimary=t})},Af.prototype.Ka=function(t){var e=this;return kf(t).get(Bc.key).next(function(t){return Nh.resolve(e.Xa(t))})},Af.prototype.$a=function(t){return Df(t).delete(this.clientId)},Af.prototype.Za=function(){return p(this,void 0,void 0,function(){var i=this;return y(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.tf(this.Va,18e5)?[3,2]:(this.Va=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary-idempotent",function(t){var r=Af.$s(t,pf.store);return r.oo().next(function(t){var e=i.nf(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return Nh.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:t.sent().forEach(function(t){i.window.localStorage.removeItem(i.if(t.clientId))}),t.label=2;case 2:return[2]}})})},Af.prototype.Qa=function(){var t=this;this.ka=this.Aa.Yu(Zu.Ru,4e3,function(){return t.Ba().then(function(){return t.Za()}).then(function(){return t.Qa()})})},Af.prototype.Xa=function(t){return!!t&&t.ownerId===this.clientId},Af.prototype.Ha=function(e){var i=this;return kf(e).get(Bc.key).next(function(t){if(null!==t&&i.tf(t.leaseTimestampMs,5e3)&&!i.ef(t.ownerId)){if(i.Xa(t)&&i.networkEnabled)return!0;if(!i.Xa(t)){if(!t.allowTabSynchronization)throw new ti(Zr.FAILED_PRECONDITION,If);return!1}}return!(!i.networkEnabled||!i.inForeground)||Df(e).oo().next(function(t){return void 0===i.nf(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Ur("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},Af.prototype.shutdown=function(){return p(this,void 0,void 0,function(){var e=this;return y(this,function(t){switch(t.label){case 0:return this.Pa=!1,this.rf(),this.ka&&(this.ka.cancel(),this.ka=null),this.uf(),this.sf(),[4,this.La.runTransaction("readwrite-idempotent",[Bc.store,pf.store],function(t){return e.Ja(t).next(function(){return e.$a(t)})})];case 1:return t.sent(),this.La.close(),this.hf(),[2]}})})},Af.prototype.nf=function(t,e){var n=this;return t.filter(function(t){return n.tf(t.updateTimeMs,e)&&!n.ef(t.clientId)})},Af.prototype.uc=function(){var e=this;return this.La.runTransaction("readonly-idempotent",[pf.store],function(t){return Df(t).oo().next(function(t){return e.nf(t,18e5).map(function(t){return t.clientId})})})},Af.clearPersistence=function(n){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return Af.Hs()?(e=n+Af.Fa,[4,kh.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(Af.prototype,"mh",{get:function(){return this.Pa},enumerable:!0,configurable:!0}),Af.prototype.gh=function(t){return jr(this.mh,"Cannot initialize MutationQueue before persistence is started."),Jh.mo(t,this.serializer,this.do,this.vo)},Af.prototype.Ih=function(){return jr(this.mh,"Cannot initialize TargetCache before persistence is started."),this._h},Af.prototype.yh=function(){return jr(this.mh,"Cannot initialize RemoteDocumentCache before persistence is started."),this.Ho},Af.prototype.Eh=function(){return jr(this.mh,"Cannot initialize IndexManager before persistence is started."),this.do},Af.prototype.runTransaction=function(n,t,r){var i=this;Ur("IndexedDbPersistence","Starting transaction:",n);var o,e=t.endsWith("idempotent"),s=t.startsWith("readonly")?e?"readonly-idempotent":"readonly":e?"readwrite-idempotent":"readwrite";return this.La.runTransaction(s,yf,function(e){return o=new Nf(e,i.Ga.next()),"readwrite-primary"===t||"readwrite-primary-idempotent"===t?i.Ka(e).next(function(t){return!!t||i.Ha(e)}).next(function(t){if(!t)throw qr("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.Aa.xu(function(){return i.Na(!1)}),new ti(Zr.FAILED_PRECONDITION,Ah);return r(o)}).next(function(t){return i.Ya(e).next(function(){return t})}):i.cf(e).next(function(){return r(o)})}).then(function(t){return o.Ws(),t})},Af.prototype.cf=function(t){var e=this;return kf(t).get(Bc.key).next(function(t){if(null!==t&&e.tf(t.leaseTimestampMs,5e3)&&!e.ef(t.ownerId)&&!e.Xa(t)&&!t.allowTabSynchronization)throw new ti(Zr.FAILED_PRECONDITION,If)})},Af.prototype.Ya=function(t){var e=new Bc(this.clientId,this.allowTabSynchronization,Date.now());return kf(t).put(Bc.key,e)},Af.Hs=function(){return kh.Hs()},Af.af=function(t){var e=t.s.projectId;return t.s.o||(e+="."+t.s.database),"firestore/"+t.persistenceKey+"/"+e+"/"},Af.prototype.Ja=function(t){var e=this,n=kf(t);return n.get(Bc.key).next(function(t){return e.Xa(t)?(Ur("IndexedDbPersistence","Releasing primary lease."),n.delete(Bc.key)):Nh.resolve()})},Af.prototype.tf=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(qr("Detected an update time that is in the future: "+t+" > "+n),1))},Af.prototype.Ma=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ca=function(){t.Aa.xu(function(){return t.inForeground="visible"===t.document.visibilityState,t.Ba()})},this.document.addEventListener("visibilitychange",this.Ca),this.inForeground="visible"===this.document.visibilityState)},Af.prototype.uf=function(){this.Ca&&(jr(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.Ca),this.Ca=null)},Af.prototype.qa=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.Sa=function(){t.rf(),t.Aa.xu(function(){return t.shutdown()})},this.window.addEventListener("unload",this.Sa))},Af.prototype.sf=function(){this.Sa&&(jr("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.Sa),this.Sa=null)},Af.prototype.ef=function(t){try{var e=null!==this.Ua.getItem(this.if(t));return Ur("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return qr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},Af.prototype.rf=function(){try{this.Ua.setItem(this.if(this.clientId),String(Date.now()))}catch(t){qr("Failed to set zombie client id.",t)}},Af.prototype.hf=function(){try{this.Ua.removeItem(this.if(this.clientId))}catch(t){}},Af.prototype.if=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Af.Fa="main",Af);function Af(t,e,n,r,i,o,s,a){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Aa=o,this.Da=a,this.Pa=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Sa=null,this.inForeground=!1,this.Ca=null,this.ka=null,this.Va=Number.NEGATIVE_INFINITY,this.Na=function(t){return Promise.resolve()},this.vo=new Rf(this,i),this.Oa=e+Af.Fa,this.serializer=new wf(s),this.document=r.document,this._h=new mc(this.vo,this.serializer),this.do=new vf,this.Ho=new Dc(this.serializer,this.do),!r.window||!r.window.localStorage)throw new ti(Zr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.Ua=this.window.localStorage}function Sf(t,e){var n=Ef.call(this)||this;return n.xo=t,n.Mh=e,n}function kf(t){return t.store(Bc.store)}function Df(t){return t.store(pf.store)}var Rf=(_f.prototype.Lc=function(t){var n=this.lf(t);return this.db.Ih().ia(t).next(function(e){return n.next(function(t){return e+t})})},_f.prototype.lf=function(t){var e=0;return this.Mc(t,function(t){e++}).next(function(){return e})},_f.prototype.Le=function(t,e){return this.db.Ih().Le(t,e)},_f.prototype.Mc=function(t,n){return this.df(t,function(t,e){return n(e)})},_f.prototype.ph=function(t){this.ff=t},_f.prototype.fs=function(t,e){return xf(t,e)},_f.prototype.ds=function(t,e){return xf(t,e)},_f.prototype.qc=function(t,e,n){return this.db.Ih().qc(t,e,n)},_f.prototype.Lo=function(t,e){return xf(t,e)},_f.prototype.vf=function(t,e){return this.ff.bs(e)?Nh.resolve(!0):(r=e,i=!1,$h(n=t).lo(function(t){return Yh(n,t,r).next(function(t){return t&&(i=!0),Nh.resolve(!t)})}).next(function(){return i}));var n,r,i},_f.prototype.Qc=function(r,i){var o=this,s=this.db.yh().Nh(),a=[],u=0;return this.df(r,function(e,t){if(t<=i){var n=o.vf(r,e).next(function(t){if(!t)return u++,s.Ls(r,e).next(function(){return s.js(e),Sc(r).delete([0,dh(e.path)])})});a.push(n)}}).next(function(){return Nh.ks(a)}).next(function(){return s.apply(r)}).next(function(){return u})},_f.prototype.removeTarget=function(t,e){var n=e.Oi(t.Mh);return this.db.Ih().Qh(t,n)},_f.prototype.Gh=function(t,e){return xf(t,e)},_f.prototype.df=function(t,o){var s,e=Sc(t),a=rh.gu;return e.fo({index:of.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(a!==rh.gu&&o(new zi(mh(s)),a),a=i,s=r):a=rh.gu}).next(function(){a!==rh.gu&&o(new zi(mh(s)),a)})},_f.prototype.Gc=function(t){return this.db.yh().wa(t)},_f);function _f(t,e){this.db=t,this.ff=null,this.Vc=new vc(this,e)}function xf(t,e){return Sc(t).put((n=e,r=t.Mh,new of(0,dh(n.path),r)));var n,r}var Cf=(Lf.prototype.Rh=function(t){this.wf=t},Lf.prototype.nh=function(e,r,i,o){var s=this;return jr(void 0!==this.wf,"setLocalDocumentsView() not called"),r.fi()?this.mf(e,r):i.isEqual(Gi.MIN)?this.mf(e,r):this.wf.Zo(e,o).next(function(t){var n=s.pf(r,t);return(r.gi()||r.bi())&&s.gf(r.Yn,n,o,i)?s.mf(e,r):(Lr()<=Ar.DEBUG&&Ur("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),r.toString()),s.wf.nh(e,r,i).next(function(e){return n.forEach(function(t){e=e.lt(t.key,t)}),e}))})},Lf.prototype.pf=function(n,t){var r=new ao(function(t,e){return n.di(t,e)});return t.forEach(function(t,e){e instanceof Ms&&n.matches(e)&&(r=r.add(e))}),r},Lf.prototype.gf=function(t,e,n,r){if(n.size!==e.size)return!0;var i=t===sa.Kn?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.h(r))},Lf.prototype.mf=function(t,e){return Lr()<=Ar.DEBUG&&Ur("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.wf.nh(t,e,Gi.MIN)},Lf),Of=(Pf.prototype.po=function(t){return Nh.resolve(0===this.Jo.length)},Pf.prototype.bo=function(t,e,n){var r=e.batchId,i=this._f(r,"acknowledged");jr(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.Jo[i];return jr(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,Nh.resolve()},Pf.prototype._o=function(t){return Nh.resolve(this.lastStreamToken)},Pf.prototype.Io=function(t,e){return this.lastStreamToken=e,Nh.resolve()},Pf.prototype.To=function(t,e,n,r){jr(0!==r.length,"Mutation batches should not be empty");var i=this.bf;this.bf++,0<this.Jo.length&&jr(this.Jo[this.Jo.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new gh(i,e,n,r);this.Jo.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.yf=this.yf.add(new Eh(u.key,i)),this.do.Ro(t,u.key.path.H())}return Nh.resolve(o)},Pf.prototype.Ao=function(t,e){return Nh.resolve(this.If(e))},Pf.prototype.Po=function(t,e){var n=this.If(e);return jr(null!=n,"Failed to find local mutation batch."),Nh.resolve(n.keys())},Pf.prototype.So=function(t,e){var n=e+1,r=this.Tf(n),i=r<0?0:r;return Nh.resolve(this.Jo.length>i?this.Jo[i]:null)},Pf.prototype.Co=function(){return Nh.resolve(0===this.Jo.length?-1:this.bf-1)},Pf.prototype.ko=function(t){return Nh.resolve(this.Jo.slice())},Pf.prototype.Vo=function(t,n){var r=this,e=new Eh(n,0),i=new Eh(n,Number.POSITIVE_INFINITY),o=[];return this.yf.Lt([e,i],function(t){jr(n.isEqual(t.key),"Should only iterate over a single key's batches");var e=r.If(t.ys);jr(null!==e,"Batches in the index must exist in the main table"),o.push(e)}),Nh.resolve(o)},Pf.prototype.No=function(t,e){var r=this,i=new ao(Hr);return e.forEach(function(e){var t=new Eh(e,0),n=new Eh(e,Number.POSITIVE_INFINITY);r.yf.Lt([t,n],function(t){jr(e.isEqual(t.key),"For each key, should only iterate over a single key's batches"),i=i.add(t.ys)})}),Nh.resolve(this.Ef(i))},Pf.prototype.Fo=function(t,e){jr(!e._i(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;zi.ht(i)||(i=i.child(""));var o=new Eh(new zi(i),0),s=new ao(Hr);return this.yf.Bt(function(t){var e=t.key.path;return!!n.$(e)&&(e.length===r&&(s=s.add(t.ys)),!0)},o),Nh.resolve(this.Ef(s))},Pf.prototype.Ef=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.If(t);null!==e&&r.push(e)}),r},Pf.prototype.Uo=function(n,r){var i=this;jr(0===this._f(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.Jo.shift();var o=this.yf;return Nh.forEach(r.mutations,function(t){var e=new Eh(t.key,r.batchId);return o=o.delete(e),i.vo.Lo(n,t.key)}).next(function(){i.yf=o})},Pf.prototype.jo=function(t){},Pf.prototype.bs=function(t,e){var n=new Eh(e,0),r=this.yf.Mt(n);return Nh.resolve(e.isEqual(r&&r.key))},Pf.prototype.Bo=function(t){return 0===this.Jo.length&&jr(this.yf.J(),"Document leak -- detected dangling mutation references when queue is empty."),Nh.resolve()},Pf.prototype._f=function(t,e){var n=this.Tf(t);return jr(0<=n&&n<this.Jo.length,"Batches must exist to be "+e),n},Pf.prototype.Tf=function(t){return 0===this.Jo.length?0:t-this.Jo[0].batchId},Pf.prototype.If=function(t){var e=this.Tf(t);if(e<0||e>=this.Jo.length)return null;var n=this.Jo[e];return jr(n.batchId===t,"If found batch must match"),n},Pf);function Pf(t,e){this.do=t,this.vo=e,this.Jo=[],this.bf=1,this.lastStreamToken=Ha.Pi,this.yf=new ao(Eh.Bn)}function Lf(){}var Mf,Uf,qf,Vf,Gf=(Zf.prototype.Us=function(t,e,n){jr(!n.isEqual(Gi.MIN),"Cannot add a document with a read time of zero");var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.Rf(e);return this.docs=this.docs.lt(r,{sa:e,size:s,readTime:n}),this.size+=s-o,this.do.Ro(t,r.path.H())},Zf.prototype.js=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Zf.prototype.Ls=function(t,e){var n=this.docs.get(e);return Nh.resolve(n?n.sa:null)},Zf.prototype.getEntries=function(t,e){var n=this,r=iu();return e.forEach(function(t){var e=n.docs.get(t);r=r.lt(t,e?e.sa:null)}),Nh.resolve(r)},Zf.prototype.nh=function(t,e,n){jr(!e._i(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=su(),i=new zi(e.path.child("")),o=this.docs.yt(i);o.At();){var s=o.Rt(),a=s.key,u=s.value,h=u.sa,c=u.readTime;if(!e.path.$(a.path))break;c.h(n)<=0||h instanceof Ms&&e.matches(h)&&(r=r.lt(h.key,h))}return Nh.resolve(r)},Zf.prototype.Af=function(t,e){return Nh.forEach(this.docs,function(t){return e(t)})},Zf.prototype.fc=function(t,e){throw new Error("getNewDocumentChanges() is not supported with MemoryPersistence")},Zf.prototype.dc=function(t){return Nh.resolve(Gi.MIN)},Zf.prototype.Nh=function(t){return new Zf.va(this)},Zf.prototype.wa=function(t){return Nh.resolve(this.size)},Zf.va=(t(tl,Vf=Th),tl.prototype.qs=function(n){var r=this,i=[];return this.Ns.forEach(function(t,e){e?i.push(r.ma.Us(n,e,r.readTime)):r.ma.js(t)}),Nh.ks(i)},tl.prototype.Bs=function(t,e){return this.ma.Ls(t,e)},tl.prototype.Ms=function(t,e){return this.ma.getEntries(t,e)},tl),Zf),jf=($f.prototype.Le=function(t,n){return this.Df.forEach(function(t,e){return n(e)}),Nh.resolve()},$f.prototype.xh=function(t){return Nh.resolve(this.lastRemoteSnapshotVersion)},$f.prototype.Jc=function(t){return Nh.resolve(this.Pf)},$f.prototype.$h=function(t){var e=this.zc.after(this.highestTargetId);return this.highestTargetId=e,Nh.resolve(e)},$f.prototype.Wh=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Pf&&(this.Pf=e),Nh.resolve()},$f.prototype.Yc=function(t){this.Df.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.Pf&&(this.Pf=t.sequenceNumber)},$f.prototype.Zh=function(t,e){return jr(!this.Df.has(e.target),"Adding a target that already exists"),this.Yc(e),this.targetCount+=1,Nh.resolve()},$f.prototype.Qh=function(t,e){return jr(this.Df.has(e.target),"Updating a non-existent target"),this.Yc(e),Nh.resolve()},$f.prototype.$c=function(t,e){return jr(0<this.targetCount,"Removing a target from an empty cache"),jr(this.Df.has(e.target),"Removing a non-existent target from the cache"),this.Df.delete(e.target),this.Sf.ms(e.targetId),this.targetCount-=1,Nh.resolve()},$f.prototype.qc=function(n,r,i){var o=this,s=0,a=[];return this.Df.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.Df.delete(t),a.push(o.Zc(n,e.targetId)),s++)}),Nh.ks(a).next(function(){return s})},$f.prototype.ia=function(t){return Nh.resolve(this.targetCount)},$f.prototype.Xh=function(t,e){var n=this.Df.get(e)||null;return Nh.resolve(n)},$f.prototype.Ye=function(t,e){return Gr("Not yet implemented.")},$f.prototype.Bh=function(e,t,n){this.Sf.ls(t,n);var r=this.persistence.vo,i=[];return r&&t.forEach(function(t){i.push(r.fs(e,t))}),Nh.ks(i)},$f.prototype.Lh=function(e,t,n){this.Sf.ws(t,n);var r=this.persistence.vo,i=[];return r&&t.forEach(function(t){i.push(r.ds(e,t))}),Nh.ks(i)},$f.prototype.Zc=function(t,e){return this.Sf.ms(e),Nh.resolve()},$f.prototype.ic=function(t,e){var n=this.Sf.gs(e);return Nh.resolve(n)},$f.prototype.bs=function(t,e){return Nh.resolve(this.Sf.bs(e))},$f),Ff=(Kf.Vf=function(t,e){return new Kf(t,function(t){return new zf(t,e)})},Kf.Nf=function(t){return new Kf(t,function(t){return new Hf(t)})},Kf.prototype.shutdown=function(){return this.Pa=!1,Promise.resolve()},Object.defineProperty(Kf.prototype,"mh",{get:function(){return this.Pa},enumerable:!0,configurable:!0}),Kf.prototype.uc=function(){return p(this,void 0,void 0,function(){return y(this,function(t){return[2,[this.clientId]]})})},Kf.prototype.Wa=function(t){return t(!0)},Kf.prototype.za=function(){},Kf.prototype.oc=function(t){},Kf.prototype.Eh=function(){return this.do},Kf.prototype.gh=function(t){var e=this.Cf[t.v()];return e||(e=new Of(this.do,this.vo),this.Cf[t.v()]=e),e},Kf.prototype.Ih=function(){return this._h},Kf.prototype.yh=function(){return this.Ho},Kf.prototype.runTransaction=function(t,e,n){var r=this;Ur("MemoryPersistence","Starting transaction:",t);var i=new Bf(this.Ga.next());return this.vo.Of(),n(i).next(function(t){return r.vo.Ff(i).next(function(){return t})}).Ss().then(function(t){return i.Ws(),t})},Kf.prototype.Uf=function(e,n){return Nh.Vs((t=this.Cf,r=[],yi(t,function(t,e){return r.push(e)}),r).map(function(t){return function(){return t.bs(e,n)}}));var t,r},Kf),Bf=(t(Qf,qf=Sh),Qf),Hf=(Object.defineProperty(Xf.prototype,"jf",{get:function(){if(this.xf)return this.xf;throw Gr("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),Xf.prototype.ph=function(t){this.ff=t},Xf.prototype.fs=function(t,e){return this.jf.delete(e),Nh.resolve()},Xf.prototype.ds=function(t,e){return this.jf.add(e),Nh.resolve()},Xf.prototype.Lo=function(t,e){return this.jf.add(e),Nh.resolve()},Xf.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.Ih();return r.ic(t,e.targetId).next(function(t){t.forEach(function(t){return n.jf.add(t)})}).next(function(){return r.$c(t,e)})},Xf.prototype.Of=function(){this.xf=new Set},Xf.prototype.Ff=function(t){var n=this,r=this.persistence.yh().Nh();return Nh.forEach(this.jf,function(e){return n.Lf(t,e).next(function(t){t||r.js(e)})}).next(function(){return n.xf=null,r.apply(t)})},Xf.prototype.Gh=function(t,e){var n=this;return this.Lf(t,e).next(function(t){t?n.jf.delete(e):n.jf.add(e)})},Xf.prototype.kf=function(t){return 0},Xf.prototype.Lf=function(t,e){var n=this;return Nh.Vs([function(){return n.persistence.Ih().bs(t,e)},function(){return n.persistence.Uf(t,e)},function(){return Nh.resolve(n.ff.bs(e))}])},Xf),zf=(Yf.prototype.Of=function(){},Yf.prototype.Ff=function(t){return Nh.resolve()},Yf.prototype.Le=function(t,e){return this.persistence.Ih().Le(t,e)},Yf.prototype.Lc=function(t){var n=this.Mf(t);return this.persistence.Ih().ia(t).next(function(e){return n.next(function(t){return e+t})})},Yf.prototype.Mf=function(t){var e=0;return this.Mc(t,function(t){e++}).next(function(){return e})},Yf.prototype.Mc=function(n,r){var i=this;return Nh.forEach(this.Bf,function(t,e){return i.vf(n,t,e).next(function(t){return t?Nh.resolve():r(e)})})},Yf.prototype.ph=function(t){this.ff=t},Yf.prototype.qc=function(t,e,n){return this.persistence.Ih().qc(t,e,n)},Yf.prototype.Qc=function(t,n){var r=this,i=0,e=this.persistence.yh(),o=e.Nh();return e.Af(t,function(e){return r.vf(t,e,n).next(function(t){t||(i++,o.js(e))})}).next(function(){return o.apply(t)}).next(function(){return i})},Yf.prototype.Lo=function(t,e){return this.Bf.set(e,t.Mh),Nh.resolve()},Yf.prototype.removeTarget=function(t,e){var n=e.Oi(t.Mh);return this.persistence.Ih().Qh(t,n)},Yf.prototype.fs=function(t,e){return this.Bf.set(e,t.Mh),Nh.resolve()},Yf.prototype.ds=function(t,e){return this.Bf.set(e,t.Mh),Nh.resolve()},Yf.prototype.Gh=function(t,e){return this.Bf.set(e,t.Mh),Nh.resolve()},Yf.prototype.kf=function(t){var e=t.key.toString().length;return t instanceof Ms&&(e+=t.data().Nn()),e},Yf.prototype.vf=function(t,e,n){var r=this;return Nh.Vs([function(){return r.persistence.Uf(t,e)},function(){return Nh.resolve(r.ff.bs(e))},function(){return r.persistence.Ih().bs(t,e)},function(){var t=r.Bf.get(e);return Nh.resolve(void 0!==t&&n<t)}])},Yf.prototype.Gc=function(t){return this.persistence.yh().wa(t)},Yf),Jf=(Wf.prototype.reset=function(){this.Wf=0},Wf.prototype.Hf=function(){this.Wf=this.Gf},Wf.prototype.Jf=function(t){var e=this;this.cancel();var n=Math.floor(this.Wf+this.Yf()),r=Math.max(0,Date.now()-this.Kf),i=Math.max(0,n-r);0<this.Wf&&Ur("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Wf+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.zf=this.Aa.Yu(this.Su,i,function(){return e.Kf=Date.now(),t()}),this.Wf*=this.Qf,this.Wf<this.qf&&(this.Wf=this.qf),this.Wf>this.Gf&&(this.Wf=this.Gf)},Wf.prototype.cancel=function(){null!==this.zf&&(this.zf.cancel(),this.zf=null)},Wf.prototype.Yf=function(){return(Math.random()-.5)*this.Wf},Wf);function Wf(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Aa=t,this.Su=e,this.qf=n,this.Qf=r,this.Gf=i,this.Wf=0,this.zf=null,this.Kf=Date.now(),this.reset()}function Yf(t,e){this.persistence=t,this.ff=null,this.Bf=new Ih(function(t){return dh(t.path)}),this.Vc=new vc(this,e)}function Xf(t){this.persistence=t,this.ff=null,this.xf=null}function Qf(t){var e=qf.call(this)||this;return e.Mh=t,e}function Kf(t,e){var n=this;this.clientId=t,this.Cf={},this.Ga=new rh(0),this.Pa=!1,this.Pa=!0,this.vo=e(this),this._h=new jf(this),this.do=new Lc,this.Ho=new Gf(this.do,function(t){return n.vo.kf(t)})}function $f(t){this.persistence=t,this.Df=new Ih(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Gi.MIN,this.highestTargetId=0,this.Pf=0,this.Sf=new bh,this.targetCount=0,this.zc=ec.zo()}function Zf(t,e){this.do=t,this.Rf=e,this.docs=new Ji(zi.G),this.size=0}function tl(t){var e=Vf.call(this)||this;return e.ma=t,e}(Uf=Mf=Mf||{})[Uf.Xf=0]="__PRIVATE_Initial",Uf[Uf.$f=1]="__PRIVATE_Starting",Uf[Uf.Zf=2]="__PRIVATE_Open",Uf[Uf.Error=3]="Error",Uf[Uf.tl=4]="__PRIVATE_Backoff";var el,nl,rl=(pl.prototype.sl=function(){return this.state===Mf.$f||this.state===Mf.Zf||this.state===Mf.tl},pl.prototype.ol=function(){return this.state===Mf.Zf},pl.prototype.start=function(){this.state!==Mf.Error?(jr(this.state===Mf.Xf,"Already started"),this.auth()):this.hl()},pl.prototype.stop=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.sl()?[4,this.close(Mf.Xf)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},pl.prototype.cl=function(){jr(!this.sl(),"Can only inhibit backoff in a stopped state"),this.state=Mf.Xf,this.ul.reset()},pl.prototype.al=function(){var t=this;this.ol()&&null===this.rl&&(this.rl=this.Aa.Yu(this.nl,6e4,function(){return t.fl()}))},pl.prototype.ll=function(t){this.dl(),this.stream.send(t)},pl.prototype.fl=function(){return p(this,void 0,void 0,function(){return y(this,function(t){return this.ol()?[2,this.close(Mf.Xf)]:[2]})})},pl.prototype.dl=function(){this.rl&&(this.rl.cancel(),this.rl=null)},pl.prototype.close=function(e,n){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return jr(this.sl(),"Only started streams should be closed."),jr(e===Mf.Error||ia(n),"Can't provide an error when not in an error state."),this.dl(),this.ul.cancel(),this.el++,e!==Mf.Error?this.ul.reset():n&&n.code===Zr.RESOURCE_EXHAUSTED?(qr(n.toString()),qr("Using maximum backoff delay to prevent overloading the backend."),this.ul.Hf()):n&&n.code===Zr.UNAUTHENTICATED&&this.il.I(),null!==this.stream&&(this.vl(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.wl(n)];case 1:return t.sent(),[2]}})})},pl.prototype.vl=function(){},pl.prototype.auth=function(){var n=this;jr(this.state===Mf.Xf,"Must be in initial state to auth"),this.state=Mf.$f;var t=this.ml(this.el),e=this.el;this.il.getToken().then(function(t){n.el===e&&n.pl(t)},function(e){t(function(){var t=new ti(Zr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.gl(t)})})},pl.prototype.pl=function(t){var e=this;jr(this.state===Mf.$f,"Trying to start stream in a non-starting state");var n=this.ml(this.el);this.stream=this.bl(t),this.stream.yl(function(){n(function(){return jr(e.state===Mf.$f,"Expected stream to be in state Starting, but was "+e.state),e.state=Mf.Zf,e.listener.yl()})}),this.stream.wl(function(t){n(function(){return e.gl(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},pl.prototype.hl=function(){var t=this;jr(this.state===Mf.Error,"Should only perform backoff when in Error state"),this.state=Mf.tl,this.ul.Jf(function(){return p(t,void 0,void 0,function(){return y(this,function(t){return jr(this.state===Mf.tl,"Backoff elapsed but state is now: "+this.state),this.state=Mf.Xf,this.start(),jr(this.sl(),"PersistentStream should have started"),[2]})})})},pl.prototype.gl=function(t){return jr(this.sl(),"Can't handle server close on non-started stream"),Ur("PersistentStream","close with error: "+t),this.stream=null,this.close(Mf.Error,t)},pl.prototype.ml=function(e){var n=this;return function(t){n.Aa.xu(function(){return n.el===e?t():(Ur("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},pl),il=(t(ll,nl=rl),ll.prototype.bl=function(t){return this.connection._l("Listen",t)},ll.prototype.onMessage=function(t){this.ul.reset();var e=this.serializer.Cr(t),n=this.serializer.Vr(t);return this.listener.Il(e,n)},ll.prototype.watch=function(t){var e={};e.database=this.serializer.wr,e.addTarget=this.serializer.li(t);var n=this.serializer.Zr(t);n&&(e.labels=n),this.ll(e)},ll.prototype.Tl=function(t){var e={};e.database=this.serializer.wr,e.removeTarget=t,this.ll(e)},ll),ol=(t(fl,el=rl),Object.defineProperty(fl.prototype,"Rl",{get:function(){return this.El},enumerable:!0,configurable:!0}),fl.prototype.start=function(){this.El=!1,el.prototype.start.call(this)},fl.prototype.vl=function(){this.El&&this.Al([])},fl.prototype.bl=function(t){return this.connection._l("Write",t)},fl.prototype.onMessage=function(t){if(jr(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=this.serializer.er(t.streamToken),this.El){this.ul.reset();var e=this.serializer.qr(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.Dl(n,e)}return jr(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.El=!0,this.listener.Pl()},fl.prototype.Sl=function(){jr(this.ol(),"Writing handshake requires an opened stream"),jr(!this.El,"Handshake already completed");var t={};t.database=this.serializer.wr,this.ll(t)},fl.prototype.Al=function(t){var e=this;jr(this.ol(),"Writing mutations requires an opened stream"),jr(this.El,"Handshake must be complete before writing mutations"),jr(0<this.lastStreamToken.Nn(),"Trying to write mutation without a token");var n={streamToken:this.serializer.ir(this.lastStreamToken),writes:t.map(function(t){return e.serializer.Nr(t)})};this.ll(n)},fl),sl=(cl.prototype.Cl=function(t){return new ol(this.Aa,this.connection,this.credentials,this.serializer,t)},cl.prototype.kl=function(t){return new il(this.Aa,this.connection,this.credentials,this.serializer,t)},cl.prototype.commit=function(t){var e=this,n={database:this.serializer.wr,writes:t.map(function(t){return e.serializer.Nr(t)})};return this.Vl("Commit",n).then(function(t){return e.serializer.qr(t.writeResults,t.commitTime)})},cl.prototype.lookup=function(e){var i=this,t={database:this.serializer.wr,documents:e.map(function(t){return i.serializer.cr(t)})};return this.Nl("BatchGetDocuments",t).then(function(t){var n=ru();t.forEach(function(t){var e=i.serializer.Dr(t);n=n.lt(e.key,e)});var r=[];return e.forEach(function(t){var e=n.get(t);jr(!!e,"Missing entity in write response for "+t),r.push(e)}),r})},cl.prototype.Vl=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.Vl(e,n,t)}).catch(function(t){throw t.code===Zr.UNAUTHENTICATED&&r.credentials.I(),t})},cl.prototype.Nl=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.Nl(e,n,t)}).catch(function(t){throw t.code===Zr.UNAUTHENTICATED&&r.credentials.I(),t})},cl),al=(hl.documentId=function(){return hl.Fl},hl.prototype.isEqual=function(t){if(!(t instanceof hl))throw xi("isEqual","FieldPath",1,t);return this.Ol.isEqual(t.Ol)},hl.Fl=new hl(Hi.st().nt()),hl),ul=new RegExp("[~\\*/\\[\\]]");function hl(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(){if(!(t instanceof Array)||t.length<1)throw new ti(Zr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+Pi(1,"element")+".")}();for(var n=0;n<t.length;++n)if(Ei("FieldPath","string",n,t[n]),0===t[n].length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.Ol=new Hi(t)}function cl(t,e,n,r){this.Aa=t,this.connection=e,this.credentials=n,this.serializer=r}function fl(t,e,n,r,i){var o=el.call(this,t,Zu.Tu,Zu.Iu,e,n,i)||this;return o.serializer=r,o.El=!1,o.lastStreamToken=Ha.Pi,o}function ll(t,e,n,r,i){var o=nl.call(this,t,Zu._u,Zu.yu,e,n,i)||this;return o.serializer=r,o}function pl(t,e,n,r,i,o){this.Aa=t,this.nl=n,this.connection=r,this.il=i,this.listener=o,this.state=Mf.Xf,this.el=0,this.rl=null,this.stream=null,this.ul=new Jf(t,e)}var dl,yl,vl,ml,gl,wl,bl,El=(ql.delete=function(){return mi("FieldValue.delete",arguments),Il.instance},ql.serverTimestamp=function(){return mi("FieldValue.serverTimestamp",arguments),Nl.instance},ql.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return wi("FieldValue.arrayUnion",arguments,1),new Tl(t)},ql.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return wi("FieldValue.arrayRemove",arguments,1),new Al(t)},ql.increment=function(t){return Ei("FieldValue.increment","number",1,t),gi("FieldValue.increment",arguments,1),new Sl(t)},ql.prototype.isEqual=function(t){return this===t},ql),Il=(t(Ul,bl=El),Ul.instance=new Ul,Ul),Nl=(t(Ml,wl=El),Ml.instance=new Ml,Ml),Tl=(t(Ll,gl=El),Ll),Al=(t(Pl,ml=El),Pl),Sl=(t(Ol,vl=El),Ol),kl=Xu(El,"Use FieldValue.<field>() instead."),Dl=/^__.*__$/,Rl=(Cl.prototype.Ll=function(t,e){var n=[];return null!==this.on?n.push(new Go(t,this.data,this.on,e)):n.push(new Vo(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new jo(t,this.fieldTransforms)),n},Cl),_l=(xl.prototype.Ll=function(t,e){var n=[new Go(t,this.data,this.on,e)];return 0<this.fieldTransforms.length&&n.push(new jo(t,this.fieldTransforms)),n},xl);function xl(t,e,n){this.data=t,this.on=e,this.fieldTransforms=n}function Cl(t,e,n){this.data=t,this.on=e,this.fieldTransforms=n}function Ol(t){var e=vl.call(this,"FieldValue.increment")||this;return e.jl=t,e}function Pl(t){var e=ml.call(this,"FieldValue.arrayRemove")||this;return e.xl=t,e}function Ll(t){var e=gl.call(this,"FieldValue.arrayUnion")||this;return e.xl=t,e}function Ml(){return wl.call(this,"FieldValue.serverTimestamp")||this}function Ul(){return bl.call(this,"FieldValue.delete")||this}function ql(t){this.Ul=t}function Vl(t){switch(t){case dl.Set:case dl.Bl:case dl.Ml:return!0;case dl.ql:case dl.Ql:return!1;default:throw Gr("Unexpected case for UserDataSource: "+t)}}(yl=dl=dl||{})[yl.Set=0]="Set",yl[yl.Ml=1]="__PRIVATE_Update",yl[yl.Bl=2]="__PRIVATE_MergeSet",yl[yl.ql=3]="__PRIVATE_Argument",yl[yl.Ql=4]="__PRIVATE_ArrayArgument";var Gl=(Hl.prototype.Kl=function(t){var e=null==this.path?null:this.path.child(t),n=new Hl(this.Gl,this.methodName,e,!1,this.fieldTransforms,this.on);return n.Hl(t),n},Hl.prototype.Jl=function(t){var e=null==this.path?null:this.path.child(t),n=new Hl(this.Gl,this.methodName,e,!1,this.fieldTransforms,this.on);return n.zl(),n},Hl.prototype.Yl=function(t){return new Hl(this.Gl,this.methodName,null,!0,this.fieldTransforms,this.on)},Hl.prototype.Xl=function(t){var e=null===this.path||this.path.J()?"":" (found in field "+this.path.toString()+")";return new ti(Zr.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},Hl.prototype.contains=function(e){return void 0!==this.on.find(function(t){return e.$(t)})||void 0!==this.fieldTransforms.find(function(t){return e.$(t.field)})},Hl.prototype.zl=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.Hl(this.path.get(t))},Hl.prototype.Hl=function(t){if(0===t.length)throw this.Xl("Document fields must not be empty");if(Vl(this.Gl)&&Dl.test(t))throw this.Xl('Document fields cannot begin and end with "__"')},Hl),jl=function(t,e){this.s=t,this.key=e},Fl=(Bl.prototype.Zl=function(t,e){var n=new Gl(dl.Set,t,Hi.et);Jl("Data must be an object, but it was:",n,e);var r=this.td(e,n);return new Rl(r,null,n.fieldTransforms)},Bl.prototype.nd=function(t,e,n){var r=new Gl(dl.Bl,t,Hi.et);Jl("Data must be an object, but it was:",r,e);var i,o,s=this.td(e,r);if(n){for(var a=new ao(Hi.G),u=0,h=n;u<h.length;u++){var c=h[u],f=void 0;if(c instanceof al)f=c.Ol;else{if("string"!=typeof c)throw Gr("Expected stringOrFieldPath to be a string or a FieldPath");f=Yl(t,c)}if(!r.contains(f))throw new ti(Zr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");a=a.add(f)}i=To.Jt(a),o=r.fieldTransforms.filter(function(t){return i.Xt(t.field)})}else i=To.Yt(r.on),o=r.fieldTransforms;return new Rl(s,i,o)},Bl.prototype.ed=function(o,t){var s=this,a=new Gl(dl.Ml,o,Hi.et);Jl("Data must be an object, but it was:",a,t);var u=new ao(Hi.G),h=Cs.mn();yi(t,function(t,e){var n=Yl(o,t),r=a.Jl(n);if((e=s.rd(e,r))instanceof Il)u=u.add(n);else{var i=s.td(e,r);null!=i&&(u=u.add(n),h.set(n,i))}});var e=To.Jt(u);return new _l(h.fn(),e,a.fieldTransforms)},Bl.prototype.ud=function(t,e,n,r){var i=new Gl(dl.Ml,t,Hi.et),o=[Wl(t,e)],s=[n];if(r.length%2!=0)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var a=0;a<r.length;a+=2)o.push(Wl(t,r[a])),s.push(r[a+1]);var u=new ao(Hi.G),h=Cs.mn();for(a=0;a<o.length;++a){var c=o[a],f=i.Jl(c),l=this.rd(s[a],f);if(l instanceof Il)u=u.add(c);else{var p=this.td(l,f);null!=p&&(u=u.add(c),h.set(c,p))}}var d=To.Jt(u);return new _l(h.fn(),d,i.fieldTransforms)},Bl.prototype.sd=function(t,e,n){void 0===n&&(n=!1);var r=new Gl(n?dl.Ql:dl.ql,t,Hi.et),i=this.td(e,r);return jr(null!=i,"Parsed data should not be null."),jr(0===r.fieldTransforms.length,"Field transforms should have been disallowed."),i},Bl.prototype.rd=function(t,e){try{return this.$l(t)}catch(t){var n=Xl(t);throw e.Xl(n)}},Bl.prototype.td=function(t,e){if(zl(t=this.rd(t,e)))return Jl("Unsupported field value:",e,t),this.od(t,e);if(t instanceof El)return this.hd(t,e),null;if(e.path&&e.on.push(e.path),t instanceof Array){if(e.Wl&&e.Gl!==dl.Ql)throw e.Xl("Nested arrays are not supported");return this.ad(t,e)}return this.fd(t,e)},Bl.prototype.od=function(t,r){var i=this,o=new Ji(Hr);return vi(t)?r.path&&0<r.path.length&&r.on.push(r.path):yi(t,function(t,e){var n=i.td(e,r.Kl(t));null!=n&&(o=o.lt(t,n))}),new Cs(o)},Bl.prototype.ad=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=o[i],a=this.td(s,e.Yl(r));null==a&&(a=ns.On),n.push(a),r++}return new Ps(n)},Bl.prototype.hd=function(t,e){if(!Vl(e.Gl))throw e.Xl(t.Ul+"() can only be used with update() and set()");if(null===e.path)throw e.Xl(t.Ul+"() is not currently supported inside arrays");if(t instanceof Il){if(e.Gl!==dl.Bl)throw e.Gl===dl.Ml?(jr(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.Xl("FieldValue.delete() can only appear at the top level of your update data")):e.Xl("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.on.push(e.path)}else if(t instanceof Nl)e.fieldTransforms.push(new Ao(e.path,ho.instance));else if(t instanceof Tl){var n=this.ld(t.Ul,t.xl),r=new co(n);e.fieldTransforms.push(new Ao(e.path,r))}else if(t instanceof Al){n=this.ld(t.Ul,t.xl);var i=new fo(n);e.fieldTransforms.push(new Ao(e.path,i))}else if(t instanceof Sl){var o=this.sd("FieldValue.increment",t.jl),s=new lo(o);e.fieldTransforms.push(new Ao(e.path,s))}else Gr("Unknown FieldValue type: "+t)},Bl.prototype.fd=function(t,e){if(null===t)return ns.On;if("number"==typeof t)return oa(t)?new Ts(t):new As(t);if("boolean"==typeof t)return rs.of(t);if("string"==typeof t)return new Ss(t);if(t instanceof Date)return new ks(Vi.fromDate(t));if(t instanceof Vi)return new ks(new Vi(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof Ui)return new xs(t);if(t instanceof eh)return new Rs(t);if(t instanceof jl)return new _s(t.s,t.key);throw e.Xl("Unsupported field value: "+Di(t))},Bl.prototype.ld=function(r,t){var i=this;return t.map(function(t,e){var n=new Gl(dl.ql,r,Hi.et);return i.td(t,n.Yl(e))})},Bl);function Bl(t){this.$l=t}function Hl(t,e,n,r,i,o){this.Gl=t,this.methodName=e,this.path=n,this.Wl=r,void 0===i&&this.zl(),this.Wl=void 0!==r&&r,this.fieldTransforms=i||[],this.on=o||[]}function zl(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Vi||t instanceof Ui||t instanceof eh||t instanceof jl||t instanceof El)}function Jl(t,e,n){if(!zl(n)||!ki(n)){var r=Di(n);throw"an object"===r?e.Xl(t+" a custom object"):e.Xl(t+" "+r)}}function Wl(t,e){if(e instanceof al)return e.Ol;if("string"==typeof e)return Yl(t,e);throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Yl(e,t){try{return function(e){if(0<=e.search(ul))throw new ti(Zr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(al.bind.apply(al,s([void 0],e.split("."))))}catch(t){throw new ti(Zr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(t).Ol}catch(t){var n=Xl(t);throw new ti(Zr.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. "+n)}}function Xl(t){return t instanceof Error?t.message:t.toString()}var Ql=(rp.prototype.lookup=function(r){return p(this,void 0,void 0,function(){var e,n=this;return y(this,function(t){switch(t.label){case 0:if(this.gd(),0<this.mutations.length)throw new ti(Zr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.dd.lookup(r)];case 1:return(e=t.sent()).forEach(function(t){t instanceof Us||t instanceof Ms?n.bd(t):Gr("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},rp.prototype.set=function(t,e){this.write(e.Ll(t,this.rn(t))),this.pd.add(t)},rp.prototype.update=function(t,e){try{this.write(e.Ll(t,this.yd(t)))}catch(t){this.md=t}this.pd.add(t)},rp.prototype.delete=function(t){this.write([new Fo(t,this.rn(t))]),this.pd.add(t)},rp.prototype.commit=function(){return p(this,void 0,void 0,function(){var e,n=this;return y(this,function(t){switch(t.label){case 0:if(this.gd(),this.md)throw this.md;return e=this.vd,this.mutations.forEach(function(t){e=e.remove(t.key)}),e.forEach(function(t,e){n.mutations.push(new Bo(t,n.rn(t)))}),[4,this.dd.commit(this.mutations)];case 1:return t.sent(),this.wd=!0,[2]}})})},rp.prototype.bd=function(t){var e;if(t instanceof Ms)e=t.version;else{if(!(t instanceof Us))throw Gr("Document in a transaction was a "+t.constructor.name);e=Gi.B()}var n=this.vd.get(t.key);if(null!==n){if(!e.isEqual(n))throw new ti(Zr.ABORTED,"Document version changed between two reads.")}else this.vd=this.vd.lt(t.key,e)},rp.prototype.rn=function(t){var e=this.vd.get(t);return!this.pd.has(t)&&e?Uo.updateTime(e):Uo.NONE},rp.prototype.yd=function(t){var e=this.vd.get(t);if(this.pd.has(t)||!e)return Uo.exists(!0);if(e.isEqual(Gi.B()))throw new ti(Zr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Uo.updateTime(e)},rp.prototype.write=function(t){this.gd(),this.mutations=this.mutations.concat(t)},rp.prototype.gd=function(){jr(!this.wd,"A transaction object cannot be used after its update callback has been invoked.")},rp),Kl=(np.prototype.Rd=function(){var t=this;0===this.Id&&(this.Ad("Unknown"),jr(null===this.Td,"onlineStateTimer shouldn't be started yet"),this.Td=this.Pu.Yu(Zu.Eu,1e4,function(){return t.Td=null,jr("Unknown"===t.state,"Timer should be canceled if we transitioned to a different state."),t.Dd("Backend didn't respond within 10 seconds."),t.Ad("Offline"),Promise.resolve()}))},np.prototype.Pd=function(t){"Online"===this.state?(this.Ad("Unknown"),jr(0===this.Id,"watchStreamFailures must be 0"),jr(null===this.Td,"onlineStateTimer must be null")):(this.Id++,1<=this.Id&&(this.Sd(),this.Dd("Connection failed 1 times. Most recent error: "+t.toString()),this.Ad("Offline")))},np.prototype.set=function(t){this.Sd(),this.Id=0,"Online"===t&&(this.Ed=!1),this.Ad(t)},np.prototype.Ad=function(t){t!==this.state&&(this.state=t,this._d(t))},np.prototype.Dd=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Ed?(qr(e),this.Ed=!1):Ur("OnlineStateTracker",e)},np.prototype.Sd=function(){null!==this.Td&&(this.Td.cancel(),this.Td=null)},np),$l="RemoteStore",Zl=(ep.prototype.start=function(){return this.enableNetwork()},ep.prototype.enableNetwork=function(){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.networkEnabled=!0,this.Fd()?(e=this.qd,[4,this.Nc._o()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.zd()?this.Kd():this.xd.set("Unknown"),[4,this.Hd()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},ep.prototype.disableNetwork=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.Jd()];case 1:return t.sent(),this.xd.set("Offline"),[2]}})})},ep.prototype.Jd=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return[4,this.qd.stop()];case 1:return t.sent(),[4,this.jd.stop()];case 2:return t.sent(),0<this.Cd.length&&(Ur($l,"Stopping write stream with "+this.Cd.length+" pending writes"),this.Cd=[]),this.Yd(),[2]}})})},ep.prototype.shutdown=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return Ur($l,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.Jd()];case 1:return t.sent(),this.Nd.shutdown(),this.xd.set("Unknown"),[2]}})})},ep.prototype.listen=function(t){li(this.kd,t.targetId)||(this.kd[t.targetId]=t,this.zd()?this.Kd():this.jd.ol()&&this.Xd(t))},ep.prototype.$d=function(t){jr(li(this.kd,t),"unlisten called on target no currently watched: "+t),delete this.kd[t],this.jd.ol()&&this.Zd(t),vi(this.kd)&&(this.jd.ol()?this.jd.al():this.Fd()&&this.xd.set("Unknown"))},ep.prototype.Ye=function(t){return this.kd[t]||null},ep.prototype.Je=function(t){return this.tv.Je(t)},ep.prototype.Xd=function(t){this.Vd.De(t.targetId),this.jd.watch(t)},ep.prototype.Zd=function(t){this.Vd.De(t),this.jd.Tl(t)},ep.prototype.Kd=function(){jr(this.zd(),"startWatchStream() called when shouldStartWatchStream() is false."),this.Vd=new Ou(this),this.jd.start(),this.xd.Rd()},ep.prototype.zd=function(){return this.Fd()&&!this.jd.sl()&&!vi(this.kd)},ep.prototype.Fd=function(){return this.isPrimary&&this.networkEnabled},ep.prototype.Yd=function(){this.Vd=null},ep.prototype.Ld=function(){return p(this,void 0,void 0,function(){var n=this;return y(this,function(t){return di(this.kd,function(t,e){n.Xd(e)}),[2]})})},ep.prototype.Bd=function(e){return p(this,void 0,void 0,function(){return y(this,function(t){return void 0===e&&jr(!this.zd(),"Watch stream was stopped gracefully while still needed."),this.Yd(),this.zd()?(this.xd.Pd(e),this.Kd()):this.xd.set("Unknown"),[2]})})},ep.prototype.Md=function(n,r){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.xd.set("Online"),n instanceof xu&&n.state===Eu.Mi&&n.cause?[2,this.nv(n)]:(n instanceof wu?this.Vd.Fe(n):n instanceof bu?this.Vd.Qe(n):(jr(n instanceof xu,"Expected watchChange to be an instance of WatchTargetChange"),this.Vd.je(n)),r.isEqual(Gi.MIN)?[3,3]:[4,this.Nc.xh()]);case 1:return e=t.sent(),0<=r.h(e)?[4,this.iv(r)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},ep.prototype.iv=function(r){var i=this;jr(!r.isEqual(Gi.MIN),"Can't raise event for unknown SnapshotVersion");var t=this.Vd.ze(r);return di(t.Zi,function(t,e){if(0<e.resumeToken.Nn()){var n=i.kd[t];n&&(i.kd[t]=n.Fi(e.resumeToken,r))}}),t.te.forEach(function(t){var e=i.kd[t];if(e){i.kd[t]=e.Fi(Ha.Pi,e.Ni),i.Zd(t);var n=new Qa(e.target,t,Fa.Ci,e.sequenceNumber);i.Xd(n)}}),this.tv.jh(t)},ep.prototype.nv=function(t){var n=this;jr(!!t.cause,"Handling target error without a cause");var r=t.cause,i=Promise.resolve();return t.targetIds.forEach(function(e){i=i.then(function(){return p(n,void 0,void 0,function(){return y(this,function(t){return li(this.kd,e)?(delete this.kd[e],this.Vd.removeTarget(e),[2,this.tv.ev(e,r)]):[2]})})})}),i},ep.prototype.Hd=function(){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:return this.rv()?(e=0<this.Cd.length?this.Cd[this.Cd.length-1].batchId:-1,[4,this.Nc.Hh(e)]):[3,4];case 1:return null!==(n=t.sent())?[3,2]:(0===this.Cd.length&&this.qd.al(),[3,4]);case 2:return this.uv(n),[4,this.Hd()];case 3:t.sent(),t.label=4;case 4:return this.sv()&&this.ov(),[2]}})})},ep.prototype.rv=function(){return this.Fd()&&this.Cd.length<10},ep.prototype.hv=function(){return this.Cd.length},ep.prototype.uv=function(t){jr(this.rv(),"addToWritePipeline called when pipeline is full"),this.Cd.push(t),this.qd.ol()&&this.qd.Rl&&this.qd.Al(t.mutations)},ep.prototype.sv=function(){return this.Fd()&&!this.qd.sl()&&0<this.Cd.length},ep.prototype.ov=function(){jr(this.sv(),"startWriteStream() called when shouldStartWriteStream() is false."),this.qd.start()},ep.prototype.Qd=function(){return p(this,void 0,void 0,function(){return y(this,function(t){return this.qd.Sl(),[2]})})},ep.prototype.Wd=function(){var r=this;return this.Nc.Io(this.qd.lastStreamToken).then(function(){for(var t=0,e=r.Cd;t<e.length;t++){var n=e[t];r.qd.Al(n.mutations)}}).catch(cc)},ep.prototype.Dl=function(t,e){var n=this;jr(0<this.Cd.length,"Got result for empty write pipeline");var r=this.Cd.shift(),i=wh.from(r,t,e,this.qd.lastStreamToken);return this.tv.cv(i).then(function(){return n.Hd()})},ep.prototype.Gd=function(n){return p(this,void 0,void 0,function(){var e=this;return y(this,function(t){return void 0===n&&jr(!this.sv(),"Write stream was stopped gracefully while still needed."),n&&0<this.Cd.length?[2,(this.qd.Rl?this.av(n):this.fv(n)).then(function(){e.sv()&&e.ov()})]:[2]})})},ep.prototype.fv=function(e){return p(this,void 0,void 0,function(){return y(this,function(t){return tu(e.code)?(Ur($l,"RemoteStore error before completed handshake; resetting stream token: ",this.qd.lastStreamToken),this.qd.lastStreamToken=Ha.Pi,[2,this.Nc.Io(Ha.Pi).catch(cc)]):[2]})})},ep.prototype.av=function(i){return p(this,void 0,void 0,function(){var n,r=this;return y(this,function(t){return tu(e=i.code)&&e!==Zr.ABORTED?(n=this.Cd.shift(),this.qd.cl(),[2,this.tv.lv(n.batchId,i).then(function(){return r.Hd()})]):[2];var e})})},ep.prototype.dv=function(){return new Ql(this.dd)},ep.prototype.Ud=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.Jd()];case 1:return t.sent(),this.xd.set("Unknown"),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},ep.prototype.vv=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.Fd()?(Ur($l,"RemoteStore restarting streams for new credential"),[4,this.Ud()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},ep.prototype.wv=function(e){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,4];case 2:return e?[3,4]:[4,this.Jd()];case 3:t.sent(),this.xd.set("Unknown"),t.label=4;case 4:return[2]}})})},ep),tp="firestore_clients";function ep(t,e,n,r,i){var o=this;this.Nc=t,this.dd=e,this.Cd=[],this.kd={},this.Vd=null,this.networkEnabled=!1,this.isPrimary=!1,this.Nd=i,this.Nd.Od(function(t){n.xu(function(){return p(o,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.Fd()?(Ur($l,"Restarting streams for network reachability change."),[4,this.Ud()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.xd=new Kl(n,r),this.jd=this.dd.kl({yl:this.Ld.bind(this),wl:this.Bd.bind(this),Il:this.Md.bind(this)}),this.qd=this.dd.Cl({yl:this.Qd.bind(this),wl:this.Gd.bind(this),Pl:this.Wd.bind(this),Dl:this.Dl.bind(this)})}function np(t,e){this.Pu=t,this._d=e,this.state="Unknown",this.Id=0,this.Td=null,this.Ed=!0}function rp(t){this.dd=t,this.vd=uu(),this.mutations=[],this.wd=!1,this.md=null,this.pd=new Set}function ip(t,e){return jr(-1===e.indexOf("_"),"Client key cannot contain '_', but was '"+e+"'"),tp+"_"+t+"_"+e}var op="firestore_mutations";function sp(t,e,n){var r=op+"_"+t+"_"+n;return e.l()&&(r+="_"+e.uid),r}var ap="firestore_targets";function up(t,e){return ap+"_"+t+"_"+e}var hp="SharedClientState",cp=(Ep.mv=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new ti(r.error.code,r.error.message)),i?new Ep(t,e,r.state,o):(qr(hp,"Failed to parse mutation state for ID '"+e+"': "+n),null)},Ep.prototype.pv=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Ep),fp=(bp.mv=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new ti(n.error.code,n.error.message)),r?new bp(t,n.state,i):(qr(hp,"Failed to parse target state for ID '"+t+"': "+e),null)},bp.prototype.pv=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},bp),lp=(wp.mv=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=lu(),o=0;r&&o<n.activeTargetIds.length;++o)r=oa(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new wp(t,i):(qr(hp,"Failed to parse client data for instance '"+t+"': "+e),null)},wp),pp=(gp.mv=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new gp(e.clientId,e.onlineState):(qr(hp,"Failed to parse online state: "+t),null)},gp),dp=(mp.prototype.gv=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},mp.prototype.bv=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},mp.prototype.pv=function(){var t={activeTargetIds:this.activeTargetIds.tt(),updateTimeMs:Date.now()};return JSON.stringify(t)},mp),yp=(vp.Hs=function(t){return!(!t.window||null==t.window.localStorage)},vp.prototype.start=function(){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,h,c,f,l=this;return y(this,function(t){switch(t.label){case 0:return jr(!this.mh,"WebStorageSharedClientState already started"),jr(null!==this.tv,"syncEngine property must be set before calling start()"),jr(null!==this._d,"onlineStateHandler property must be set before calling start()"),[4,this.tv.uc()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.yv&&(o=this.getItem(ip(this.persistenceKey,i)))&&(s=lp.mv(i,o))&&(this._v[s.clientId]=s);for(this.kv(),(a=this.storage.getItem(this.Cv))&&(u=this.Vv(a))&&this.Nv(u),h=0,c=this.Ev;h<c.length;h++)f=c[h],this.Tv(f);return this.Ev=[],this.platform.window.addEventListener("unload",function(){return l.shutdown()}),this.mh=!0,[2]}})})},vp.prototype.pu=function(t){this.setItem(this.Av,JSON.stringify(t))},vp.prototype.Ov=function(){var n=lu();return yi(this._v,function(t,e){n=n.qt(e.activeTargetIds)}),n},vp.prototype.Fv=function(t){for(var e in this._v)if(this._v.hasOwnProperty(e)&&this._v[e].activeTargetIds.has(t))return!0;return!1},vp.prototype.Uv=function(t){this.xv(t,"pending")},vp.prototype.jv=function(t,e,n){this.xv(t,e,n),this.Lv(t)},vp.prototype.Bv=function(t){var e="not-current";if(this.Fv(t)){var n=this.storage.getItem(up(this.persistenceKey,t));if(n){var r=fp.mv(t,n);r&&(e=r.state)}}return this.Mv.gv(t),this.kv(),e},vp.prototype.qv=function(t){this.Mv.bv(t),this.kv()},vp.prototype.Qv=function(t){return this.Mv.activeTargetIds.has(t)},vp.prototype.Gv=function(t){this.removeItem(up(this.persistenceKey,t))},vp.prototype.Wv=function(t,e,n){this.zv(t,e,n)},vp.prototype.Dh=function(t,e,n){var r=this;e.forEach(function(t){r.Lv(t)}),this.currentUser=t,n.forEach(function(t){r.Uv(t)})},vp.prototype.Kv=function(t){this.Hv(t)},vp.prototype.shutdown=function(){this.mh&&(this.platform.window.removeEventListener("storage",this.Iv),this.removeItem(this.Rv),this.mh=!1)},vp.prototype.getItem=function(t){var e=this.storage.getItem(t);return Ur(hp,"READ",t,e),e},vp.prototype.setItem=function(t,e){Ur(hp,"SET",t,e),this.storage.setItem(t,e)},vp.prototype.removeItem=function(t){Ur(hp,"REMOVE",t),this.storage.removeItem(t)},vp.prototype.Tv=function(a){var t=this;if(a.storageArea===this.storage){if(Ur(hp,"EVENT",a.key,a.newValue),a.key===this.Rv)return void qr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Aa.xu(function(){return p(t,void 0,void 0,function(){var e,n,r,i,o,s;return y(this,function(t){if(!this.mh)return this.Ev.push(a),[2];if(null===a.key)return[2];if(this.Dv.test(a.key)){if(null==a.newValue)return n=this.Jv(a.key),[2,this.Yv(n,null)];if(e=this.Xv(a.key,a.newValue))return[2,this.Yv(e.clientId,e)]}else if(this.Pv.test(a.key)){if(null!==a.newValue&&(r=this.$v(a.key,a.newValue)))return[2,this.Zv(r)]}else if(this.Sv.test(a.key)){if(null!==a.newValue&&(i=this.tw(a.key,a.newValue)))return[2,this.nw(i)]}else if(a.key===this.Cv){if(null!==a.newValue&&(o=this.Vv(a.newValue)))return[2,this.Nv(o)]}else a.key===this.Av&&(jr(!!this.vu,"Missing sequenceNumberHandler"),(s=function(t){var e=rh.gu;if(null!=t)try{var n=JSON.parse(t);jr("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){qr(hp,"Failed to read sequence number from WebStorage",t)}return e}(a.newValue))!==rh.gu&&this.vu(s));return[2]})})})}},Object.defineProperty(vp.prototype,"Mv",{get:function(){return this._v[this.yv]},enumerable:!0,configurable:!0}),vp.prototype.kv=function(){this.setItem(this.Rv,this.Mv.pv())},vp.prototype.xv=function(t,e,n){var r=new cp(this.currentUser,t,e,n),i=sp(this.persistenceKey,this.currentUser,t);this.setItem(i,r.pv())},vp.prototype.Lv=function(t){var e=sp(this.persistenceKey,this.currentUser,t);this.removeItem(e)},vp.prototype.Hv=function(t){var e={clientId:this.yv,onlineState:t};this.storage.setItem(this.Cv,JSON.stringify(e))},vp.prototype.zv=function(t,e,n){var r=up(this.persistenceKey,t),i=new fp(t,e,n);this.setItem(r,i.pv())},vp.prototype.Jv=function(t){var e=this.Dv.exec(t);return e?e[1]:null},vp.prototype.Xv=function(t,e){var n=this.Jv(t);return jr(null!==n,"Cannot parse client state key '"+t+"'"),lp.mv(n,e)},vp.prototype.$v=function(t,e){var n=this.Pv.exec(t);jr(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return cp.mv(new $r(i),r,e)},vp.prototype.tw=function(t,e){var n=this.Sv.exec(t);jr(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return fp.mv(r,e)},vp.prototype.Vv=function(t){return pp.mv(t)},vp.prototype.Zv=function(e){return p(this,void 0,void 0,function(){return y(this,function(t){return e.user.uid!==this.currentUser.uid?(Ur(hp,"Ignoring mutation for non-active user "+e.user.uid),[2]):[2,this.tv.iw(e.batchId,e.state,e.error)]})})},vp.prototype.nw=function(t){return this.tv.ew(t.targetId,t.state,t.error)},vp.prototype.Yv=function(t,e){var n=this,r=this.Ov();e?this._v[t]=e:delete this._v[t];var i=this.Ov(),o=[],s=[];return i.forEach(function(e){return p(n,void 0,void 0,function(){return y(this,function(t){return r.has(e)||o.push(e),[2]})})}),r.forEach(function(e){return p(n,void 0,void 0,function(){return y(this,function(t){return i.has(e)||s.push(e),[2]})})}),this.tv.rw(o,s)},vp.prototype.Nv=function(t){this._v[t.clientId]&&this._d(t.onlineState)},vp);function vp(t,e,n,r,i){if(this.Aa=t,this.platform=e,this.persistenceKey=n,this.yv=r,this.tv=null,this._d=null,this.vu=null,this._v={},this.Iv=this.Tv.bind(this),this.mh=!1,this.Ev=[],!vp.Hs(this.platform))throw new ti(Zr.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.Rv=ip(this.persistenceKey,this.yv),this.Av="firestore_sequence_number_"+this.persistenceKey,this._v[this.yv]=new dp,this.Dv=new RegExp("^"+tp+"_"+o+"_([^_]*)$"),this.Pv=new RegExp("^"+op+"_"+o+"_(\\d+)(?:_(.*))?$"),this.Sv=new RegExp("^"+ap+"_"+o+"_(\\d+)$"),this.Cv="firestore_online_state_"+this.persistenceKey,this.platform.window.addEventListener("storage",this.Iv)}function mp(){this.activeTargetIds=lu()}function gp(t,e){this.clientId=t,this.onlineState=e}function wp(t,e){this.clientId=t,this.activeTargetIds=e}function bp(t,e,n){this.targetId=t,this.state=e,jr(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}function Ep(t,e,n,r){this.user=t,this.batchId=e,this.state=n,jr(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}function Ip(t){this.key=t}function Np(t){this.key=t}var Tp=(kp.prototype.Uv=function(t){},kp.prototype.jv=function(t,e,n){},kp.prototype.Bv=function(t){return this.uw.gv(t),this.sw[t]||"not-current"},kp.prototype.Wv=function(t,e,n){this.sw[t]=e},kp.prototype.qv=function(t){this.uw.bv(t)},kp.prototype.Qv=function(t){return this.uw.activeTargetIds.has(t)},kp.prototype.Gv=function(t){delete this.sw[t]},kp.prototype.Ov=function(){return this.uw.activeTargetIds},kp.prototype.Fv=function(t){return this.uw.activeTargetIds.has(t)},kp.prototype.start=function(){return this.uw=new dp,Promise.resolve()},kp.prototype.Dh=function(t,e,n){},kp.prototype.Kv=function(t){},kp.prototype.shutdown=function(){},kp.prototype.pu=function(t){},kp),Ap=(Object.defineProperty(Sp.prototype,"fw",{get:function(){return this.ow},enumerable:!0,configurable:!0}),Sp.prototype.lw=function(t,e){var a=this,u=e?e.dw:new Nu,h=e?e.aw:this.aw,c=e?e.Ji:this.Ji,f=h,l=!1,p=this.query.gi()&&h.size===this.query.limit?h.last():null,d=this.query.bi()&&h.size===this.query.limit?h.first():null;if(t.pt(function(t,e){var n=h.get(t),r=e instanceof Ms?e:null;r&&(jr(t.isEqual(r.key),"Mismatching keys found in document changes: "+t+" != "+r.key),r=a.query.matches(r)?r:null);var i=!!n&&a.Ji.has(n.key),o=!!r&&(r.un||a.Ji.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(u.track({type:pu.Qi,doc:r}),s=!0):a.vw(n,r)||(u.track({type:pu.qi,doc:r}),s=!0,(p&&0<a.query.di(r,p)||d&&a.query.di(r,d)<0)&&(l=!0)):!n&&r?(u.track({type:pu.Bi,doc:r}),s=!0):n&&!r&&(u.track({type:pu.Mi,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(c=r?(f=f.add(r),o?c.add(t):c.delete(t)):(f=f.delete(t),c.delete(t)))}),this.query.gi()||this.query.bi())for(;f.size>this.query.limit;){var n=this.query.gi()?f.last():f.first();f=f.delete(n.key),c=c.delete(n.key),u.track({type:pu.Mi,doc:n})}return jr(!l||!e,"View was refilled using docs that themselves needed refilling."),{aw:f,dw:u,gf:l,Ji:c}},Sp.prototype.vw=function(t,e){return t.un&&e.hasCommittedMutations&&!e.un},Sp.prototype.qs=function(t,e,n){var o=this;jr(!t.gf,"Cannot apply changes that need a refill");var r=this.aw;this.aw=t.aw,this.Ji=t.Ji;var i=t.dw.Ki();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.query.di(t.doc,e.doc);function n(t){switch(t){case pu.Bi:return 1;case pu.qi:case pu.Qi:return 2;case pu.Mi:return 0;default:return Gr("Unknown ChangeType: "+t)}}var r,i}),this.ww(n);var s=e?this.mw():[],a=0===this.cw.size&&this.ue?yu.Wi:yu.Gi,u=a!==this.hw;return this.hw=a,0!==i.length||u?{snapshot:new Tu(this.query,t.aw,r,i,t.Ji,a===yu.Gi,u,!1),pw:s}:{pw:s}},Sp.prototype.gw=function(t){return this.ue&&"Offline"===t?(this.ue=!1,this.qs({aw:this.aw,dw:new Nu,Ji:this.Ji,gf:!1},!1)):{pw:[]}},Sp.prototype.bw=function(t){return!this.ow.has(t)&&!!this.aw.has(t)&&!this.aw.get(t).un},Sp.prototype.ww=function(t){var e=this;t&&(t.se.forEach(function(t){return e.ow=e.ow.add(t)}),t.oe.forEach(function(t){return jr(e.ow.has(t),"Modified document "+t+" not found in view.")}),t.he.forEach(function(t){return e.ow=e.ow.delete(t)}),this.ue=t.ue)},Sp.prototype.mw=function(){var e=this;if(!this.ue)return[];var n=this.cw;this.cw=cu(),this.aw.forEach(function(t){e.bw(t.key)&&(e.cw=e.cw.add(t.key))});var r=[];return n.forEach(function(t){e.cw.has(t)||r.push(new Np(t))}),this.cw.forEach(function(t){n.has(t)||r.push(new Ip(t))}),r},Sp.prototype.yw=function(t){this.ow=t.ec,this.cw=cu();var e=this.lw(t.documents);return this.qs(e,!0)},Sp.prototype._w=function(){return Tu.$i(this.query,this.aw,this.Ji,this.hw===yu.Gi)},Sp);function Sp(t,e){this.query=t,this.ow=e,this.hw=null,this.ue=!1,this.cw=cu(),this.Ji=cu(),this.aw=new mu(t.di.bind(t))}function kp(){this.uw=new dp,this.sw={},this.tv=null,this._d=null,this.vu=null}function Dp(t,e,n){this.query=t,this.targetId=e,this.view=n}function Rp(t){this.key=t,this.Pw=!1}function _p(){this.um=null,this.targetId=0,this.listeners=[]}function xp(){}var Cp=(zp.prototype.run=function(){this.Ew()},zp.prototype.Ew=function(){var t=this;this.ul.Jf(function(){return p(t,void 0,void 0,function(){var e,n,r=this;return y(this,function(t){return e=this.Iw.dv(),(n=this.Rw(e))&&n.then(function(t){r.Pu.xu(function(){return e.commit().then(function(){r.Vu.resolve(t)}).catch(function(t){r.Aw(t)})})}).catch(function(t){r.Aw(t)}),[2]})})})},zp.prototype.Rw=function(t){try{var e=this.updateFunction(t);return!ia(e)&&e.catch&&e.then?e:(this.Vu.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Vu.reject(t),null}},zp.prototype.Aw=function(t){var e=this;0<this.Tw&&this.Dw(t)?(this.Tw-=1,this.Pu.xu(function(){return e.Ew(),Promise.resolve()})):this.Vu.reject(t)},zp.prototype.Dw=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!tu(e)},zp),Op=(Object.defineProperty(Hp.prototype,"Lw",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),Hp.prototype.subscribe=function(t){jr(null!==t,"SyncEngine listener cannot be null"),jr(null===this.Cw,"SyncEngine already has a subscriber."),this.Cw=t},Hp.prototype.listen=function(s){return p(this,void 0,void 0,function(){var e,n,r,i,o;return y(this,function(t){switch(t.label){case 0:return this.Bw("listen()"),(r=this.kw.get(s))?(e=r.targetId,this.Sw.Bv(e),n=r.view._w(),[3,4]):[3,1];case 1:return[4,this.Nc.Yh(s.li())];case 2:return i=t.sent(),o=this.Sw.Bv(i.targetId),e=i.targetId,[4,this.Mw(s,e,"current"===o)];case 3:n=t.sent(),this.isPrimary&&this.Iw.listen(i),t.label=4;case 4:return this.Cw.Il([n]),[2,e]}})})},Hp.prototype.Mw=function(a,u,h){return p(this,void 0,void 0,function(){var e,n,r,i,o,s;return y(this,function(t){switch(t.label){case 0:return[4,this.Nc.nc(a,!0)];case 1:return e=t.sent(),n=new Ap(a,e.ec),r=n.lw(e.documents),i=Su.re(u,h&&"Offline"!==this.onlineState),jr(0===(o=n.qs(r,!0===this.isPrimary,i)).pw.length,"View returned limbo docs before target ack from the server."),jr(!!o.snapshot,"applyChanges for new view should always return a snapshot"),s=new Dp(a,u,n),this.kw.set(a,s),this.Vw[u]||(this.Vw[u]=[]),this.Vw[u].push(a),[2,o.snapshot]}})})},Hp.prototype.qw=function(r){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:return[4,this.Nc.nc(r.query,!0)];case 1:return e=t.sent(),n=r.view.yw(e),this.isPrimary&&this.Qw(r.targetId,n.pw),[2,n]}})})},Hp.prototype.$d=function(i){return p(this,void 0,void 0,function(){var e,n,r=this;return y(this,function(t){switch(t.label){case 0:return this.Bw("unlisten()"),jr(!!(e=this.kw.get(i)),"Trying to unlisten on query not found:"+i),1<(n=this.Vw[e.targetId]).length?(this.Vw[e.targetId]=n.filter(function(t){return!t.isEqual(i)}),this.kw.delete(i),[2]):this.isPrimary?(this.Sw.qv(e.targetId),this.Sw.Fv(e.targetId)?[3,2]:[4,this.Nc.tc(e.targetId,!1).then(function(){r.Sw.Gv(e.targetId),r.Iw.$d(e.targetId),r.Gw(e.targetId)}).catch(cc)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.Gw(e.targetId),[4,this.Nc.tc(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},Hp.prototype.write=function(n,r){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.Bw("write()"),[4,this.Nc.kh(n)];case 1:return e=t.sent(),this.Sw.Uv(e.batchId),this.Ww(e.batchId,r),[4,this.zw(e.Ns)];case 2:return t.sent(),[4,this.Iw.Hd()];case 3:return t.sent(),[2]}})})},Hp.prototype.runTransaction=function(t,e,n){new Cp(t,this.Iw,e,n).run()},Hp.prototype.jh=function(n){return p(this,void 0,void 0,function(){var e,r=this;return y(this,function(t){switch(t.label){case 0:this.Bw("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.Nc.jh(n)];case 2:return e=t.sent(),yi(n.Zi,function(t,e){var n=r.Ow[Number(t)];n&&(jr(e.se.size+e.oe.size+e.he.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.se.size?n.Pw=!0:0<e.oe.size?jr(n.Pw,"Received change for limbo target document without add."):0<e.he.size&&(jr(n.Pw,"Received remove for limbo target document without add."),n.Pw=!1))}),[4,this.zw(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,cc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Hp.prototype.gw=function(r,t){if(this.isPrimary&&t===ca.Ri||!this.isPrimary&&t===ca.Ai){this.Bw("applyOnlineStateChange()");var i=[];this.kw.forEach(function(t,e){var n=e.view.gw(r);jr(0===n.pw.length,"OnlineState should not affect limbo documents."),n.snapshot&&i.push(n.snapshot)}),this.Cw.Kw(r),this.Cw.Il(i),this.onlineState=r,this.isPrimary&&this.Sw.Kv(r)}},Hp.prototype.ev=function(a,u){return p(this,void 0,void 0,function(){var e,n,r,i,o,s=this;return y(this,function(t){switch(t.label){case 0:return this.Bw("rejectListens()"),this.Sw.Wv(a,"rejected",u),e=this.Ow[a],(n=e&&e.key)?(this.Nw=this.Nw.remove(n),delete this.Ow[a],r=(r=new Ji(zi.G)).lt(n,new Us(n,Gi.B())),i=cu().add(n),o=new Au(Gi.MIN,{},new ao(Hr),r,i),[2,this.jh(o)]):[3,1];case 1:return[4,this.Nc.tc(a,!1).then(function(){return s.Gw(a,u)}).catch(cc)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Hp.prototype.iw=function(n,r,i){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.Bw("applyBatchState()"),[4,this.Nc.Vh(n)];case 1:return null===(e=t.sent())?(Ur("SyncEngine","Cannot apply mutation batch with id: "+n),[2]):"pending"!==r?[3,3]:[4,this.Iw.Hd()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.Hw(n,i||null),this.Nc.sc(n)):Gr("Unknown batchState: "+r),t.label=4;case 4:return[4,this.zw(e)];case 5:return t.sent(),[2]}})})},Hp.prototype.cv=function(r){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:this.Bw("applySuccessfulWrite()"),e=r.batch.batchId,this.Hw(e,null),this.Jw(e),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.Nc.bo(r)];case 2:return n=t.sent(),this.Sw.jv(e,"acknowledged"),[4,this.zw(n)];case 3:return t.sent(),[3,6];case 4:return[4,cc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Hp.prototype.lv=function(n,r){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:this.Bw("rejectFailedWrite()"),this.Hw(n,r),this.Jw(n),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.Nc.Uh(n)];case 2:return e=t.sent(),this.Sw.jv(n,"rejected",r),[4,this.zw(e)];case 3:return t.sent(),[3,6];case 4:return[4,cc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Hp.prototype.Yw=function(r){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:return this.Iw.Fd()||Ur("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.Nc.Co()];case 1:return-1===(e=t.sent())?r.resolve():((n=this.xw.get(e)||[]).push(r),this.xw.set(e,n)),[2]}})})},Hp.prototype.Jw=function(t){(this.xw.get(t)||[]).forEach(function(t){t.resolve()}),this.xw.delete(t)},Hp.prototype.Xw=function(e){this.xw.forEach(function(t){t.forEach(function(t){t.reject(new ti(Zr.CANCELLED,e))})}),this.xw.clear()},Hp.prototype.Ww=function(t,e){var n=this.Uw[this.currentUser.v()];n=(n=n||new Ji(Hr)).lt(t,e),this.Uw[this.currentUser.v()]=n},Hp.prototype.Hw=function(t,e){var n=this.Uw[this.currentUser.v()];if(n){var r=n.get(t);r&&(jr(t===n.vt(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.Uw[this.currentUser.v()]=n}},Hp.prototype.Gw=function(t,e){var n=this;void 0===e&&(e=null),this.Sw.qv(t),jr(this.Vw[t]&&0!==this.Vw[t].length,"There are no queries mapped to target id "+t);for(var r=0,i=this.Vw[t];r<i.length;r++){var o=i[r];this.kw.delete(o),e&&this.Cw.$w(o,e)}if(delete this.Vw[t],this.isPrimary){var s=this.Fw.gs(t);this.Fw.ms(t),s.forEach(function(t){n.Fw.bs(t)||n.Zw(t)})}},Hp.prototype.Zw=function(t){var e=this.Nw.get(t);null!==e&&(this.Iw.$d(e),this.Nw=this.Nw.remove(t),delete this.Ow[e])},Hp.prototype.Qw=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof Ip?(this.Fw.fs(i.key,t),this.tm(i)):i instanceof Np?(Ur("SyncEngine","Document no longer in limbo: "+i.key),this.Fw.ds(i.key,t),this.Fw.bs(i.key)||this.Zw(i.key)):Gr("Unknown limbo change: "+JSON.stringify(i))}},Hp.prototype.tm=function(t){var e=t.key;if(!this.Nw.get(e)){Ur("SyncEngine","New document in limbo: "+e);var n=this.jw.next(),r=ga.ti(e.path);this.Ow[n]=new Rp(e),this.Iw.listen(new Qa(r.li(),n,Fa.ki,rh.gu)),this.Nw=this.Nw.lt(e,n)}},Hp.prototype.nm=function(){return this.Nw},Hp.prototype.zw=function(r,u){return p(this,void 0,void 0,function(){var o,s,e,a=this;return y(this,function(t){switch(t.label){case 0:return o=[],s=[],e=[],this.kw.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.lw(r);return n.gf?a.Nc.nc(i.query,!1).then(function(t){var e=t.documents;return i.view.lw(e,n)}):n}).then(function(t){var e=u&&u.Zi[i.targetId],n=i.view.qs(t,!0===a.isPrimary,e);if(a.Qw(i.targetId,n.pw),n.snapshot){a.isPrimary&&a.Sw.Wv(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=rc.ah(i.targetId,n.snapshot);s.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.Cw.Il(o),[4,this.Nc.Kh(s)];case 2:return t.sent(),[2]}})})},Hp.prototype.Bw=function(t){jr(null!==this.Cw,"Trying to call "+t+" before calling subscribe().")},Hp.prototype.vv=function(r){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?(this.Xw("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.Nc.Dh(r)]):[3,3];case 1:return n=t.sent(),this.Sw.Dh(r,n.Sh,n.Ch),[4,this.zw(n.Ph)];case 2:t.sent(),t.label=3;case 3:return[4,this.Iw.vv()];case 4:return t.sent(),[2]}})})},Hp.prototype.wv=function(u){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,a=this;return y(this,function(t){switch(t.label){case 0:return!0!==u||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.Iw.wv(!0)]);case 1:return t.sent(),o=this.Sw.Ov(),[4,this.im(o.tt())];case 2:for(e=t.sent(),n=0,r=e;n<r.length;n++)i=r[n],this.Iw.listen(i);return[3,7];case 3:return!1!==u||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,o=[],s=Promise.resolve(),di(this.Vw,function(t,e){a.Sw.Qv(t)?o.push(t):s=s.then(function(){return a.Gw(t),a.Nc.tc(t,!0)}),a.Iw.$d(t)}),[4,s]);case 4:return t.sent(),[4,this.im(o)];case 5:return t.sent(),this.em(),[4,this.Iw.wv(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},Hp.prototype.em=function(){var e=this;di(this.Ow,function(t){e.Iw.$d(t)}),this.Fw.ps(),this.Ow=[],this.Nw=new Ji(zi.G)},Hp.prototype.im=function(d){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,h,c,f,l,p;return y(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=d,t.label=1;case 1:return r<i.length?(o=i[r],s=void 0,(a=this.Vw[o])&&0!==a.length?[4,this.Nc.tc(o,!0)]:[3,8]):[3,14];case 2:return t.sent(),[4,this.Nc.Yh(a[0].li())];case 3:s=t.sent(),u=0,h=a,t.label=4;case 4:return u<h.length?(c=h[u],jr(!!(f=this.kw.get(c)),"No query view found for "+c),[4,this.qw(f)]):[3,7];case 5:(l=t.sent()).snapshot&&n.push(l.snapshot),t.label=6;case 6:return u++,[3,4];case 7:return[3,12];case 8:return jr(!0===this.isPrimary,"A secondary tab should never have an active target without an active query."),[4,this.Nc.ac(o)];case 9:return jr(!!(p=t.sent()),"Target for id "+o+" not found"),[4,this.Nc.Yh(p)];case 10:return s=t.sent(),[4,this.Mw(this.rm(p),o,!1)];case 11:t.sent(),t.label=12;case 12:e.push(s),t.label=13;case 13:return r++,[3,1];case 14:return this.Cw.Il(n),[2,e]}})})},Hp.prototype.rm=function(t){return new ga(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,sa.Kn,t.startAt,t.endAt)},Hp.prototype.uc=function(){return this.Nc.uc()},Hp.prototype.ew=function(r,i,o){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:if(this.isPrimary)return Ur("SyncEngine","Ignoring unexpected query state notification."),[2];if(!this.Vw[r])return[3,7];switch(i){case"current":case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,this.Nc.fc()];case 2:return e=t.sent(),n=Au.ee(r,"current"===i),[4,this.zw(e,n)];case 3:return t.sent(),[3,7];case 4:return[4,this.Nc.tc(r,!0)];case 5:return t.sent(),this.Gw(r,o),[3,7];case 6:Gr("Unexpected target state: "+i),t.label=7;case 7:return[2]}})})},Hp.prototype.rw=function(f,l){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,h,c=this;return y(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[2];e=0,n=f,t.label=1;case 1:return e<n.length?(h=n[e],jr(!this.Vw[h],"Trying to add an already active target"),[4,this.Nc.ac(h)]):[3,6];case 2:return jr(!!(r=t.sent()),"Query data for active target "+h+" not found"),[4,this.Nc.Yh(r)];case 3:return i=t.sent(),[4,this.Mw(this.rm(r),i.targetId,!1)];case 4:t.sent(),this.Iw.listen(i),t.label=5;case 5:return e++,[3,1];case 6:o=function(e){return y(this,function(t){switch(t.label){case 0:return s.Vw[e]?[4,s.Nc.tc(e,!1).then(function(){c.Iw.$d(e),c.Gw(e)}).catch(cc)]:[2,"continue"];case 1:return t.sent(),[2]}})},s=this,a=0,u=l,t.label=7;case 7:return a<u.length?(h=u[a],[5,o(h)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})},Hp.prototype.enableNetwork=function(){return this.Nc.oc(!0),this.Iw.enableNetwork()},Hp.prototype.disableNetwork=function(){return this.Nc.oc(!1),this.Iw.disableNetwork()},Hp.prototype.Je=function(t){var e=this.Ow[t];if(e&&e.Pw)return cu().add(e.key);var n=cu(),r=this.Vw[t];if(!r)return n;for(var i=0,o=r;i<o.length;i++){var s=o[i],a=this.kw.get(s);jr(!!a,"No query view found for "+s),n=n.qt(a.view.fw)}return n},Hp),Pp=(Bp.prototype.listen=function(t){var e=t.query,n=!1,r=this.sm.get(e);return r||(n=!0,r=new _p,this.sm.set(e,r)),r.listeners.push(t),jr(!t.gw(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),r.um&&t.hm(r.um)&&this.cm(),n?this.tv.listen(e).then(function(t){return r.targetId=t}):Promise.resolve(r.targetId)},Bp.prototype.$d=function(o){return p(this,void 0,void 0,function(){var e,n,r,i;return y(this,function(t){return e=o.query,n=!1,(r=this.sm.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.sm.delete(e),[2,this.tv.$d(e)]):[2]})})},Bp.prototype.Il=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.sm.get(o);if(s){for(var a=0,u=s.listeners;a<u.length;a++)u[a].hm(i)&&(e=!0);s.um=i}}e&&this.cm()},Bp.prototype.$w=function(t,e){var n=this.sm.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.sm.delete(t)},Bp.prototype.Kw=function(i){this.onlineState=i;var o=!1;this.sm.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].gw(i)&&(o=!0)}),o&&this.cm()},Bp.prototype.am=function(t){this.om.add(t),t.next()},Bp.prototype.fm=function(t){this.om.delete(t)},Bp.prototype.cm=function(){this.om.forEach(function(t){t.next()})},Bp),Lp=(Fp.prototype.hm=function(t){if(jr(0<t.docChanges.length||t.Yi,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==pu.Qi&&e.push(i)}t=new Tu(t.query,t.docs,t.Hi,e,t.Ji,t.fromCache,t.Yi,!0)}var o=!1;return this.dm?this.wm(t)&&(this.lm.next(t),o=!0):this.mm(t,this.onlineState)&&(this.pm(t),o=!0),this.vm=t,o},Fp.prototype.onError=function(t){this.lm.error(t)},Fp.prototype.gw=function(t){this.onlineState=t;var e=!1;return this.vm&&!this.dm&&this.mm(this.vm,t)&&(this.pm(this.vm),e=!0),e},Fp.prototype.mm=function(t,e){if(jr(!this.dm,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n="Offline"!==e;return this.options.gm&&n?(jr(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.J()||"Offline"===e},Fp.prototype.wm=function(t){if(0<t.docChanges.length)return!0;var e=this.vm&&this.vm.hasPendingWrites!==t.hasPendingWrites;return!(!t.Yi&&!e)&&!0===this.options.includeMetadataChanges},Fp.prototype.pm=function(t){jr(!this.dm,"Trying to raise initial events for second time"),t=Tu.$i(t.query,t.docs,t.Ji,t.fromCache),this.dm=!0,this.lm.next(t)},Fp),Mp=(jp.prototype.ja=function(){return dc.Rc(this.cacheSizeBytes)},jp),Up=(Gp.prototype.start=function(t){var n=this;this.ym();var r=new $u,i=new $u,o=!1;return this.credentials.T(function(e){o?n.Pu.xu(function(){return n.vv(e)}):(o=!0,n._m(t,i,e).then(function(t){return n.Im(e,t)}).then(r.resolve,r.reject))}),this.Pu.xu(function(){return r.promise}),i.promise},Gp.prototype.enableNetwork=function(){var t=this;return this.ym(),this.Pu.enqueue(function(){return t.tv.enableNetwork()})},Gp.prototype._m=function(t,e,n){var r=this;return t instanceof Mp?this.Tm(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.Em(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.Rm()}):(e.resolve(),this.Rm())},Gp.prototype.Em=function(t){return t instanceof ti?t.code===Zr.FAILED_PRECONDITION||t.code===Zr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},Gp.prototype.ym=function(){if(this.Pu.Gu)throw new ti(Zr.FAILED_PRECONDITION,"The client has already been terminated.")},Gp.prototype.Tm=function(r,i){var t=this,o=Tf.af(this.bm),s=new zu(this.bm.s,{Ze:!0});return Promise.resolve().then(function(){return p(t,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:if(i.synchronizeTabs&&!yp.Hs(this.platform))throw new ti(Zr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return e=i.ja(),this.Sw=i.synchronizeTabs?new yp(this.Pu,this.platform,o,this.clientId,r):new Tp,[4,Tf.xa({allowTabSynchronization:i.synchronizeTabs,persistenceKey:o,clientId:this.clientId,platform:this.platform,Aa:this.Pu,serializer:s,ja:e,Da:this.Sw})];case 1:return n=t.sent(),[2,(this.persistence=n).vo.Vc]}})})})},Gp.prototype.Rm=function(){return this.persistence=Ff.Nf(this.clientId),this.Sw=new Tp,Promise.resolve(null)},Gp.prototype.Im=function(h,c){var t=this;return Ur("FirestoreClient","Initializing. user=",h.uid),this.platform.Am(this.bm).then(function(u){return p(t,void 0,void 0,function(){var e,n,r,i,o,s,a=this;return y(this,function(t){switch(t.label){case 0:return e=new Cf,this.Nc=new oc(this.persistence,e,h),[4,this.Nc.start()];case 1:return t.sent(),c&&(this.Dm=new yc(c,this.Pu,this.Nc)),n=this.platform.Pm(),r=this.platform.Sm(this.bm.s),i=new sl(this.Pu,u,this.credentials,r),o=function(t){return a.tv.gw(t,ca.Ri)},s=function(t){return a.tv.gw(t,ca.Ai)},this.Iw=new Zl(this.Nc,i,this.Pu,o,n),this.tv=new Op(this.Nc,this.Iw,this.Sw,h),this.Sw._d=s,this.Iw.tv=this.tv,this.Sw.tv=this.tv,this.Cm=new Pp(this.tv),[4,this.Sw.start()];case 2:return t.sent(),[4,this.Iw.start()];case 3:return t.sent(),[4,this.persistence.Wa(function(e){return p(a,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return[4,this.tv.wv(e)];case 1:return t.sent(),this.Dm&&(e&&!this.Dm.mh?this.Dm.start():e||this.Dm.stop()),[2]}})})})];case 4:return t.sent(),[4,this.persistence.za(function(){return p(a,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})})];case 5:return t.sent(),[2]}})})})},Gp.prototype.vv=function(t){return this.Pu.$u(),Ur("FirestoreClient","Credential Changed. Current user: "+t.uid),this.tv.vv(t)},Gp.prototype.disableNetwork=function(){var t=this;return this.ym(),this.Pu.enqueue(function(){return t.tv.disableNetwork()})},Gp.prototype.terminate=function(){var t=this;return this.Pu.Ju(function(){return p(t,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.Dm&&this.Dm.stop(),[4,this.Iw.shutdown()];case 1:return t.sent(),[4,this.Sw.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.R(),[2]}})})})},Gp.prototype.waitForPendingWrites=function(){var t=this;this.ym();var e=new $u;return this.Pu.xu(function(){return t.tv.Yw(e)}),e.promise},Gp.prototype.listen=function(t,e,n){var r=this;this.ym();var i=new Lp(t,e,n);return this.Pu.xu(function(){return r.Cm.listen(i)}),i},Gp.prototype.$d=function(t){var e=this;this.km||this.Pu.xu(function(){return e.Cm.$d(t)})},Gp.prototype.Vm=function(t){var e=this;return this.ym(),this.Pu.enqueue(function(){return e.Nc.Jh(t)}).then(function(t){if(t instanceof Ms)return t;if(t instanceof Us)return null;throw new ti(Zr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},Gp.prototype.Nm=function(i){var t=this;return this.ym(),this.Pu.enqueue(function(){return p(t,void 0,void 0,function(){var e,n,r;return y(this,function(t){switch(t.label){case 0:return[4,this.Nc.nc(i,!0)];case 1:return e=t.sent(),n=new Ap(i,e.ec),r=n.lw(e.documents),[2,n.qs(r,!1).snapshot]}})})})},Gp.prototype.write=function(t){var e=this;this.ym();var n=new $u;return this.Pu.xu(function(){return e.tv.write(t,n)}),n.promise},Gp.prototype.s=function(){return this.bm.s},Gp.prototype.am=function(t){var e=this;this.ym(),this.Pu.xu(function(){return e.Cm.am(t),Promise.resolve()})},Gp.prototype.fm=function(t){this.km||this.Cm.fm(t)},Object.defineProperty(Gp.prototype,"km",{get:function(){return this.Pu.Gu},enumerable:!0,configurable:!0}),Gp.prototype.transaction=function(t){var e=this;this.ym();var n=new $u;return this.Pu.xu(function(){return e.tv.runTransaction(e.Pu,t,n),Promise.resolve()}),n.promise},Gp),qp=(Vp.prototype.next=function(t){this.Om(this.observer.next,t)},Vp.prototype.error=function(t){this.Om(this.observer.error,t)},Vp.prototype.Fm=function(){this.muted=!0},Vp.prototype.Om=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Vp);function Vp(t){this.observer=t,this.muted=!1}function Gp(t,e,n,r){this.platform=t,this.bm=e,this.credentials=n,this.Pu=r,this.clientId=Fr.u()}function jp(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}function Fp(t,e,n){this.query=t,this.lm=e,this.dm=!1,this.vm=null,this.onlineState="Unknown",this.options=n||{}}function Bp(t){this.tv=t,this.sm=new Ih(function(t){return t.canonicalId()}),this.onlineState="Unknown",this.om=new Set,this.tv.subscribe(this)}function Hp(t,e,n,r){this.Nc=t,this.Iw=e,this.Sw=n,this.currentUser=r,this.Cw=null,this.kw=new Ih(function(t){return t.canonicalId()}),this.Vw={},this.Nw=new Ji(zi.G),this.Ow={},this.Fw=new bh,this.Uw={},this.xw=new Map,this.jw=ec.Ko(),this.isPrimary=void 0,this.onlineState="Unknown"}function zp(t,e,n,r){this.Pu=t,this.Iw=e,this.updateFunction=n,this.Vu=r,this.Tw=5,this.ul=new Jf(this.Pu,Zu.Du)}function Jp(i){return function(){if("object"!=typeof i||null===i)return!1;for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return!0}return!1}()}var Wp,Yp=dc.Pc,Xp=(dd.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},dd),Qp=(pd.prototype.settings=function(t){if(gi("Firestore.settings",arguments,1),Ei("Firestore.settings","object",1,t),li(t,"persistence"))throw new ti(Zr.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new Xp(t);if(this.Lm&&!this.Gm.isEqual(e))throw new ti(Zr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.Gm=e).credentials&&(this.Qm=function(t){if(!t)return new ei;switch(t.type){case"gapi":var e=t.N;return jr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new ii(e,t.k||"0");case"provider":return t.N;default:throw new ti(Zr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},pd.prototype.enableNetwork=function(){return this.jm(),this.Lm.enableNetwork()},pd.prototype.disableNetwork=function(){return this.jm(),this.Lm.disableNetwork()},pd.prototype.enablePersistence=function(t){if(this.Lm)throw new ti(Zr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&qr("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=pi(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.Km(new Mp(this.Gm.cacheSizeBytes,e))},pd.prototype.clearPersistence=function(){var t=this,n=Tf.af(this.Hm()),r=new $u;return this.xm.Wu(function(){return p(t,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,,3]),void 0!==this.Lm&&!this.Lm.km)throw new ti(Zr.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,Tf.clearPersistence(n)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise},pd.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(pd.prototype,"Jm",{get:function(){return this.jm(),this.Lm.km},enumerable:!0,configurable:!0}),pd.prototype.waitForPendingWrites=function(){return this.jm(),this.Lm.waitForPendingWrites()},pd.prototype.onSnapshotsInSync=function(t){if(this.jm(),Jp(t))return this.Ym(t);Ei("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.Ym(e)},pd.prototype.Ym=function(t){var e=this,n=new qp({next:function(){t.next&&t.next()},error:function(t){throw Gr("Uncaught Error in onSnapshotsInSync")}});return this.Lm.am(n),function(){n.Fm(),e.Lm.fm(n)}},pd.prototype.jm=function(){return this.Lm||this.Km(new xp),this.Lm},pd.prototype.Hm=function(){return new Wr(this.Bm,this.qm,this.Gm.host,this.Gm.ssl,this.Gm.forceLongPolling)},pd.prototype.Km=function(t){jr(!!this.Gm.host,"FirestoreSettings.host is not set"),jr(!this.Lm,"configureClient() called multiple times");var e=this.Hm();return this.Lm=new Up(Ju.t(),e,this.Qm,this.xm),this.Lm.start(t)},pd.prototype.zm=function(r){return new Fl(function(t){if(t instanceof Zp){var e=r,n=t.firestore.Bm;if(!n.isEqual(e))throw new ti(Zr.INVALID_ARGUMENT,"Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+e.projectId+"/"+e.database);return new jl(r,t.Xm)}return t})},pd.Mm=function(t){var e=t.options;if(!li(e,"projectId"))throw new ti(Zr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new ti(Zr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Kr(n)},Object.defineProperty(pd.prototype,"app",{get:function(){if(!this.Um)throw new ti(Zr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Um},enumerable:!0,configurable:!0}),pd.prototype.collection=function(t){return gi("Firestore.collection",arguments,1),Ei("Firestore.collection","non-empty string",1,t),this.jm(),new vd(Fi.it(t),this)},pd.prototype.doc=function(t){return gi("Firestore.doc",arguments,1),Ei("Firestore.doc","non-empty string",1,t),this.jm(),Zp.$m(Fi.it(t),this)},pd.prototype.collectionGroup=function(t){if(gi("Firestore.collectionGroup",arguments,1),Ei("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new ti(Zr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.jm(),new rd(new ga(Fi.et,t),this)},pd.prototype.runTransaction=function(e){var n=this;return gi("Firestore.runTransaction",arguments,1),Ei("Firestore.runTransaction","function",1,e),this.jm().transaction(function(t){return e(new Kp(n,t))})},pd.prototype.batch=function(){return this.jm(),new $p(this)},Object.defineProperty(pd,"logLevel",{get:function(){switch(Lr()){case Ar.DEBUG:return"debug";case Ar.ERROR:return"error";case Ar.SILENT:return"silent";default:return Gr("Unknown log level: "+Lr())}},enumerable:!0,configurable:!0}),pd.setLogLevel=function(t){switch(gi("Firestore.setLogLevel",arguments,1),Ei("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Mr(Ar.DEBUG);break;case"error":Mr(Ar.ERROR);break;case"silent":Mr(Ar.SILENT);break;default:throw new ti(Zr.INVALID_ARGUMENT,"Invalid log level: "+t)}},pd.prototype.Zm=function(){return this.Gm.timestampsInSnapshots},pd),Kp=(ld.prototype.get=function(t){var n=this;gi("Transaction.get",arguments,1);var r=Ed("Transaction.get",t,this.tp);return this.np.lookup([r.Xm]).then(function(t){if(!t||1!==t.length)return Gr("Mismatch in docs returned from document lookup.");var e=t[0];if(e instanceof Us)return new ed(n.tp,r.Xm,null,!1,!1,r.ip);if(e instanceof Ms)return new ed(n.tp,r.Xm,e,!1,!1,r.ip);throw Gr("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},ld.prototype.set=function(t,e,n){bi("Transaction.set",arguments,2,3);var r=Ed("Transaction.set",t,this.tp);n=gd("Transaction.set",n);var i=Id(r.ip,e,"Transaction.set"),o=i[0],s=i[1],a=n.merge||n.mergeFields?this.tp.Wm.nd(s,o,n.mergeFields):this.tp.Wm.Zl(s,o);return this.np.set(r.Xm,a),this},ld.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof al?(wi("Transaction.update",arguments,3),r=Ed("Transaction.update",t,this.tp),this.tp.Wm.ud("Transaction.update",e,n,o)):(gi("Transaction.update",arguments,2),r=Ed("Transaction.update",t,this.tp),this.tp.Wm.ed("Transaction.update",e)),this.np.update(r.Xm,i),this},ld.prototype.delete=function(t){gi("Transaction.delete",arguments,1);var e=Ed("Transaction.delete",t,this.tp);return this.np.delete(e.Xm),this},ld),$p=(fd.prototype.set=function(t,e,n){bi("WriteBatch.set",arguments,2,3),this.up();var r=Ed("WriteBatch.set",t,this.tp);n=gd("WriteBatch.set",n);var i=Id(r.ip,e,"WriteBatch.set"),o=i[0],s=i[1],a=n.merge||n.mergeFields?this.tp.Wm.nd(s,o,n.mergeFields):this.tp.Wm.Zl(s,o);return this.ep=this.ep.concat(a.Ll(r.Xm,Uo.NONE)),this},fd.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.up(),i="string"==typeof e||e instanceof al?(wi("WriteBatch.update",arguments,3),r=Ed("WriteBatch.update",t,this.tp),this.tp.Wm.ud("WriteBatch.update",e,n,o)):(gi("WriteBatch.update",arguments,2),r=Ed("WriteBatch.update",t,this.tp),this.tp.Wm.ed("WriteBatch.update",e)),this.ep=this.ep.concat(i.Ll(r.Xm,Uo.exists(!0))),this},fd.prototype.delete=function(t){gi("WriteBatch.delete",arguments,1),this.up();var e=Ed("WriteBatch.delete",t,this.tp);return this.ep=this.ep.concat(new Fo(e.Xm,Uo.NONE)),this},fd.prototype.commit=function(){return p(this,void 0,void 0,function(){return y(this,function(t){return this.up(),this.rp=!0,0<this.ep.length?[2,this.tp.jm().write(this.ep)]:[2]})})},fd.prototype.up=function(){if(this.rp)throw new ti(Zr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},fd),Zp=(cd.$m=function(t,e,n){if(t.length%2!=0)throw new ti(Zr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.nt()+" has "+t.length);return new cd(new zi(t),e,n)},Object.defineProperty(cd.prototype,"id",{get:function(){return this.Xm.path.X()},enumerable:!0,configurable:!0}),Object.defineProperty(cd.prototype,"parent",{get:function(){return new vd(this.Xm.path.H(),this.firestore,this.ip)},enumerable:!0,configurable:!0}),Object.defineProperty(cd.prototype,"path",{get:function(){return this.Xm.path.nt()},enumerable:!0,configurable:!0}),cd.prototype.collection=function(t){if(gi("DocumentReference.collection",arguments,1),Ei("DocumentReference.collection","non-empty string",1,t),!t)throw new ti(Zr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Fi.it(t);return new vd(this.Xm.path.child(e),this.firestore)},cd.prototype.isEqual=function(t){if(!(t instanceof cd))throw xi("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.Xm.isEqual(t.Xm)&&this.ip===t.ip},cd.prototype.set=function(t,e){bi("DocumentReference.set",arguments,1,2),e=gd("DocumentReference.set",e);var n=Id(this.ip,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore.Wm.nd(i,r,e.mergeFields):this.firestore.Wm.Zl(i,r);return this.Lm.write(o.Ll(this.Xm,Uo.NONE))},cd.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof al?(wi("DocumentReference.update",arguments,2),this.firestore.Wm.ud("DocumentReference.update",t,e,r)):(gi("DocumentReference.update",arguments,1),this.firestore.Wm.ed("DocumentReference.update",t)),this.Lm.write(n.Ll(this.Xm,Uo.exists(!0)))},cd.prototype.delete=function(){return gi("DocumentReference.delete",arguments,0),this.Lm.write([new Fo(this.Xm,Uo.NONE)])},cd.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];bi("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||Jp(t[i])||(_i("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),Ti("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=Jp(t[i])?t[i]:(Ei("DocumentReference.onSnapshot","function",i,t[i]),Ii("DocumentReference.onSnapshot","function",i+1,t[i+1]),Ii("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.sp(o,n)},cd.prototype.sp=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new qp({next:function(t){if(n.next){jr(t.docs.size<=1,"Too many documents returned on a document query");var e=t.docs.get(r.Xm);n.next(new ed(r.firestore,r.Xm,e,t.fromCache,t.hasPendingWrites,r.ip))}},error:e}),o=this.Lm.listen(ga.ti(this.Xm.path),i,t);return function(){i.Fm(),r.Lm.$d(o)}},cd.prototype.get=function(n){var r=this;return bi("DocumentReference.get",arguments,0,1),bd("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.jm().Vm(r.Xm).then(function(t){e(new ed(r.firestore,r.Xm,t,!0,t instanceof Ms&&t.un,r.ip))},t):r.hp(e,t,n)})},cd.prototype.hp=function(e,n,r){var i=this.sp({includeMetadataChanges:!0,gm:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new ti(Zr.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new ti(Zr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},cd.prototype.withConverter=function(t){return new cd(this.Xm,this.firestore,t)},cd),td=(hd.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},hd),ed=(ud.prototype.data=function(t){if(bi("DocumentSnapshot.data",arguments,0,1),t=wd("DocumentSnapshot.data",t),this.cp){if(this.ip){var e=new nd(this.tp,this.Xm,this.cp,this.ap,this.fp);return this.ip.fromFirestore(e,t)}return this.lp(this.cp.data(),ts.Cn(t,this.tp.Zm()))}},ud.prototype.get=function(t,e){if(bi("DocumentSnapshot.get",arguments,1,2),e=wd("DocumentSnapshot.get",e),this.cp){var n=this.cp.data().field(Wl("DocumentSnapshot.get",t));if(null!==n)return this.dp(n,ts.Cn(e,this.tp.Zm()))}},Object.defineProperty(ud.prototype,"id",{get:function(){return this.Xm.path.X()},enumerable:!0,configurable:!0}),Object.defineProperty(ud.prototype,"ref",{get:function(){return new Zp(this.Xm,this.tp,this.ip)},enumerable:!0,configurable:!0}),Object.defineProperty(ud.prototype,"exists",{get:function(){return null!==this.cp},enumerable:!0,configurable:!0}),Object.defineProperty(ud.prototype,"metadata",{get:function(){return new td(this.fp,this.ap)},enumerable:!0,configurable:!0}),ud.prototype.isEqual=function(t){if(!(t instanceof ud))throw xi("isEqual","DocumentSnapshot",1,t);return this.tp===t.tp&&this.ap===t.ap&&this.Xm.isEqual(t.Xm)&&(null===this.cp?null===t.cp:this.cp.isEqual(t.cp))&&this.ip===t.ip},ud.prototype.lp=function(t,n){var r=this,i={};return t.forEach(function(t,e){i[t]=r.dp(e,n)}),i},ud.prototype.dp=function(t,e){if(t instanceof Cs)return this.lp(t,e);if(t instanceof Ps)return this.vp(t,e);if(t instanceof _s){var n=t.value(e),r=this.tp.jm().s();return t.s.isEqual(r)||qr("Document "+this.Xm.path+" contains a document reference within a different database ("+t.s.projectId+"/"+t.s.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new Zp(n,this.tp,this.ip)}return t.value(e)},ud.prototype.vp=function(t,e){var n=this;return t.Ht.map(function(t){return n.dp(t,e)})},ud),nd=(t(ad,Wp=ed),ad.prototype.data=function(t){var e=Wp.prototype.data.call(this,t);return jr(void 0!==e,"Document in a QueryDocumentSnapshot should exist"),e},ad),rd=(sd.prototype.where=function(t,e,n){var r;gi("Query.where",arguments,3),Ri("Query.where",3,n),function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new ti(Zr.INVALID_ARGUMENT,"Invalid value "+Di(r)+" provided to function "+t+"() for its "+Oi(n)+" argument. Acceptable values: "+e.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,e);var i=Wl("Query.where",t),o=wa.it(e);if(i.ut()){if(o===wa.ARRAY_CONTAINS||o===wa.ARRAY_CONTAINS_ANY)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===wa.IN){this.mp(n,o);for(var s=[],a=0,u=n;a<u.length;a++){var h=u[a];s.push(this.pp(h))}r=new Ps(s)}else r=this.pp(n)}else o!==wa.IN&&o!==wa.ARRAY_CONTAINS_ANY||this.mp(n,o),r=this.firestore.Wm.sd("Query.where",n,o===wa.IN);var c=ba.create(i,o,r);return this.gp(c),new sd(this.wp.ei(c),this.firestore,this.ip)},sd.prototype.orderBy=function(t,e){var n;if(bi("Query.orderBy",arguments,1,2),Ii("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=Sa.ASCENDING;else{if("desc"!==e)throw new ti(Zr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=Sa.DESCENDING}if(null!==this.wp.startAt)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this.wp.endAt)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=Wl("Query.orderBy",t),i=new Da(r,n);return this.bp(i),new sd(this.wp.ui(i),this.firestore,this.ip)},sd.prototype.limit=function(t){return gi("Query.limit",arguments,1),Ei("Query.limit","number",1,t),Ci("Query.limit",1,t),new sd(this.wp.si(t),this.firestore,this.ip)},sd.prototype.limitToLast=function(t){return gi("Query.limitToLast",arguments,1),Ei("Query.limitToLast","number",1,t),Ci("Query.limitToLast",1,t),new sd(this.wp.oi(t),this.firestore,this.ip)},sd.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];wi("Query.startAt",arguments,1);var r=this.yp("Query.startAt",t,e,!0);return new sd(this.wp.hi(r),this.firestore,this.ip)},sd.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];wi("Query.startAfter",arguments,1);var r=this.yp("Query.startAfter",t,e,!1);return new sd(this.wp.hi(r),this.firestore,this.ip)},sd.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];wi("Query.endBefore",arguments,1);var r=this.yp("Query.endBefore",t,e,!0);return new sd(this.wp.ci(r),this.firestore,this.ip)},sd.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];wi("Query.endAt",arguments,1);var r=this.yp("Query.endAt",t,e,!1);return new sd(this.wp.ci(r),this.firestore,this.ip)},sd.prototype.isEqual=function(t){if(!(t instanceof sd))throw xi("isEqual","Query",1,t);return this.firestore===t.firestore&&this.wp.isEqual(t.wp)},sd.prototype.withConverter=function(t){return new sd(this.wp,this.firestore,t)},sd.prototype.yp=function(t,e,n,r){if(Ri(t,1,e),e instanceof ed){if(0<n.length)throw new ti(Zr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new ti(Zr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this._p(t,i.cp,r)}var o=[e].concat(n);return this.Ip(t,o,r)},sd.prototype._p=function(t,e,n){for(var r=[],i=0,o=this.wp.orderBy;i<o.length;i++){var s=o[i];if(s.field.ut())r.push(new _s(this.firestore.Bm,e.key));else{var a=e.field(s.field);if(a instanceof Ds)throw new ti(Zr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a){var u=s.field.nt();throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(a)}}return new ka(r,n)},sd.prototype.Ip=function(t,e,n){var r=this.wp.Jn;if(e.length>r.length)throw new ti(Zr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.ut()){if("string"!=typeof s)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(!this.wp._i()&&-1!==s.indexOf("/"))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+s+"' contains a slash.");var a=this.wp.path.child(Fi.it(s));if(!zi.ht(a))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+a+"' is not because it contains an odd number of segments.");var u=new zi(a);i.push(new _s(this.firestore.Bm,u))}else{var h=this.firestore.Wm.sd(t,s);i.push(h)}}return new ka(i,n)},sd.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];bi("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||Jp(t[i])||(_i("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Ti("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=Jp(t[i])?t[i]:(Ei("Query.onSnapshot","function",i,t[i]),Ii("Query.onSnapshot","function",i+1,t[i+1]),Ii("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.Tp(this.wp),this.sp(r,n)},sd.prototype.sp=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new qp({next:function(t){e.next&&e.next(new id(n.firestore,n.wp,t,n.ip))},error:r}),o=this.firestore.jm(),s=o.listen(this.wp,i,t);return function(){i.Fm(),o.$d(s)}},sd.prototype.Tp=function(t){if(t.bi()&&0===t.Jn.length)throw new ti(Zr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},sd.prototype.get=function(n){var r=this;return bi("Query.get",arguments,0,1),bd("Query.get",n),this.Tp(this.wp),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.jm().Nm(r.wp).then(function(t){e(new id(r.firestore,r.wp,t,r.ip))},t):r.hp(e,t,n)})},sd.prototype.hp=function(e,n,r){var i=this.sp({includeMetadataChanges:!0,gm:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new ti(Zr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},sd.prototype.pp=function(t){if("string"==typeof t){if(""===t)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this.wp._i()&&-1!==t.indexOf("/"))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this.wp.path.child(Fi.it(t));if(!zi.ht(e))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new _s(this.firestore.Bm,new zi(e))}if(t instanceof Zp){var n=t;return new _s(this.firestore.Bm,n.Xm)}throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Di(t)+".")},sd.prototype.mp=function(t,e){if(!Array.isArray(t)||0===t.length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},sd.prototype.gp=function(t){if(t instanceof ba){var e=[wa.ARRAY_CONTAINS,wa.ARRAY_CONTAINS_ANY],n=[wa.IN,wa.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.ri()){var o=this.wp.ni();if(null!==o&&!o.isEqual(t.field))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var s=this.wp.ii();null!==s&&this.Ep(t.field,s)}else if(i||r){var a=null;if(i&&(a=this.wp.yi(n)),null===a&&r&&(a=this.wp.yi(e)),null!=a)throw a===t.op?new ti(Zr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new ti(Zr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+a.toString()+"' filters.")}}},sd.prototype.bp=function(t){if(null===this.wp.ii()){var e=this.wp.ni();null!==e&&this.Ep(e,t.field)}},sd.prototype.Ep=function(t,e){if(!e.isEqual(t))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},sd),id=(Object.defineProperty(od.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(od.prototype,"empty",{get:function(){return this.Ap.docs.J()},enumerable:!0,configurable:!0}),Object.defineProperty(od.prototype,"size",{get:function(){return this.Ap.docs.size},enumerable:!0,configurable:!0}),od.prototype.forEach=function(e,n){var r=this;bi("QuerySnapshot.forEach",arguments,1,2),Ei("QuerySnapshot.forEach","function",1,e),this.Ap.docs.forEach(function(t){e.call(n,r.Sp(t))})},Object.defineProperty(od.prototype,"query",{get:function(){return new rd(this.Rp,this.tp,this.ip)},enumerable:!0,configurable:!0}),od.prototype.docChanges=function(t){t&&(_i("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Ti("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.Ap.Xi)throw new ti(Zr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Dp&&this.Pp===e||(this.Dp=function(i,e,o,s){if(o.Hi.J()){var n,r=0;return o.docChanges.map(function(t){var e=new nd(i,t.doc.key,t.doc,o.fromCache,o.Ji.has(t.doc.key),s);return jr(t.type===pu.Bi,"Invalid event type for first snapshot"),jr(!n||o.query.di(n,t.doc)<0,"Got added events in wrong order"),n=t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:r++}})}var a=o.Hi;return o.docChanges.filter(function(t){return e||t.type!==pu.Qi}).map(function(t){var e=new nd(i,t.doc.key,t.doc,o.fromCache,o.Ji.has(t.doc.key),s),n=-1,r=-1;return t.type!==pu.Bi&&(jr(0<=(n=a.indexOf(t.doc.key)),"Index for document not found"),a=a.delete(t.doc.key)),t.type!==pu.Mi&&(r=(a=a.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case pu.Bi:return"added";case pu.qi:case pu.Qi:return"modified";case pu.Mi:return"removed";default:return Gr("Unknown change type: "+t)}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this.tp,e,this.Ap,this.ip),this.Pp=e),this.Dp},od.prototype.isEqual=function(t){if(!(t instanceof od))throw xi("isEqual","QuerySnapshot",1,t);return this.tp===t.tp&&this.Rp.isEqual(t.Rp)&&this.Ap.isEqual(t.Ap)&&this.ip===t.ip},od.prototype.Sp=function(t){return new nd(this.tp,t.key,t,this.metadata.fromCache,this.Ap.Ji.has(t.key),this.ip)},od);function od(t,e,n,r){this.tp=t,this.Rp=e,this.Ap=n,this.ip=r,this.Dp=null,this.Pp=null,this.metadata=new td(n.hasPendingWrites,n.fromCache)}function sd(t,e,n){this.wp=t,this.firestore=e,this.ip=n}function ad(){return null!==Wp&&Wp.apply(this,arguments)||this}function ud(t,e,n,r,i,o){this.tp=t,this.Xm=e,this.cp=n,this.ap=r,this.fp=i,this.ip=o}function hd(t,e){this.hasPendingWrites=t,this.fromCache=e}function cd(t,e,n){this.Xm=t,this.firestore=e,this.ip=n,this.Lm=this.firestore.jm()}function fd(t){this.tp=t,this.ep=[],this.rp=!1}function ld(t,e){this.tp=t,this.np=e}function pd(t,e){var n=this;if(this.Um=null,this.xm=new ah,this.INTERNAL={delete:function(){return p(n,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.jm(),[4,this.Lm.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var r=t;this.Um=r,this.Bm=pd.Mm(r),this.qm=r.name,this.Qm=new ni(e)}else{var i=t;if(!i.projectId)throw new ti(Zr.INVALID_ARGUMENT,"Must provide projectId");this.Bm=new Kr(i.projectId,i.database),this.qm="[DEFAULT]",this.Qm=new ei}this.Gm=new Xp({}),this.Wm=this.zm(this.Bm)}function dd(t){if(void 0===t.host){if(void 0!==t.ssl)throw new ti(Zr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Ni("settings","non-empty string","host",t.host),this.host=t.host,Ti("settings","boolean","ssl",t.ssl),this.ssl=pi(t.ssl,!0);if(_i("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),Ti("settings","object","credentials",t.credentials),this.credentials=t.credentials,Ti("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?qr("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&qr("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=pi(t.timestampsInSnapshots,!0),Ti("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=dc.Cc;else{if(t.cacheSizeBytes!==Yp&&t.cacheSizeBytes<dc.Sc)throw new ti(Zr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+dc.Sc);this.cacheSizeBytes=t.cacheSizeBytes}Ti("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}s(["length","forEach","map"],"undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(id.prototype.docChanges,t,{get:function(){return function(){throw new ti(Zr.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var yd,vd=(t(md,yd=rd),Object.defineProperty(md.prototype,"id",{get:function(){return this.wp.path.X()},enumerable:!0,configurable:!0}),Object.defineProperty(md.prototype,"parent",{get:function(){var t=this.wp.path.H();return t.J()?null:new Zp(new zi(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(md.prototype,"path",{get:function(){return this.wp.path.nt()},enumerable:!0,configurable:!0}),md.prototype.doc=function(t){if(bi("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Fr.u()),Ei("CollectionReference.doc","non-empty string",1,t),""===t)throw new ti(Zr.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Fi.it(t);return Zp.$m(this.wp.path.child(e),this.firestore,this.ip)},md.prototype.add=function(t){gi("CollectionReference.add",arguments,1),Ei("CollectionReference.add","object",1,this.ip?this.ip.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},md.prototype.withConverter=function(t){return new md(this.Cp,this.firestore,t)},md);function md(t,e,n){var r=yd.call(this,ga.ti(t),e,n)||this;if((r.Cp=t).length%2!=1)throw new ti(Zr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.nt()+" has "+t.length);return r}function gd(t,e){if(void 0===e)return{merge:!1};if(_i(t,e,["merge","mergeFields"]),Ti(t,"boolean","merge",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Di(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+Di(r[o]))}(t,e,n,r,i)}(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof al}),void 0!==e.mergeFields&&void 0!==e.merge)throw new ti(Zr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function wd(t,e){return void 0===e?{}:(_i(t,e,["serverTimestamps"]),Ai(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function bd(t,e){Ii(t,"object",1,e),e&&(_i(t,e,["source"]),Ai(t,0,"source",e.source,["default","server","cache"]))}function Ed(t,e,n){if(e instanceof Zp){if(e.firestore!==n)throw new ti(Zr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw xi(t,"DocumentReference",1,e)}function Id(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}var Nd=Xu(Qp,"Use firebase.firestore() instead."),Td=Xu(Kp,"Use firebase.firestore().runTransaction() instead."),Ad=Xu($p,"Use firebase.firestore().batch() instead."),Sd=Xu(Zp,"Use firebase.firestore().doc() instead."),kd=Xu(ed),Dd=Xu(nd),Rd=Xu(rd),_d=Xu(id),xd=Xu(vd,"Use firebase.firestore().collection() instead."),Cd={Firestore:Nd,GeoPoint:Ui,Timestamp:Vi,Blob:nh,Transaction:Td,WriteBatch:Ad,DocumentReference:Sd,DocumentSnapshot:kd,Query:Rd,QueryDocumentSnapshot:Dd,QuerySnapshot:_d,CollectionReference:xd,FieldPath:al,FieldValue:kl,setLogLevel:Qp.setLogLevel,CACHE_SIZE_UNLIMITED:Yp};var Od=(Hd.prototype.Od=function(t){},Hd.prototype.shutdown=function(){},Hd),Pd=(Bd.prototype.Od=function(t){this.Fp.push(t)},Bd.prototype.shutdown=function(){window.removeEventListener("online",this.kp),window.removeEventListener("offline",this.Np)},Bd.prototype.Up=function(){window.addEventListener("online",this.kp),window.addEventListener("offline",this.Np)},Bd.prototype.Vp=function(){Ur("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Fp;t<e.length;t++)(0,e[t])(0)},Bd.prototype.Op=function(){Ur("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Fp;t<e.length;t++)(0,e[t])(1)},Bd.Hs=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Bd),Ld=(Fd.prototype.yl=function(t){jr(!this.Lp,"Called onOpen on stream twice!"),this.Lp=t},Fd.prototype.wl=function(t){jr(!this.Bp,"Called onClose on stream twice!"),this.Bp=t},Fd.prototype.onMessage=function(t){jr(!this.Mp,"Called onMessage on stream twice!"),this.Mp=t},Fd.prototype.close=function(){this.jp()},Fd.prototype.send=function(t){this.xp(t)},Fd.prototype.qp=function(){jr(void 0!==this.Lp,"Cannot call onOpen because no callback was set"),this.Lp()},Fd.prototype.Qp=function(t){jr(void 0!==this.Bp,"Cannot call onClose because no callback was set"),this.Bp(t)},Fd.prototype.Gp=function(t){jr(void 0!==this.Mp,"Cannot call onMessage because no callback was set"),this.Mp(t)},Fd),Md={BatchGetDocuments:"batchGet",Commit:"commit"},Ud="gl-js/ fire/"+Or,qd=(jd.prototype.zp=function(t,e){if(e)for(var n in e.g)e.g.hasOwnProperty(n)&&(t[n]=e.g[n]);t["X-Goog-Api-Client"]=Ud},jd.prototype.Vl=function(u,r,i){var h=this,c=this.Kp(u);return new Promise(function(o,s){var a=new Cr;a.listenOnce(_r.COMPLETE,function(){try{switch(a.getLastErrorCode()){case Rr.NO_ERROR:var t=a.getResponseJson();Ur("Connection","XHR received:",JSON.stringify(t)),o(t);break;case Rr.TIMEOUT:Ur("Connection",'RPC "'+u+'" timed out'),s(new ti(Zr.DEADLINE_EXCEEDED,"Request time out"));break;case Rr.HTTP_ERROR:var e=a.getStatus();if(Ur("Connection",'RPC "'+u+'" failed with status:',e,"response text:",a.getResponseText()),0<e){var n=a.getResponseJson().error;if(n&&n.status&&n.message){var r=(i=n.status.toLowerCase().replace("_","-"),0<=Object.values(Zr).indexOf(i)?i:Zr.UNKNOWN);s(new ti(r,n.message))}else s(new ti(Zr.UNKNOWN,"Server responded with status "+a.getStatus()))}else Ur("Connection",'RPC "'+u+'" failed'),s(new ti(Zr.UNAVAILABLE,"Connection failed."));break;default:Gr('RPC "'+u+'" failed with unanticipated webchannel error '+a.getLastErrorCode()+": "+a.getLastError()+", giving up.")}}finally{Ur("Connection",'RPC "'+u+'" completed.')}var i});var t=f({},r);delete t.database;var e=JSON.stringify(t);Ur("Connection","XHR sending: ",c+" "+e);var n={"Content-Type":"text/plain"};h.zp(n,i),a.send(c,"POST",e,n,15)})},jd.prototype.Nl=function(t,e,n){return this.Vl(t,e,n)},jd.prototype._l=function(t,e){var n=[this.Wp,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Dr(),i={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.s.projectId+"/databases/"+this.s.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.zp(i.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(l())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=l().indexOf("Electron/")||function(){var t=l();return 0<=t.indexOf("MSIE ")||0<=t.indexOf("Trident/")}()||0<=l().indexOf("MSAppHost/")||function(){var t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function s(t,e){u.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Ur("Connection","Creating WebChannel: "+o+" "+i);var u=r.createWebChannel(o,i),a=!1,h=!1,c=new Ld({xp:function(t){h?Ur("Connection","Not sending because WebChannel is closed:",t):(a||(Ur("Connection","Opening WebChannel transport."),u.open(),a=!0),Ur("Connection","WebChannel sending:",t),u.send(t))},jp:function(){return u.close()}});return s(xr.EventType.OPEN,function(){h||Ur("Connection","WebChannel transport opened.")}),s(xr.EventType.CLOSE,function(){h||(h=!0,Ur("Connection","WebChannel transport closed"),c.Qp())}),s(xr.EventType.ERROR,function(t){h||(h=!0,Ur("Connection","WebChannel transport errored:",t),c.Qp(new ti(Zr.UNAVAILABLE,"The operation could not be completed")))}),s(xr.EventType.MESSAGE,function(t){var e;if(!h){var n=t.data[0];jr(!!n,"Got a webchannel message without data.");var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){Ur("Connection","WebChannel received error:",i);var o=i.status,s=function(){var t=Ya[o];if(void 0!==t)return eu(t)}(),a=i.message;void 0===s&&(s=Zr.INTERNAL,a="Unknown error status: "+o+" with message "+i.message),h=!0,c.Qp(new ti(s,a)),u.close()}else Ur("Connection","WebChannel received:",n),c.Gp(n)}}),setTimeout(function(){c.qp()},0),c},jd.prototype.Kp=function(t){var e=Md[t];return jr(void 0!==e,"Unknown REST mapping for: "+t),this.Wp+"/v1/projects/"+this.s.projectId+"/databases/"+this.s.database+"/documents:"+e},jd),Vd=(Object.defineProperty(Gd.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(Gd.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),Gd.prototype.Am=function(t){return Promise.resolve(new qd(t))},Gd.prototype.Pm=function(){return Pd.Hs()?new Pd:new Od},Gd.prototype.Sm=function(t){return new zu(t,{Ze:!0})},Gd.prototype.i=function(t){return JSON.stringify(t)},Gd.prototype.atob=function(t){return atob(t)},Gd.prototype.btoa=function(t){return btoa(t)},Gd);function Gd(){this.du="undefined"!=typeof atob}function jd(t){this.s=t.s;var e=t.ssl?"https":"http";this.Wp=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}function Fd(t){this.xp=t.xp,this.jp=t.jp}function Bd(){var t=this;this.kp=function(){return t.Vp()},this.Np=function(){return t.Op()},this.Fp=[],this.Up()}function Hd(){}Ju.lu(new Vd);var zd,Jd;(Jd=Wd).INTERNAL.registerComponent(new b("firestore",function(t){var e=t.getProvider("app").getImmediate();return new Qp(e,t.getProvider("auth-internal"))},"PUBLIC").setServiceProps((jr((zd=Cd)&&"object"==typeof zd,"shallowCopy() expects object parameter."),f({},zd)))),Jd.registerVersion("@firebase/firestore","1.12.0")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.js.map
